!function(){var O=function(b){var a=b,c=function(){return a};return{get:c,set:function(d){a=d},clone:function(){return O(c())}}},V=tinymce.util.Tools.resolve("tinymce.PluginManager"),T=tinymce.util.Tools.resolve("tinymce.util.Tools"),F=tinymce.util.Tools.resolve("tinymce.html.DomParser"),U=tinymce.util.Tools.resolve("tinymce.html.Node"),N=tinymce.util.Tools.resolve("tinymce.html.Serializer"),S=function(a){return a.getParam("fullpage_hide_in_source_view")},I=function(a){return a.getParam("fullpage_default_xml_pi")},L=function(a){return a.getParam("fullpage_default_encoding")},Z=function(a){return a.getParam("fullpage_default_font_family")},X=function(a){return a.getParam("fullpage_default_font_size")},G=function(a){return a.getParam("fullpage_default_text_color")},E=function(a){return a.getParam("fullpage_default_title")},W=function(a){return a.getParam("fullpage_default_doctype","<!DOCTYPE html>")},K=function(a){return F({validate:!1,root_name:"#document"}).parse(a)},q=K,D=function(f,c){var h,a,b=K(c),d={};function g(k,i){return k.attr(i)||""}return d.fontface=Z(f),d.fontsize=X(f),7===(h=b.firstChild).type&&(d.xml_pi=!0,(a=/encoding="([^"]+)"/.exec(h.value))&&(d.docencoding=a[1])),(h=b.getAll("#doctype")[0])&&(d.doctype="<!DOCTYPE"+h.value+">"),(h=b.getAll("title")[0])&&h.firstChild&&(d.title=h.firstChild.value),T.each(b.getAll("meta"),function(m){var k,o=m.attr("name"),i=m.attr("http-equiv");o?d[o.toLowerCase()]=m.attr("content"):"Content-Type"===i&&(k=/charset\s*=\s*(.*)\s*/gi.exec(m.attr("content")))&&(d.docencoding=k[1])}),(h=b.getAll("html")[0])&&(d.langcode=g(h,"lang")||g(h,"xml:lang")),d.stylesheets=[],T.each(b.getAll("link"),function(i){"stylesheet"===i.attr("rel")&&d.stylesheets.push(i.attr("href"))}),(h=b.getAll("body")[0])&&(d.langdir=g(h,"dir"),d.style=g(h,"style"),d.visited_color=g(h,"vlink"),d.link_color=g(h,"link"),d.active_color=g(h,"alink")),d},aa=function(m,b,y){var f,g,h,w,k,v=m.dom;function A(c,a,d){c.attr(a,d||undefined)}function x(a){g.firstChild?g.insert(a,g.firstChild):g.append(a)}f=K(y),(g=f.getAll("head")[0])||(w=f.getAll("html")[0],g=new U("head",1),w.firstChild?w.insert(g,w.firstChild,!0):w.append(g)),w=f.firstChild,b.xml_pi?(k='version="1.0"',b.docencoding&&(k+=' encoding="'+b.docencoding+'"'),7!==w.type&&(w=new U("xml",7),f.insert(w,f.firstChild,!0)),w.value=k):w&&7===w.type&&w.remove(),w=f.getAll("#doctype")[0],b.doctype?(w||(w=new U("#doctype",10),b.xml_pi?f.insert(w,f.firstChild):x(w)),w.value=b.doctype.substring(9,b.doctype.length-1)):w&&w.remove(),w=null,T.each(f.getAll("meta"),function(a){"Content-Type"===a.attr("http-equiv")&&(w=a)}),b.docencoding?(w||((w=new U("meta",1)).attr("http-equiv","Content-Type"),w.shortEnded=!0,x(w)),w.attr("content","text/html; charset="+b.docencoding)):w&&w.remove(),w=f.getAll("title")[0],b.title?(w?w.empty():x(w=new U("title",1)),w.append(new U("#text",3)).value=b.title):w&&w.remove(),T.each("keywords,description,author,copyright,robots".split(","),function(o){var d,r,a=f.getAll("meta"),c=b[o];for(d=0;d<a.length;d++){if((r=a[d]).attr("name")===o){return void (c?r.attr("content",c):r.remove())}}c&&((w=new U("meta",1)).attr("name",o),w.attr("content",c),w.shortEnded=!0,x(w))});var p={};return T.each(f.getAll("link"),function(a){"stylesheet"===a.attr("rel")&&(p[a.attr("href")]=a)}),T.each(b.stylesheets,function(a){p[a]||((w=new U("link",1)).attr({rel:"stylesheet",text:"text/css",href:a}),w.shortEnded=!0,x(w)),delete p[a]}),T.each(p,function(a){a.remove()}),(w=f.getAll("body")[0])&&(A(w,"dir",b.langdir),A(w,"style",b.style),A(w,"vlink",b.visited_color),A(w,"link",b.link_color),A(w,"alink",b.active_color),v.setAttribs(m.getBody(),{style:b.style,dir:b.dir,vLink:b.visited_color,link:b.link_color,aLink:b.active_color})),(w=f.getAll("html")[0])&&(A(w,"lang",b.langcode),A(w,"xml:lang",b.langcode)),g.firstChild||g.remove(),(h=N({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(f)).substring(0,h.indexOf("</body>"))},M=function(c,a){var b=D(c,a.get());c.windowManager.open({title:"Document properties",data:b,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(f){var d=aa(c,T.extend(b,f.data),a.get());a.set(d)}})},R=function(b,a){b.addCommand("mceFullPageProperties",function(){M(b,a)})},Y=function(b,a){return T.each(b,function(c){a=a.replace(c,function(d){return"\x3c!--mce:protected "+escape(d)+"--\x3e"})}),a},z=function(a){return a.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(c,b){return unescape(b)})},Q=T.each,H=function(a){return a.replace(/<\/?[A-Z]+/g,function(b){return b.toLowerCase()})},J=function(d){var c,f="",a="";if(I(d)){var b=L(d);f+='<?xml version="1.0" encoding="'+(b||"ISO-8859-1")+'" ?>\n'}return f+=W(d),f+="\n<html>\n<head>\n",(c=E(d))&&(f+="<title>"+c+"</title>\n"),(c=L(d))&&(f+='<meta http-equiv="Content-Type" content="text/html; charset='+c+'" />\n'),(c=Z(d))&&(a+="font-family: "+c+";"),(c=X(d))&&(a+="font-size: "+c+";"),(c=G(d))&&(a+="color: "+c+";"),f+="</head>\n<body"+(a?' style="'+a+'"':"")+">\n"},B=function(c,d,b){c.on("BeforeSetContent",function(a){!function(w,P,k,m){var p,g,h,A,y,ab="",C=w.dom;if(!(m.selection||(h=Y(w.settings.protect,m.content),"raw"===m.format&&P.get()||m.source_view&&S(w)))){0!==h.length||m.source_view||(h=T.trim(P.get())+"\n"+T.trim(h)+"\n"+T.trim(k.get())),-1!==(p=(h=h.replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(p=h.indexOf(">",p),P.set(H(h.substring(0,p+1))),-1===(g=h.indexOf("</body",p))&&(g=h.length),m.content=T.trim(h.substring(p+1,g)),k.set(H(h.substring(g)))):(P.set(J(w)),k.set("\n</body>\n</html>")),A=q(P.get()),Q(A.getAll("style"),function(f){f.firstChild&&(ab+=f.firstChild.value)}),(y=A.getAll("body")[0])&&C.setAttribs(w.getBody(),{style:y.attr("style")||"",dir:y.attr("dir")||"",vLink:y.attr("vlink")||"",link:y.attr("link")||"",aLink:y.attr("alink")||""}),C.remove("fullpage_styles");var x=w.getDoc().getElementsByTagName("head")[0];ab&&(C.add(x,"style",{id:"fullpage_styles"},ab),(y=C.get("fullpage_styles")).styleSheet&&(y.styleSheet.cssText=ab));var v={};T.each(x.getElementsByTagName("link"),function(f){"stylesheet"===f.rel&&f.getAttribute("data-mce-fullpage")&&(v[f.href]=f)}),T.each(A.getAll("link"),function(i){var f=i.attr("href");if(!f){return !0}v[f]||"stylesheet"!==i.attr("rel")||C.add(x,"link",{rel:"stylesheet",text:"text/css",href:f,"data-mce-fullpage":"1"}),delete v[f]}),T.each(v,function(f){f.parentNode.removeChild(f)})}}(c,d,b,a)}),c.on("GetContent",function(h){var g,k,a,f;g=c,k=d.get(),a=b.get(),(f=h).selection||f.source_view&&S(g)||(f.content=z(T.trim(k)+"\n"+T.trim(f.content)+"\n"+T.trim(a)))})},j=function(a){a.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),a.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"})};V.add("fullpage",function(b){var a=O(""),c=O("");R(b,a),j(b),B(b,a,c)})}();