!function(){var h=tinymce.util.Tools.resolve("tinymce.PluginManager"),g=tinymce.util.Tools.resolve("tinymce.Env"),d=function(i){return i.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},j=function(i){return i.getParam("default_link_target","")},c=function(k,i){if(i<0&&(i=0),3===k.nodeType){var m=k.data.length;m<i&&(i=m)}return i},f=function(k,i,m){1!==i.nodeType||i.hasChildNodes()?k.setStart(i,c(i,m)):k.setStartBefore(i)},b=function(k,i,m){1!==i.nodeType||i.hasChildNodes()?k.setEnd(i,c(i,m)):k.setEndAfter(i)},a=function(A,G,q){var w,p,k,E,z,H,B,v,D,F,y=d(A),x=j(A);if("A"!==A.selection.getNode().tagName){if((w=A.selection.getRng(!0).cloneRange()).startOffset<5){if(!(v=w.endContainer.previousSibling)){if(!w.endContainer.firstChild||!w.endContainer.firstChild.nextSibling){return}v=w.endContainer.firstChild.nextSibling}if(D=v.length,f(w,v,D),b(w,v,D),w.endOffset<5){return}p=w.endOffset,E=v}else{if(3!==(E=w.endContainer).nodeType&&E.firstChild){for(;3!==E.nodeType&&E.firstChild;){E=E.firstChild}3===E.nodeType&&(f(w,E,0),b(w,E,E.nodeValue.length))}p=1===w.endOffset?2:w.endOffset-1-G}for(k=p;f(w,E,2<=p?p-2:0),b(w,E,1<=p?p-1:0),p-=1," "!==(F=w.toString())&&""!==F&&160!==F.charCodeAt(0)&&0<=p-2&&F!==q;){}var m;(m=w.toString())===q||" "===m||160===m.charCodeAt(0)?(f(w,E,p),b(w,E,k),p+=1):(0===w.startOffset?f(w,E,0):f(w,E,p),b(w,E,k)),"."===(H=w.toString()).charAt(H.length-1)&&b(w,E,k-1),(B=(H=w.toString().trim()).match(y))&&("www."===B[1]?B[1]="http://www.":/@$/.test(B[1])&&!/^mailto:/.test(B[1])&&(B[1]="mailto:"+B[1]),z=A.selection.getBookmark(),A.selection.setRng(w),A.execCommand("createlink",!1,B[1]+B[2]),x&&A.dom.setAttrib(A.selection.getNode(),"target",x),A.selection.moveToBookmark(z),A.nodeChanged())}},l=function(e){var i;e.on("keydown",function(k){13!==k.keyCode||a(e,-1,"")}),g.ie?e.on("focus",function(){if(!i){i=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(k){}}}):(e.on("keypress",function(k){41!==k.keyCode||a(e,-1,"(")}),e.on("keyup",function(k){32!==k.keyCode||a(e,0,"")}))};h.add("autolink",function(i){l(i)})}();