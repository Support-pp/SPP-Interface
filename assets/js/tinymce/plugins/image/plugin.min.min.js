!function(){var aO=tinymce.util.Tools.resolve("tinymce.PluginManager"),aP=function(a){return !1!==a.settings.image_dimensions},aU=function(a){return !0===a.settings.image_advtab},aN=function(a){return a.getParam("image_prepend_url","")},aC=function(a){return a.getParam("image_class_list")},ax=function(a){return !1!==a.settings.image_description},aJ=function(a){return !0===a.settings.image_title},aB=function(a){return !0===a.settings.image_caption},aG=function(a){return a.getParam("image_list",!1)},au=function(a){return a.getParam("images_upload_url",!1)},aQ=function(a){return a.getParam("images_upload_handler",!1)},aw=function(a){return a.getParam("images_upload_url")},aM=function(a){return a.getParam("images_upload_handler")},aD=function(a){return a.getParam("images_upload_base_path")},aA=function(a){return a.getParam("images_upload_credentials")},aK="undefined"!=typeof window?window:Function("return this;")(),at=function(c,a){for(var d=a!==undefined&&null!==a?a:aK,b=0;b<c.length&&d!==undefined&&null!==d;++b){d=d[c[b]]}return d},aT=function(b,a){var c=b.split(".");return at(c,a)},av={getOrDie:function(b,a){var c=aT(b,a);if(c===undefined||null===c){throw b+" not available on this browser"}return c}};function ap(){return new (av.getOrDie("FileReader"))}var aq=tinymce.util.Tools.resolve("tinymce.util.Promise"),ar=tinymce.util.Tools.resolve("tinymce.util.Tools"),a4=tinymce.util.Tools.resolve("tinymce.util.XHR"),ba=function(b,a){return Math.max(parseInt(b,10),parseInt(a,10))},br=function(d,f){var c=document.createElement("img");function b(h,g){c.parentNode&&c.parentNode.removeChild(c),f({width:h,height:g})}c.onload=function(){b(ba(c.width,c.clientWidth),ba(c.height,c.clientHeight))},c.onerror=function(){b(0,0)};var a=c.style;a.visibility="hidden",a.position="fixed",a.bottom=a.left="0px",a.width=a.height="auto",document.body.appendChild(c),c.src=d},bt=function(c,b,a){return function d(g,f){return f=f||[],ar.each(g,function(i){var h={text:i.text||i.title};i.menu?h.menu=d(i.menu):(h.value=i.value,b(h)),f.push(h)}),f}(c,a||[])},aV=function(a){return a&&(a=a.replace(/px$/,"")),a},a2=function(a){return 0<a.length&&/^[0-9]+$/.test(a)&&(a+="px"),a},a8=function(b){if(b.margin){var a=b.margin.split(" ");switch(a.length){case 1:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[0],b["margin-bottom"]=b["margin-bottom"]||a[0],b["margin-left"]=b["margin-left"]||a[0];break;case 2:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[0],b["margin-left"]=b["margin-left"]||a[1];break;case 3:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[1];break;case 4:b["margin-top"]=b["margin-top"]||a[0],b["margin-right"]=b["margin-right"]||a[1],b["margin-bottom"]=b["margin-bottom"]||a[2],b["margin-left"]=b["margin-left"]||a[3]}delete b.margin}return b},a5=function(b,a){var c=aG(b);"string"==typeof c?a4.send({url:c,success:function(d){a(JSON.parse(d))}}):"function"==typeof c?c(a):a(c)},a7=function(c,a,d){function b(){d.onload=d.onerror=null,c.selection&&(c.selection.select(d),c.nodeChanged())}d.onload=function(){a.width||a.height||!aP(c)||c.dom.setAttribs(d,{width:d.clientWidth,height:d.clientHeight}),b()},d.onerror=b},bh=function(a){return new aq(function(c,b){var d=new ap;d.onload=function(){c(d.result)},d.onerror=function(){b(ap.error.message)},d.readAsDataURL(a)})},bd=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),a1=function(a){return function(b){return function(d){if(null===d){return"null"}var c=typeof d;return"object"===c&&Array.prototype.isPrototypeOf(d)?"array":"object"===c&&String.prototype.isPrototypeOf(d)?"string":c}(b)===a}},bn={isString:a1("string"),isObject:a1("object"),isArray:a1("array"),isNull:a1("null"),isBoolean:a1("boolean"),isUndefined:a1("undefined"),isFunction:a1("function"),isNumber:a1("number")},bc=function(b){return function(){for(var f=new Array(arguments.length),c=0;c<f.length;c++){f[c]=arguments[c]}if(0===f.length){throw new Error("Can't merge zero objects")}for(var h={},d=0;d<f.length;d++){var a=f[d];for(var g in a){a.hasOwnProperty(g)&&(h[g]=b(h[g],a[g]))}}return h}},aI=bc(function(b,a){return bn.isObject(b)&&bn.isObject(a)?aI(b,a):a}),aH=bc(function(b,a){return a}),bo={deepMerge:aI,merge:aH},ao=bd.DOM,bs=function(a){return a.style.marginLeft&&a.style.marginRight&&a.style.marginLeft===a.style.marginRight?aV(a.style.marginLeft):""},bk=function(a){return a.style.marginTop&&a.style.marginBottom&&a.style.marginTop===a.style.marginBottom?aV(a.style.marginTop):""},bm=function(a){return a.style.borderWidth?aV(a.style.borderWidth):""},aZ=function(b,a){return b.hasAttribute(a)?b.getAttribute(a):""},bg=function(b,a){return b.style[a]?b.style[a]:""},a0=function(a){return null!==a.parentNode&&"FIGURE"===a.parentNode.nodeName},bl=function(b,a,c){b.setAttribute(a,c)},bD=function(d){var b,f,c,a;a0(d)?(a=(c=d).parentNode,ao.insertAfter(c,a),ao.remove(a)):(b=d,f=ao.create("figure",{"class":"image"}),ao.insertAfter(f,b),f.appendChild(b),f.appendChild(ao.create("figcaption",{contentEditable:!0},"Caption")),f.contentEditable="false")},aY=function(c,a){var d=c.getAttribute("style"),b=a(null!==d?d:"");0<b.length?(c.setAttribute("style",b),c.setAttribute("data-mce-style",b)):c.removeAttribute("style")},az=function(b,a){return function(d,c,f){d.style[c]?(d.style[c]=a2(f),aY(d,a)):bl(d,c,f)}},bf=function(b,a){return b.style[a]?aV(b.style[a]):aZ(b,a)},a6=function(b,a){var c=a2(a);b.style.marginLeft=c,b.style.marginRight=c},aX=function(b,a){var c=a2(a);b.style.marginTop=c,b.style.marginBottom=c},aW=function(b,a){var c=a2(a);b.style.borderWidth=c},ab=function(b,a){b.style.borderStyle=a},bp=function(a){return"FIGURE"===a.nodeName},bi=function(b,a){var c=document.createElement("img");return bl(c,"style",a.style),(bs(c)||""!==a.hspace)&&a6(c,a.hspace),(bk(c)||""!==a.vspace)&&aX(c,a.vspace),(bm(c)||""!==a.border)&&aW(c,a.border),(bg(c,"borderStyle")||""!==a.borderStyle)&&ab(c,a.borderStyle),b(c.getAttribute("style"))},bJ=function(b,a){return{src:aZ(a,"src"),alt:aZ(a,"alt"),title:aZ(a,"title"),width:bf(a,"width"),height:bf(a,"height"),"class":aZ(a,"class"),style:b(aZ(a,"style")),caption:a0(a),hspace:bs(a),vspace:bk(a),border:bm(a),borderStyle:bg(a,"borderStyle")}},aE=function(d,b,f,c,a){f[c]!==b[c]&&a(d,c,f[c])},aL=function(b,a){return function(d,c,f){b(d,f),aY(d,a)}},bw=function(c,a,d){var b=bJ(c,d);aE(d,b,a,"caption",function(g,f,h){return bD(g)}),aE(d,b,a,"src",bl),aE(d,b,a,"alt",bl),aE(d,b,a,"title",bl),aE(d,b,a,"width",az(0,c)),aE(d,b,a,"height",az(0,c)),aE(d,b,a,"class",bl),aE(d,b,a,"style",aL(function(g,f){return bl(g,"style",f)},c)),aE(d,b,a,"hspace",aL(a6,c)),aE(d,b,a,"vspace",aL(aX,c)),aE(d,b,a,"border",aL(aW,c)),aE(d,b,a,"borderStyle",aL(ab,c))},bI=function(d,b){var f=d.dom.styles.parse(b),c=a8(f),a=d.dom.styles.parse(d.dom.styles.serialize(c));return d.dom.styles.serialize(a)},aR=function(b){var a=b.selection.getNode(),c=b.dom.getParent(a,"figure.image");return c?b.dom.select("img",c)[0]:a&&("IMG"!==a.nodeName||a.getAttribute("data-mce-object")||a.getAttribute("data-mce-placeholder"))?null:a},ay=function(a,c){var d=a.dom,b=d.getParent(c.parentNode,function(f){return a.schema.getTextBlockElements()[f.nodeName]});return b?d.split(b,c):c},bB=function(a){var b=aR(a);return b?bJ(function(c){return bI(a,c)},b):{src:"",alt:"",title:"",width:"",height:"","class":"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""}},ai=function(b,d){var f=function(i,g){var j=document.createElement("img");if(bw(i,bo.merge(g,{caption:!1}),j),bl(j,"alt",g.alt),g.caption){var h=ao.create("figure",{"class":"image"});return h.appendChild(j),h.appendChild(ao.create("figcaption",{contentEditable:!0},"Caption")),h.contentEditable="false",h}return j}(function(g){return bI(b,g)},d);b.dom.setAttrib(f,"data-mce-id","__mcenew"),b.focus(),b.selection.setContent(f.outerHTML);var c=b.dom.select('*[data-mce-id="__mcenew"]')[0];if(b.dom.setAttrib(c,"data-mce-id",null),bp(c)){var a=ay(b,c);b.selection.select(a)}else{b.selection.select(c)}},bG=function(b,a){var c=aR(b);c?a.src?function(f,h){var j,g=aR(f);if(bw(function(i){return bI(f,i)},h,g),j=g,f.dom.setAttrib(j,"src",j.getAttribute("src")),bp(g.parentNode)){var d=g.parentNode;ay(f,d),f.selection.select(g.parentNode)}else{f.selection.select(g),a7(f,h,g)}}(b,a):function(f,d){if(d){var g=f.dom.is(d.parentNode,"figure.image")?d.parentNode:d;f.dom.remove(g),f.focus(),f.nodeChanged(),f.dom.isEmpty(f.getBody())&&(f.setContent(""),f.selection.setCursorLocation())}}(b,c):a.src&&ai(b,a)},bx=function(b,a){a.find("#style").each(function(d){var c=bi(function(f){return bI(b,f)},bo.merge({src:"",alt:"",title:"",width:"",height:"","class":"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""},a.toJSON()));d.value(c)})},bz=function(a){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:(b=a,function(g){var d=b.dom,h=g.control.rootControl;if(aU(b)){var f=h.toJSON(),c=d.parseStyle(f.style);h.find("#vspace").value(""),h.find("#hspace").value(""),((c=a8(c))["margin-top"]&&c["margin-bottom"]||c["margin-right"]&&c["margin-left"])&&(c["margin-top"]===c["margin-bottom"]?h.find("#vspace").value(aV(c["margin-top"])):h.find("#vspace").value(""),c["margin-right"]===c["margin-left"]?h.find("#hspace").value(aV(c["margin-right"])):h.find("#hspace").value("")),c["border-width"]?h.find("#border").value(aV(c["border-width"])):h.find("#border").value(""),c["border-style"]?h.find("#borderStyle").value(c["border-style"]):h.find("#borderStyle").value(""),h.find("#style").value(d.serializeStyle(d.parseStyle(d.serializeStyle(c))))}})},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,defaults:{type:"textbox",maxWidth:50,onchange:function(c){bx(a,c.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Border width",name:"border"},{label:"Horizontal space",name:"hspace"},{label:"Border style",type:"listbox",name:"borderStyle",width:90,maxWidth:90,onselect:function(c){bx(a,c.control.rootControl)},values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]};var b},al=function(b,a){b.state.set("oldVal",b.value()),a.state.set("oldVal",a.value())},a9=function(d,b){var f=d.find("#width")[0],c=d.find("#height")[0],a=d.find("#constrain")[0];f&&c&&a&&b(f,c,a.checked())},am=function(g,d,j){var f=g.state.get("oldVal"),c=d.state.get("oldVal"),h=g.value(),b=d.value();j&&f&&c&&h&&b&&(h!==f?(b=Math.round(h/f*b),isNaN(b)||d.value(b)):(h=Math.round(b/c*h),isNaN(h)||g.value(h))),al(g,d)},a3=function(a){a9(a,am)},bE=function(){var a=function(b){a3(b.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},bL=function(a){a9(a,al)},ag=a3,bM=function(a){a.meta=a.control.rootControl.toJSON()},bC=function(b,c){var a=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(k){var s,g,d,j,f,p,h,q,m;g=b,p=(s=k).meta||{},h=s.control,q=h.rootControl,(m=q.find("#image-list")[0])&&m.value(g.convertURL(h.value(),"src")),ar.each(p,function(l,i){q.find("#"+i).value(l)}),p.width||p.height||(d=g.convertURL(h.value(),"src"),j=aN(g),f=new RegExp("^(?:[a-z]+:)?//","i"),j&&!f.test(d)&&d.substring(0,j.length)!==j&&(d=j+d),h.value(d),br(g.documentBaseURI.toAbsolute(h.value()),function(i){i.width&&i.height&&aP(g)&&(q.find("#width").value(i.width),q.find("#height").value(i.height),bL(q))}))},onbeforecall:bM},c];return ax(b)&&a.push({name:"alt",type:"textbox",label:"Image description"}),aJ(b)&&a.push({name:"title",type:"textbox",label:"Image Title"}),aP(b)&&a.push(bE()),aC(b)&&a.push({name:"class",type:"listbox",label:"Class",values:bt(aC(b),function(d){d.value&&(d.textStyle=function(){return b.formatter.getCssText({inline:"img",classes:[d.value]})})})}),aB(b)&&a.push({name:"caption",type:"checkbox",label:"Caption"}),a},bb=function(b,a){return{title:"General",type:"form",items:bC(b,a)}},bH=bC,aa=function(){return av.getOrDie("URL")},bF=function(a){return aa().createObjectURL(a)},bq=function(a){aa().revokeObjectURL(a)},ah=tinymce.util.Tools.resolve("tinymce.ui.Factory");function aS(){return new (av.getOrDie("XMLHttpRequest"))}var bj=function(){};function af(b){var c=function(g,f,d,a){var h,j;(h=new aS).open("POST",b.url),h.withCredentials=b.credentials,h.upload.onprogress=function(i){a(i.loaded/i.total*100)},h.onerror=function(){d("Image upload failed due to a XHR Transport error. Code: "+h.status)},h.onload=function(){var k,i,l;h.status<200||300<=h.status?d("HTTP Error: "+h.status):(k=JSON.parse(h.responseText))&&"string"==typeof k.location?f((i=b.basePath,l=k.location,i?i.replace(/\/$/,"")+"/"+l.replace(/^\//,""):l)):d("Invalid JSON: "+h.responseText)},(j=new FormData).append("file",g.blob(),g.filename()),h.send(j)};return b=ar.extend({credentials:!1,handler:c},b),{upload:function(f){return b.url||b.handler!==c?(d=f,a=b.handler,new aq(function(h,g){try{a(d,h,g,bj)}catch(i){g(i.message)}})):aq.reject("Upload url missing from the settings.");var d,a}}}var bv=function(a){return function(h){var f=ah.get("Throbber"),k=h.control.rootControl,g=new f(k.getEl()),d=h.control.value(),j=bF(d),c=af({url:aw(a),basePath:aD(a),credentials:aA(a),handler:aM(a)}),b=function(){g.hide(),bq(j)};return g.show(),bh(d).then(function(l){var i=a.editorUpload.blobCache.create({blob:d,blobUri:j,name:d.name?d.name.replace(/\.[^\.]+$/,""):null,base64:l.split(",")[1]});return c.upload(i).then(function(n){var m=k.find("#src");return m.value(n),k.find("tabpanel")[0].activateTab(0),m.fire("change"),b(),n})})["catch"](function(i){a.windowManager.alert(i),b()})}},ak=".jpg,.jpeg,.png,.gif",bK=function(a){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:ak,onchange:bv(a)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:ak,height:100,onchange:bv(a)}]}},aj=function(a){return function(){return a}},ac=(aj(!1),aj(!0),function(f){for(var d=[],c=1;c<arguments.length;c++){d[c-1]=arguments[c]}for(var b=new Array(arguments.length-1),g=1;g<arguments.length;g++){b[g-1]=arguments[g]}return function(){for(var k=[],h=0;h<arguments.length;h++){k[h]=arguments[h]}for(var l=new Array(arguments.length),j=0;j<l.length;j++){l[j]=arguments[j]}var a=b.concat(l);return f.apply(null,a)}}),aF=function(a,b){var c=b.control.getRoot();ag(c),a.undoManager.transact(function(){var d=bo.merge(bB(a),c.toJSON());bG(a,d)}),a.editorUpload.uploadImagesAuto()};function bu(b){function a(g){var h,d,f=bB(b);if(g&&(d={type:"listbox",label:"Image list",name:"image-list",values:bt(g,function(i){i.value=b.convertURL(i.value||i.url,"src")},[{text:"None",value:""}]),value:f.src&&b.convertURL(f.src,"src"),onselect:function(j){var i=h.find("#alt");(!i.value()||j.lastControl&&i.value()===j.lastControl.text())&&i.value(j.control.text()),h.find("#src").value(j.control.value()).fire("change")},onPostRender:function(){d=this}}),aU(b)||au(b)||aQ(b)){var c=[bb(b,d)];aU(b)&&c.push(bz(b)),(au(b)||aQ(b))&&c.push(bK(b)),h=b.windowManager.open({title:"Insert/edit image",data:f,bodyType:"tabpanel",body:c,onSubmit:ac(aF,b)})}else{h=b.windowManager.open({title:"Insert/edit image",data:f,body:bH(b,d),onSubmit:ac(aF,b)})}bL(h)}return{open:function(){a5(b,a)}}}var by=function(a){a.addCommand("mceImage",bu(a).open)},bA=function(a){return function(f){for(var c,g,d=f.length,b=function(h){h.attr("contenteditable",a?"true":null)};d--;){c=f[d],(g=c.attr("class"))&&/\bimage\b/.test(g)&&(c.attr("contenteditable",a?"false":null),ar.each(c.getAll("figcaption"),b))}}},ad=function(a){a.on("preInit",function(){a.parser.addNodeFilter("figure",bA(!0)),a.serializer.addNodeFilter("figure",bA(!1))})},an=function(a){a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:bu(a).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),a.addMenuItem("image",{icon:"image",text:"Image",onclick:bu(a).open,context:"insert",prependToContext:!0})};aO.add("image",function(a){ad(a),an(a),by(a)})}();