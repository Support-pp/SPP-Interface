!function(){var A=function(b){var a=b,c=function(){return a};return{get:c,set:function(d){a=d},clone:function(){return A(c())}}},L=tinymce.util.Tools.resolve("tinymce.PluginManager"),B=tinymce.util.Tools.resolve("tinymce.util.Tools");function I(a){return a&&1===a.nodeType&&"false"===a.contentEditable}var w={findAndReplaceDOMText:function(V,m,b,T,x){var k,R,U,C,h,y,S=[],u=0;function W(d,a){if(a=a||0,!d[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}var f=d.index;if(0<a){var c=d[a];if(!c){throw new Error("Invalid capture group")}f+=d[0].indexOf(c),d[0]=c}return[f,f+d[0].length,[d[0]]]}if(U=m.ownerDocument,C=x.getBlockElements(),h=x.getWhiteSpaceElements(),y=x.getShortEndedElements(),R=function N(a){var c;if(3===a.nodeType){return a.data}if(h[a.nodeName]&&!C[a.nodeName]){return""}if(c="",I(a)){return"\n"}if((C[a.nodeName]||y[a.nodeName])&&(c+="\n"),a=a.firstChild){for(;c+=N(a),a=a.nextSibling;){}}return c}(m)){if(V.global){for(;k=V.exec(R);){S.push(W(k,T))}}else{k=R.match(V),S.push(W(k,T))}return S.length&&(u=S.length,function(Y,ad,p){var f,ab,X,g,Z=[],aa=0,v=Y,ae=ad.shift(),ac=0;Y:for(;;){if((C[v.nodeName]||y[v.nodeName]||I(v))&&aa++,3===v.nodeType&&(!ab&&v.length+aa>=ae[1]?(ab=v,g=ae[1]-aa):f&&Z.push(v),!f&&v.length+aa>ae[0]&&(f=v,X=ae[0]-aa),aa+=v.length),f&&ab){if(v=p({startNode:f,startNodeIndex:X,endNode:ab,endNodeIndex:g,innerNodes:Z,match:ae[2],matchIndex:ac}),aa-=ab.length-g,ab=f=null,Z=[],ac++,!(ae=ad.shift())){break}}else{if(h[v.nodeName]&&!C[v.nodeName]||!v.firstChild){if(v.nextSibling){v=v.nextSibling;continue}}else{if(!I(v)){v=v.firstChild;continue}}}for(;;){if(v.nextSibling){v=v.nextSibling;break}if(v.parentNode===Y){break Y}v=v.parentNode}}}(m,S,function(d){var a;if("function"!=typeof d){var c=d.nodeType?d:U.createElement(d);a=function(g,f){var i=c.cloneNode(!1);return i.setAttribute("data-mce-index",f),g&&i.appendChild(U.createTextNode(g)),i}}else{a=d}return function(af){var ak,Z,v,ai=af.startNode,ab=af.endNode,Y=af.matchIndex;if(ai===ab){var ag=ai;v=ag.parentNode,0<af.startNodeIndex&&(ak=U.createTextNode(ag.data.substring(0,af.startNodeIndex)),v.insertBefore(ak,ag));var ah=a(af.match[0],Y);return v.insertBefore(ah,ag),af.endNodeIndex<ag.length&&(Z=U.createTextNode(ag.data.substring(af.endNodeIndex)),v.insertBefore(Z,ag)),ag.parentNode.removeChild(ag),ah}ak=U.createTextNode(ai.data.substring(0,af.startNodeIndex)),Z=U.createTextNode(ab.data.substring(af.endNodeIndex));for(var aa=a(ai.data.substring(af.startNodeIndex),Y),al=[],aj=0,ae=af.innerNodes.length;aj<ae;++aj){var X=af.innerNodes[aj],ad=a(X.data,Y);X.parentNode.replaceChild(ad,X),al.push(ad)}var ac=a(ab.data.substring(0,af.endNodeIndex),Y);return(v=ai.parentNode).insertBefore(ak,ai),v.insertBefore(aa,ai),v.removeChild(ai),(v=ab.parentNode).insertBefore(ac,ab),v.insertBefore(Z,ab),v.removeChild(ab),ac}}(b))),u}}},J=function(b){var a=b.getAttribute("data-mce-index");return"number"==typeof a?""+a:a},F=function(b){var a=b.parentNode;b.firstChild&&a.insertBefore(b.firstChild,b),b.parentNode.removeChild(b)},D=function(g,d){var h,f=[];if((h=B.toArray(g.getBody().getElementsByTagName("span"))).length){for(var b=0;b<h.length;b++){var c=J(h[b]);null!==c&&c.length&&c===d.toString()&&f.push(h[b])}}return f},K=function(g,d,h){var f=d.get(),b=g.dom;(h=!1!==h)?f++:f--,b.removeClass(D(g,d.get()),"mce-match-marker-selected");var c=D(g,f);return c.length?(b.addClass(D(g,f),"mce-match-marker-selected"),g.selection.scrollIntoView(c[0]),f):-1},t=function(b,a){var c=a.parentNode;b.remove(a),b.isEmpty(c)&&b.remove(c)},s=function(b,a){var c=K(b,a,!0);-1!==c&&a.set(c)},P=function(b,a){var c=K(b,a,!1);-1!==c&&a.set(c)},l=function(b){var a=J(b);return null!==a&&0<a.length},q=function(k,v,g){var b,u,h,f;for(u=B.toArray(k.getBody().getElementsByTagName("span")),b=0;b<u.length;b++){var m=J(u[b]);null!==m&&m.length&&(m===v.get().toString()&&(h||(h=u[b].firstChild),f=u[b].firstChild),F(u[b]))}if(h&&f){var p=k.dom.createRng();return p.setStart(h,0),p.setEnd(f,f.data.length),!1!==g&&k.selection.setRng(p),p}},G=function(b,a){return 0<D(b,a.get()+1).length},z=function(b,a){return 0<D(b,a.get()-1).length},j={done:q,find:function(m,x,g,b,v){g=(g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"\\s"),g=v?"\\b"+g+"\\b":g;var k,f,p,u,h,y=(k=m,f=x,p=new RegExp(g,b?"g":"gi"),(h=k.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",u=k.getBody(),q(k,f,!1),w.findAndReplaceDOMText(p,u,h,!1,k.schema));return y&&(x.set(-1),x.set(K(m,x,!0))),y},next:s,prev:P,replace:function(v,R,h,b,C){var m,g,x,y,k,S,N=R.get();for(b=!1!==b,x=v.getBody(),g=B.grep(B.toArray(x.getElementsByTagName("span")),l),m=0;m<g.length;m++){var p=J(g[m]);if(y=k=parseInt(p,10),C||y===R.get()){for(h.length?(g[m].firstChild.nodeValue=h,F(g[m])):t(v.dom,g[m]);g[++m];){if((y=parseInt(J(g[m]),10))!==k){m--;break}t(v.dom,g[m])}b&&N--}else{k>R.get()&&g[m].setAttribute("data-mce-index",k-1)}}return R.set(N),b?(S=G(v,R),s(v,R)):(S=z(v,R),P(v,R)),!C&&S},hasNext:G,hasPrev:z},E=function(c,b){return{done:function(a){return j.done(c,b,a)},find:function(d,a,f){return j.find(c,b,d,a,f)},next:function(){return j.next(c,b)},prev:function(){return j.prev(c,b)},replace:function(d,a,f){return j.replace(c,b,d,a,f)}}},Q=function(b,k){var g,h={};function m(){f.statusbar.find("#next").disabled(!1===j.hasNext(b,k)),f.statusbar.find("#prev").disabled(!1===j.hasPrev(b,k))}function a(){b.windowManager.alert("Could not find the specified string.",function(){f.find("#find")[0].focus()})}b.undoManager.add(),g=B.trim(b.selection.getContent({format:"text"}));var f=b.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){b.focus(),j.done(b,k),b.undoManager.add()},onSubmit:function(o){var d,p,i,c;return o.preventDefault(),p=f.find("#case").checked(),c=f.find("#words").checked(),(i=f.find("#find").value()).length?h.text===i&&h.caseState===p&&h.wholeWord===c?j.hasNext(b,k)?(j.next(b,k),void m()):void a():((d=j.find(b,k,i,p,c))||a(),f.statusbar.items().slice(1).disabled(0===d),m(),void (h={text:i,caseState:p,wholeWord:c})):(j.done(b,k,!1),void f.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){f.submit()}},{text:"Replace",disabled:!0,onclick:function(){j.replace(b,k,f.find("#replace").value())||(f.statusbar.items().slice(1).disabled(!0),k.set(-1),h={})}},{text:"Replace all",disabled:!0,onclick:function(){j.replace(b,k,f.find("#replace").value(),!0,!0),f.statusbar.items().slice(1).disabled(!0),h={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){j.prev(b,k),m()}},{text:"Next",name:"next",disabled:!0,onclick:function(){j.next(b,k),m()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:g},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})},H=function(b,a){b.addCommand("SearchReplace",function(){Q(b,a)})},M=function(b,a){return function(){Q(b,a)}},O=function(b,a){b.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:M(b,a),separator:"before",context:"edit"}),b.addButton("searchreplace",{tooltip:"Find and replace",onclick:M(b,a)}),b.shortcuts.add("Meta+F","",M(b,a))};L.add("searchreplace",function(b){var a=A(-1);return H(b,a),O(b,a),E(b,a)})}();