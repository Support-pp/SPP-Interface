!function(){var ad=tinymce.util.Tools.resolve("tinymce.PluginManager"),K=function(a){return function(){return a}},W=(K(!1),K(!0),function(a){for(var d=[],b=1;b<arguments.length;b++){d[b-1]=arguments[b]}for(var g=new Array(arguments.length-1),f=1;f<arguments.length;f++){g[f-1]=arguments[f]}return function(){for(var l=[],h=0;h<arguments.length;h++){l[h]=arguments[h]}for(var m=new Array(arguments.length),c=0;c<m.length;c++){m[c]=arguments[c]}var i=g.concat(m);return a.apply(null,i)}}),V=tinymce.util.Tools.resolve("tinymce.util.Tools"),af=tinymce.util.Tools.resolve("tinymce.util.XHR"),ah=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Z=function(a){return a.getParam("template_cdate_classes","cdate")},N=function(a){return a.getParam("template_mdate_classes","mdate")},J=function(a){return a.getParam("template_selected_content_classes","selcontent")},U=function(a){return a.getParam("template_preview_replace_values")},X=function(a){return a.getParam("template_replace_values")},Q=function(a){return a.templates},ae=function(a){return a.getParam("template_cdate_format",a.getLang("template.cdate_format"))},ac=function(a){return a.getParam("template_mdate_format",a.getLang("template.mdate_format"))},ab=function(a){return a.getParam("template_popup_width",600)},aa=function(a){return Math.min(ah.DOM.getViewPort().h,a.getParam("template_popup_height",500))},B=function(b,a){if((b=""+b).length<a){for(var c=0;c<a-b.length;c++){b="0"+b}}return b},I=function(h,f,m){var d="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),g="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),b="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),i="January February March April May June July August September October November December".split(" ");return m=m||new Date,f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=f.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+m.getFullYear())).replace("%y",""+m.getYear())).replace("%m",B(m.getMonth()+1,2))).replace("%d",B(m.getDate(),2))).replace("%H",""+B(m.getHours(),2))).replace("%M",""+B(m.getMinutes(),2))).replace("%S",""+B(m.getSeconds(),2))).replace("%I",""+((m.getHours()+11)%12+1))).replace("%p",m.getHours()<12?"AM":"PM")).replace("%B",""+h.translate(i[m.getMonth()]))).replace("%b",""+h.translate(b[m.getMonth()]))).replace("%A",""+h.translate(g[m.getDay()]))).replace("%a",""+h.translate(d[m.getDay()]))).replace("%%","%")},z=function(b,c,a){return V.each(a,function(f,d){"function"==typeof f&&(f=f(d)),c=c.replace(new RegExp("\\{\\$"+d+"\\}","g"),f)}),c},ai=function(f,c){var b=f.dom,d=X(f);V.each(b.select("*",c),function(a){V.each(d,function(h,g){b.hasClass(a,g)&&"function"==typeof d[g]&&d[g](a)})})},ag=function(b,a){return new RegExp("\\b"+a+"\\b","g").test(b.className)},Y=function(a,b){return function(){var c=Q(a);"function"!=typeof c?"string"==typeof c?af.send({url:c,success:function(d){b(JSON.parse(d))}}):b(c):c(b)}},j=z,E=ai,q=function(f,h,m){var d,g,b=f.dom,i=f.selection.getContent();m=z(0,m,X(f)),d=b.create("div",null,m),(g=b.select(".mceTmpl",d))&&0<g.length&&(d=b.create("div",null)).appendChild(g[0].cloneNode(!0)),V.each(b.select("*",d),function(a){ag(a,Z(f).replace(/\s+/g,"|"))&&(a.innerHTML=I(f,ae(f))),ag(a,N(f).replace(/\s+/g,"|"))&&(a.innerHTML=I(f,ac(f))),ag(a,J(f).replace(/\s+/g,"|"))&&(a.innerHTML=i)}),ai(f,d),f.execCommand("mceInsertContent",!1,d.innerHTML),f.addVisual()},k=function(a){a.addCommand("mceInsertTemplate",W(q,a))},G=function(b){b.on("PreProcess",function(c){var a=b.dom,d=ac(b);V.each(a.select("div",c.node),function(f){a.hasClass(f,"mceTmpl")&&(V.each(a.select("*",f),function(g){a.hasClass(g,b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(g.innerHTML=I(b,d))}),E(b,f))})})},L=function(d,g,h){if(-1===h.indexOf("<html>")){var c="";V.each(d.contentCSS,function(a){c+='<link type="text/css" rel="stylesheet" href="'+d.documentBaseURI.toAbsolute(a)+'">'});var f=d.settings.body_class||"";-1!==f.indexOf("=")&&(f=(f=d.getParam("body_class","","hash"))[d.id]||""),h="<!DOCTYPE html><html><head>"+c+'</head><body class="'+f+'">'+h+"</body></html>"}h=j(d,h,U(d));var b=g.find("iframe")[0].getEl().contentWindow.document;b.open(),b.write(h),b.close()},F=function(h,g){var c,f,d=[];if(g&&0!==g.length){V.each(g,function(a){d.push({selected:!d.length,text:a.title,value:{url:a.url,content:a.content,description:a.description}})}),(c=h.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:d,onselect:function(i){var a=i.control.value();a.url?af.send({url:a.url,success:function(l){L(h,c,f=l)}}):(f=a.content,L(h,c,f)),c.find("#description")[0].text(i.control.value().description)}}}]},{type:"label",name:"description",label:"Description",text:"\xa0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){q(h,!1,f)},minWidth:ab(h),minHeight:aa(h)})).find("listbox")[0].fire("select")}else{var b=h.translate("No templates defined.");h.notificationManager.open({text:b,type:"info"})}},O=function(a){return function(b){F(a,b)}},R=function(a){a.addButton("template",{title:"Insert template",onclick:Y(a.settings,O(a))}),a.addMenuItem("template",{text:"Template",onclick:Y(a.settings,O(a)),icon:"template",context:"insert"})};ad.add("template",function(a){R(a),k(a),G(a)})}();