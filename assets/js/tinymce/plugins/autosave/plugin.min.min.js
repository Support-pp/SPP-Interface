!function(){var H=function(a){var c=a,b=function(){return c};return{get:b,set:function(d){c=d},clone:function(){return H(b())}}},A=tinymce.util.Tools.resolve("tinymce.PluginManager"),T=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),G=tinymce.util.Tools.resolve("tinymce.util.Tools"),E=function(a){return a.fire("RestoreDraft")},L=function(a){return a.fire("StoreDraft")},B=function(a){return a.fire("RemoveDraft")},P=function(a,b){return((a=/^(\d+)([ms]?)$/.exec(""+(a||b)))[2]?{s:1000,m:60000}[a[2]]:1)*parseInt(a,10)},z=function(a){return a.getParam("autosave_ask_before_unload",!0)},O=function(a){var b=a.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-");return b=(b=(b=(b=b.replace(/\{path\}/g,document.location.pathname)).replace(/\{query\}/g,document.location.search)).replace(/\{hash\}/g,document.location.hash)).replace(/\{id\}/g,a.id)},R=function(a){return P(a.settings.autosave_interval,"30s")},K=function(a){return P(a.settings.autosave_retention,"20m")},J=function(a,c){var b=a.settings.forced_root_block;return""===(c=G.trim(void 0===c?a.getBody().innerHTML:c))||new RegExp("^<"+b+"[^>]*>((\xa0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+b+">|<br>$","i").test(c)},x=function(a){var b=parseInt(T.getItem(O(a)+"time"),10)||0;return !((new Date).getTime()-b>K(a)&&(Q(a,!1),1))},Q=function(a,c){var b=O(a);T.removeItem(b+"draft"),T.removeItem(b+"time"),!1!==c&&B(a)},C=function(a){var b=O(a);!J(a)&&a.isDirty()&&(T.setItem(b+"draft",a.getContent({format:"raw",no_events:!0})),T.setItem(b+"time",(new Date).getTime().toString()),L(a))},N=function(a){var b=O(a);x(a)&&(a.setContent(T.getItem(b+"draft"),{format:"raw"}),E(a))},j={isEmpty:J,hasDraft:x,removeDraft:Q,storeDraft:C,restoreDraft:N,startStoreDraft:function(a,c){var b=R(a);c.get()||(setInterval(function(){a.removed||C(a)},b),c.set(!0))},restoreLastDraft:function(a){a.undoManager.transact(function(){N(a),Q(a)}),a.focus()}},F=function(b,a){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[a].concat(c))}},M=function(a){return{hasDraft:F(j.hasDraft,a),storeDraft:F(j.storeDraft,a),restoreDraft:F(j.restoreDraft,a),removeDraft:F(j.removeDraft,a),isEmpty:F(j.isEmpty,a)}},U=tinymce.util.Tools.resolve("tinymce.EditorManager");U._beforeUnloadHandler=function(){var a;return G.each(U.get(),function(b){b.plugins.autosave&&b.plugins.autosave.storeDraft(),!a&&b.isDirty()&&z(b)&&(a=b.translate("You have unsaved changes are you sure you want to navigate away?"))}),a};var S=function(a){window.onbeforeunload=U._beforeUnloadHandler},k=function(a,b){return function(c){var d=c.control;d.disabled(!j.hasDraft(a)),a.on("StoreDraft RestoreDraft RemoveDraft",function(){d.disabled(!j.hasDraft(a))}),j.startStoreDraft(a,b)}},q=function(a,b){a.addButton("restoredraft",{title:"Restore last draft",onclick:function(){j.restoreLastDraft(a)},onPostRender:k(a,b)}),a.addMenuItem("restoredraft",{text:"Restore last draft",onclick:function(){j.restoreLastDraft(a)},onPostRender:k(a,b),context:"file"})};A.add("autosave",function(a){var b=H(!1);return S(a),q(a,b),M(a)})}();