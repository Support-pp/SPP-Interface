!function(){var F=tinymce.util.Tools.resolve("tinymce.PluginManager"),G=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),k=tinymce.util.Tools.resolve("tinymce.EditorManager"),D=tinymce.util.Tools.resolve("tinymce.Env"),g=tinymce.util.Tools.resolve("tinymce.util.Tools"),z=function(a){return a.getParam("importcss_merge_classes")},A=function(a){return a.getParam("importcss_exclusive")},J=function(a){return a.getParam("importcss_selector_converter")},w=function(a){return a.getParam("importcss_selector_filter")},C=function(a){return a.getParam("importcss_groups")},m=function(a){return a.getParam("importcss_append")},B=function(a){return a.getParam("importcss_file_filter")},I=function(a){return"string"==typeof a?function(c){return -1!==c.indexOf(a)}:a instanceof RegExp?function(c){return a.test(c)}:a},E=function(h,l,a){var d=[],o={};function i(L,P){var x,f,K,M=L.href;if(f=M,K=D.cacheSuffix,"string"==typeof f&&(f=f.replace("?"+K,"").replace("&"+K,"")),(M=f)&&a(M,P)&&(v=M,O=(Q=h).settings,!(y=!1!==O.skin&&(O.skin||"lightgray"))||v!==(O.skin_url?Q.documentBaseURI.toAbsolute(O.skin_url):k.baseURL+"/skins/"+y)+"/content"+(Q.inline?".inline":"")+".min.css")){var Q,v,O,y;g.each(L.imports,function(n){i(n,!0)});try{x=L.cssRules||L.rules}catch(N){}g.each(x,function(n){n.styleSheet?i(n.styleSheet,!0):n.selectorText&&g.each(n.selectorText.split(","),function(r){d.push(g.trim(r))})})}}g.each(h.contentCSS,function(f){o[f]=!0}),a||(a=function(n,f){return f||o[n]});try{g.each(l.styleSheets,function(f){i(f)})}catch(c){}return d},j=function(l,d){var u,h=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(d);if(h){var a=h[1],o=h[2].substr(1).split(".").join(" "),f=g.makeMap("a,img");return h[1]?(u={title:d},l.schema.getTextBlockElements()[a]?u.block=a:l.schema.getBlockElements()[a]||f[a.toLowerCase()]?u.selector=a:u.inline=a):h[2]&&(u={inline:"span",title:d.substr(1),classes:o}),!1!==z(l)?u.classes=o:u.attributes={"class":o},u}},b=function(c,a){return null===a||!1!==A(c)},H=j,p=function(a){a.on("renderFormatsMenu",function(l){var f,i={},r=I(w(a)),d=l.control,h=(f=C(a),g.map(f,function(c){return g.extend({},c,{original:c,selectors:{},filter:I(c.filter),item:{text:c.title,menu:[]}})})),n=function(P,T){if(O=P,N=i,!(b(a,K=T)?O in N:O in K.selectors)){S=P,R=i,b(a,L=T)?R[S]=!0:L.selectors[S]=!0;var y=(Q=(M=a).plugins.importcss,U=P,((x=T)&&x.selector_converter?x.selector_converter:J(M)?J(M):function(){return j(M,U)}).call(Q,U,x));if(y){var v=y.name||G.DOM.uniqueId();return a.formatter.register(v,y),g.extend({},d.settings.itemDefaults,{text:y.title,format:v})}}var M,Q,U,x,S,L,R,O,K,N;return null};m(a)||d.items().remove(),g.each(E(a,l.doc||a.getDoc(),I(B(a))),function(v){if(-1===v.indexOf(".mce-")&&(!r||r(v))){var u=(s=h,c=v,g.grep(s,function(t){return !t.filter||t.filter(c)}));if(0<u.length){g.each(u,function(y){var x=n(v,y);x&&y.item.menu.push(x)})}else{var o=n(v,null);o&&d.add(o)}}var s,c}),g.each(h,function(c){0<c.item.menu.length&&d.add(c.item)}),l.control.renderNew()})},q=function(a){return{convertSelectorToFormat:function(c){return H(a,c)}}};F.add("importcss",function(a){return p(a),q(a)})}();