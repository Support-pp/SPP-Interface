!function(){var k=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=tinymce.util.Tools.resolve("tinymce.Env"),p=function(a){return parseInt(a.getParam("plugin_preview_width","650"),10)},q=function(a){return parseInt(a.getParam("plugin_preview_height","500"),10)},v=function(a){return a.getParam("content_style","")},o=tinymce.util.Tools.resolve("tinymce.util.Tools"),h=function(d){var x="",a=d.dom.encode,m=v(d);x+='<base href="'+a(d.documentBaseURI.getURI())+'">',m&&(x+='<style type="text/css">'+m+"</style>"),o.each(d.contentCSS,function(c){x+='<link type="text/css" rel="stylesheet" href="'+a(d.documentBaseURI.toAbsolute(c))+'">'});var s=d.settings.body_id||"tinymce";-1!==s.indexOf("=")&&(s=(s=d.getParam("body_id","","hash"))[d.id]||s);var l=d.settings.body_class||"";-1!==l.indexOf("=")&&(l=(l=d.getParam("body_class","","hash"))[d.id]||"");var w=d.settings.directionality?' dir="'+d.settings.directionality+'"':"";return"<!DOCTYPE html><html><head>"+x+'</head><body id="'+a(s)+'" class="mce-content-body '+a(l)+'"'+a(w)+">"+d.getContent()+'<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A") {e.preventDefault();}}}, false);<\/script> </body></html>'},g=function(d,c,m){var a=h(d);if(m){c.src="data:text/html;charset=utf-8,"+encodeURIComponent(a)}else{var l=c.contentWindow.document;l.open(),l.write(a),l.close()}},u=function(m){var c=!b.ie,d='<iframe src="" frameborder="0"'+(c?' sandbox="allow-scripts"':"")+"></iframe>",a=p(m),l=q(m);m.windowManager.open({title:"Preview",width:a,height:l,html:d,buttons:{text:"Close",onclick:function(i){i.control.parent().parent().close()}},onPostRender:function(n){var i=n.control.getEl("body").firstChild;g(m,i,c)}})},f=function(a){a.addCommand("mcePreview",function(){u(a)})},j=function(a){a.addButton("preview",{title:"Preview",cmd:"mcePreview"}),a.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",context:"view"})};k.add("preview",function(a){f(a),j(a)})}();