!function(){var x=function(a){var c=a,d=function(){return c};return{get:d,set:function(e){c=e},clone:function(){return x(d())}}},q=tinymce.util.Tools.resolve("tinymce.PluginManager"),B=function(a){return{setPatterns:function(c){a.set(c)},getPatterns:function(){return a.get()}}},I=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],L=function(a){return a.textpattern_patterns!==undefined?a.textpattern_patterns:I},A=tinymce.util.Tools.resolve("tinymce.util.Delay"),E=tinymce.util.Tools.resolve("tinymce.util.VK"),G=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),F=tinymce.util.Tools.resolve("tinymce.util.Tools"),C=function(a,c){for(var d=0;d<a.length;d++){if(0===c.indexOf(a[d].start)&&(!a[d].end||c.lastIndexOf(a[d].end)===c.length-a[d].end.length)){return a[d]}}},K=function(N,v,h,c){var M,g,p,O,y,u,m=N.sort(function(a,d){return a.start.length>d.start.length?-1:a.start.length<d.start.length?1:0});for(g=0;g<m.length;g++){if((M=m[g]).end!==undefined&&(O=M,y=h,u=c,v.substr(y-O.end.length-u,O.end.length)===O.end)&&0<h-c-(p=M).end.length-p.start.length){return M}}},w=function(N,v,h){if(!1!==v.collapsed){var c=v.startContainer,M=c.data,g=!0===h?1:0;if(3===c.nodeType){var p=K(N,M,v.startOffset,g);if(p!==undefined){var O=M.lastIndexOf(p.end,v.startOffset-g),y=M.lastIndexOf(p.start,O-p.end.length);if(O=M.indexOf(p.end,y+p.start.length),-1!==y){var u=document.createRange();u.setStart(c,y),u.setEnd(c,O+p.end.length);var m=C(N,u.toString());if(!(p===undefined||m!==p||c.data.length<=p.start.length+p.end.length)){return{pattern:p,startOffset:y,endOffset:O}}}}}}},J=function(d,g,h){var f=d.selection.getRng(!0),c=w(g,f,h);if(c){return function(e,p,m,l){var n=F.isArray(m.pattern.format)?m.pattern.format:[m.pattern.format];if(0!==F.grep(n,function(a){var i=e.formatter.get(a);return i&&i[0].inline}).length){return e.undoManager.transact(function(){var a,o,s,i;a=p,o=m.pattern,s=m.endOffset,i=m.startOffset,(a=0<i?a.splitText(i):a).splitText(s-i+o.end.length),a.deleteData(0,o.start.length),a.deleteData(a.data.length-o.end.length,o.end.length),p=a,n.forEach(function(r){e.formatter.apply(r,{},p)})}),p}}(d,f.startContainer,c)}},H=function(a,c){return J(a,c,!0)},D=function(a,c){return J(a,c,!1)},k=function(R,M){var m,g,P,h,v,S,N,y,p,O,Q;if(m=R.selection,g=R.dom,m.isCollapsed()&&(N=g.getParent(m.getStart(),"p"))){for(p=new G(N,N);v=p.next();){if(3===v.nodeType){h=v;break}}if(h){if(!(y=C(M,h.data))){return}if(P=(O=m.getRng(!0)).startContainer,Q=O.startOffset,h===P&&(Q=Math.max(0,Q-y.start.length)),F.trim(h.data).length===y.start.length){return}y.format&&(S=R.formatter.get(y.format))&&S[0].block&&(h.deleteData(0,y.start.length),R.formatter.apply(y.format,{},h),O.setStart(P,Q),O.collapse(!0),m.setRng(O)),y.cmd&&R.undoManager.transact(function(){h.deleteData(0,y.start.length),R.execCommand(y.cmd)})}}},z=function(a,d,f){for(var c=0;c<a.length;c++){if(f(a[c],d)){return !0}}},b={handleEnter:function(a,d){var f,c;(f=D(a,d))&&((c=a.dom.createRng()).setStart(f,f.data.length),c.setEnd(f,f.data.length),a.selection.setRng(c)),k(a,d)},handleInlineKey:function(f,h){var m,g,c,l,d;(m=H(f,h))&&(d=f.dom,g=m.data.slice(-1),/[\u00a0 ]/.test(g)&&(m.deleteData(m.data.length-1,1),c=d.doc.createTextNode(g),d.insertAfter(c,m.parentNode),(l=d.createRng()).setStart(c,1),l.setEnd(c,1),f.selection.setRng(l)))},checkCharCode:function(a,c){return z(a,c,function(d,f){return d.charCodeAt(0)===f.charCode})},checkKeyCode:function(a,c){return z(a,c,function(d,f){return d===f.keyCode&&!1===E.modifierPressed(f)})}},j=function(f,g){var d=[",",".",";",":","!","?"],c=[32];f.on("keydown",function(a){13!==a.keyCode||E.modifierPressed(a)||b.handleEnter(f,g.get())},!0),f.on("keyup",function(a){b.checkKeyCode(c,a)&&b.handleInlineKey(f,g.get())}),f.on("keypress",function(a){b.checkCharCode(d,a)&&A.setEditorTimeout(f,function(){b.handleInlineKey(f,g.get())})})};q.add("textpattern",function(a){var c=x(L(a.settings));return j(a,c),B(c)})}();