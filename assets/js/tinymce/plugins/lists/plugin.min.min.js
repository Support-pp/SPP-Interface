!function(){var aE=tinymce.util.Tools.resolve("tinymce.PluginManager"),aF=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),aw=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),at=tinymce.util.Tools.resolve("tinymce.util.VK"),aq=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),aj=tinymce.util.Tools.resolve("tinymce.util.Tools"),al=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),ar=function(a){return a&&"BR"===a.nodeName},an=function(a){return a&&3===a.nodeType},aA=function(a){return a&&/^(OL|UL|DL)$/.test(a.nodeName)},az=function(a){return a&&/^(LI|DT|DD)$/.test(a.nodeName)},aJ=function(a){return a&&/^(TH|TD)$/.test(a.nodeName)},bb=ar,am=function(a){return a.parentNode.firstChild===a},aG=function(a){return a.parentNode.lastChild===a},ag=function(b,a){return a&&!!b.schema.getTextBlockElements()[a.nodeName]},aD=function(b,a){return b&&b.nodeName in a},ak=function(b,a){return !!ar(a)&&!(!b.isBlock(a.nextSibling)||ar(a.previousSibling))},au=function(b,a,d){var c=b.isEmpty(a);return !(d&&0<b.select("span[data-mce-type=bookmark]",a).length)&&c},aC=function(b,a){return b.isChildOf(a,b.getRoot())},aY=function(b,a){var c=aF.getNode(b,a);return az(b)&&an(c)?{container:c,offset:a>=b.childNodes.length?c.data.length:0}:{container:b,offset:a}},a0=function(b){var a=b.cloneRange(),d=aY(b.startContainer,b.startOffset);a.setStart(d.container,d.offset);var c=aY(b.endContainer,b.endOffset);return a.setEnd(c.container,c.offset),a},aS=al.DOM,aI=function(b){var a={},c=function(f){var d,h,g;h=b[f?"startContainer":"endContainer"],g=b[f?"startOffset":"endOffset"],1===h.nodeType&&(d=aS.create("span",{"data-mce-type":"bookmark"}),h.hasChildNodes()?(g=Math.min(g,h.childNodes.length-1),f?h.insertBefore(d,h.childNodes[g]):aS.insertAfter(d,h.childNodes[g])):h.appendChild(d),h=d,g=0),a[f?"startContainer":"endContainer"]=h,a[f?"startOffset":"endOffset"]=g};return c(!0),b.collapsed||c(),a},a9=function(b){function c(f){var d,h,g;d=g=b[f?"startContainer":"endContainer"],h=b[f?"startOffset":"endOffset"],d&&(1===d.nodeType&&(h=function(j){for(var i=j.parentNode.firstChild,k=0;i;){if(i===j){return k}1===i.nodeType&&"bookmark"===i.getAttribute("data-mce-type")||k++,i=i.nextSibling}return -1}(d),d=d.parentNode,aS.remove(g),!d.hasChildNodes()&&aS.isBlock(d)&&d.appendChild(aS.create("br"))),b[f?"startContainer":"endContainer"]=d,b[f?"startOffset":"endOffset"]=h)}c(!0),c();var a=aS.createRng();return a.setStart(b.startContainer,b.startOffset),b.endContainer&&a.setEnd(b.endContainer,b.endOffset),a0(a)},ax=al.DOM,aR=function(b,a){var d,c=a.parentNode;"LI"===c.nodeName&&c.firstChild===a&&((d=c.previousSibling)&&"LI"===d.nodeName?(d.appendChild(a),au(b,c)&&ax.remove(c)):ax.setStyle(c,"listStyleType","none")),aA(c)&&(d=c.previousSibling)&&"LI"===d.nodeName&&d.appendChild(a)},a3=function(a,b){aj.each(aj.grep(a.select("ol,ul",b)),function(c){aR(a,c)})},bc=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),aT=function(b){var a=b.selection.getStart(!0);return b.dom.getParent(a,"OL,UL,DL",aW(b,a))},aW=function(b,a){var c=b.dom.getParents(a,"TD,TH");return 0<c.length?c[0]:b.getBody()},a8={getParentList:aT,getSelectedSubLists:function(d){var b,g,f,c=aT(d),a=d.selection.getSelectedBlocks();return f=a,(g=c)&&1===f.length&&f[0]===g?(b=c,aj.grep(b.querySelectorAll("ol,ul,dl"),function(h){return aA(h)})):aj.grep(a,function(h){return aA(h)&&c!==h})},getSelectedListItems:function(c){var f,a,d,b=c.selection.getSelectedBlocks();return aj.grep((f=c,a=b,d=aj.map(a,function(h){var g=f.dom.getParent(h,"li,dd,dt",aW(f,h));return g||h}),bc.unique(d)),function(g){return az(g)})},getClosestListRootElm:aW},bd=tinymce.util.Tools.resolve("tinymce.Env"),aV=al.DOM,ah=function(h,l,f){var c,b,g,k=aV.createFragment(),m=h.schema.getBlockElements();if(h.settings.forced_root_block&&(f=f||h.settings.forced_root_block),f&&((b=aV.create(f)).tagName===h.settings.forced_root_block&&aV.setAttribs(b,h.settings.forced_root_block_attrs),aD(l.firstChild,m)||k.appendChild(b)),l){for(;c=l.firstChild;){var j=c.nodeName;g||"SPAN"===j&&"bookmark"===c.getAttribute("data-mce-type")||(g=!0),aD(c,m)?(k.appendChild(c),b=null):f?(b||(b=aV.create(f),k.appendChild(b)),b.appendChild(c)):k.appendChild(c)}}return h.settings.forced_root_block?g||bd.ie&&!(10<bd.ie)||b.appendChild(aV.create("br",{"data-mce-bogus":"1"})):k.appendChild(aV.create("br")),k},aK=al.DOM,aZ=function(h,l,f,c){var b,g,k,m,j;for(k=aK.select('span[data-mce-type="bookmark"]',l),c=c||ah(h,f),(b=aK.createRng()).setStartAfter(f),b.setEndAfter(l),m=(g=b.extractContents()).firstChild;m;m=m.firstChild){if("LI"===m.nodeName&&h.dom.isEmpty(m)){aK.remove(m);break}}h.dom.isEmpty(g)||aK.insertAfter(g,l),aK.insertAfter(c,l),au(h.dom,f.parentNode)&&(j=f.parentNode,aj.each(k,function(a){j.parentNode.insertBefore(a,f.parentNode)}),aK.remove(j)),aK.remove(f),au(h.dom,l)&&aK.remove(l)},aQ=al.DOM,a5=function(b,a){au(b,a)&&aQ.remove(a)},bi=function(c,a){var f,d,b=a.parentNode;return b?(f=b.parentNode,b===c.getBody()||("DD"===a.nodeName?aQ.rename(a,"DT"):am(a)&&aG(a)?"LI"===f.nodeName?(aQ.insertAfter(a,f),a5(c.dom,f),aQ.remove(b)):aA(f)?aQ.remove(b,!0):(f.insertBefore(ah(c,a),b),aQ.remove(b)):am(a)?"LI"===f.nodeName?(aQ.insertAfter(a,f),a.appendChild(b),a5(c.dom,f)):aA(f)?f.insertBefore(a,b):(f.insertBefore(ah(c,a),b),aQ.remove(a)):aG(a)?"LI"===f.nodeName?aQ.insertAfter(a,f):aA(f)?aQ.insertAfter(a,b):(aQ.insertAfter(ah(c,a),b),aQ.remove(a)):("LI"===f.nodeName?(b=f,d=ah(c,a,"LI")):d=aA(f)?ah(c,a,"LI"):ah(c,a),aZ(c,b,a,d),a3(c.dom,b.parentNode)))):a5(c.dom,a),!0},ai=bi,a1=function(g){var d=a8.getSelectedListItems(g);if(d.length){var j=aI(g.selection.getRng()),h=void 0,f=void 0,c=a8.getClosestListRootElm(g,g.selection.getStart(!0));for(h=d.length;h--;){for(var b=d[h].parentNode;b&&b!==c;){for(f=d.length;f--;){if(d[f]===b){d.splice(h,1);break}}b=b.parentNode}}for(h=0;h<d.length&&(bi(g,d[h])||0!==h);h++){}return g.selection.setRng(a9(j)),g.nodeChanged(),!0}},aU=function(b,a){aj.each(a,function(d,c){b.setAttribute(c,d)})},aO=function(j,p,f){var c,b,h,m,q,k,g;c=j,b=p,m=(h=f)["list-style-type"]?h["list-style-type"]:null,c.setStyle(b,"list-style-type",m),q=j,aU(k=p,(g=f)["list-attributes"]),aj.each(q.select("li",k),function(a){aU(a,g["list-item-attributes"])})},ay=function(d,b,g,f){var c,a;for(c=b[g?"startContainer":"endContainer"],a=b[g?"startOffset":"endOffset"],1===c.nodeType&&(c=c.childNodes[Math.min(a,c.childNodes.length-1)]||c),!g&&bb(c.nextSibling)&&(c=c.nextSibling);c.parentNode!==f;){if(ag(d,c)){return c}if(/^(TD|TH)$/.test(c.parentNode.nodeName)){return c}c=c.parentNode}return c},ap=function(l,i,b){void 0===b&&(b={});var j,d=l.selection.getRng(!0),a="LI",k=a8.getClosestListRootElm(l,l.selection.getStart(!0)),h=l.dom;"false"!==h.getContentEditable(l.selection.getNode())&&("DL"===(i=i.toUpperCase())&&(a="DT"),j=aI(d),aj.each(function(g,q,f){for(var c,p=[],v=g.dom,w=ay(g,q,!0,f),x=ay(g,q,!1,f),u=[],m=w;m&&(u.push(m),m!==x);m=m.nextSibling){}return aj.each(u,function(o){if(ag(g,o)){return p.push(o),void (c=null)}if(v.isBlock(o)||bb(o)){return bb(o)&&v.remove(o),void (c=null)}var n=o.nextSibling;aq.isBookmarkNode(o)&&(ag(g,n)||!n&&o.parentNode===f)?c=null:(c||(c=v.create("p"),o.parentNode.insertBefore(c,o),p.push(c)),c.appendChild(o))}),p}(l,d,k),function(q){var w,g,f,c,p,v,x,u,m;(g=q.previousSibling)&&aA(g)&&g.nodeName===i&&(f=g,c=b,p=h.getStyle(f,"list-style-type"),v=c?c["list-style-type"]:"",p===(v=null===v?"":v))?(w=g,q=h.rename(q,a),g.appendChild(q)):(w=h.create(i),q.parentNode.insertBefore(w,q),w.appendChild(q),q=h.rename(q,a)),x=h,u=q,m=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],aj.each(m,function(o){return x.setStyle(u,((n={})[o]="",n));var n}),aO(h,w,b),af(l.dom,w)}),l.selection.setRng(a9(j)))},a7=function(d){var c=aI(d.selection.getRng(!0)),b=a8.getClosestListRootElm(d,d.selection.getStart(!0)),a=a8.getSelectedListItems(d),f=aj.grep(a,function(g){return d.dom.isEmpty(g)});a=aj.grep(a,function(g){return !d.dom.isEmpty(g)}),aj.each(f,function(g){au(d.dom,g)&&ai(d,g)}),aj.each(a,function(h){var g,i;if(h.parentNode!==d.getBody()){for(g=h;g&&g!==b;g=g.parentNode){aA(g)&&(i=g)}aZ(d,i,h),a3(d.dom,i.parentNode)}}),d.selection.setRng(a9(c))},aP=function(h,l,f){return j=f,(m=l)&&j&&aA(m)&&m.nodeName===j.nodeName&&(g=l,k=f,(b=h).getStyle(g,"list-style-type",!0)===b.getStyle(k,"list-style-type",!0))&&(c=f,l.className===c.className);var c,b,g,k,m,j},af=function(b,a){var d,c;if(d=a.nextSibling,aP(b,a,d)){for(;c=d.firstChild;){a.appendChild(c)}b.remove(d)}if(d=a.previousSibling,aP(b,a,d)){for(;c=d.lastChild;){a.insertBefore(c,a.firstChild)}b.remove(d)}},a6=function(b,d,g,f,c){if(d.nodeName!==f||a2(c)){var a=aI(b.selection.getRng(!0));aj.each([d].concat(g),function(h){!function(k,i,m,l){if(i.nodeName!==m){var j=k.rename(i,m);aO(k,j,l)}else{aO(k,i,l)}}(b.dom,h,f,c)}),b.selection.setRng(a9(a))}else{a7(b)}},a2=function(a){return"list-style-type" in a},aN={toggleList:function(c,a,f){var d=a8.getParentList(c),b=a8.getSelectedSubLists(c);f=f||{},d&&0<b.length?a6(c,d,b,a,f):function(i,g,k,j){if(g!==i.getBody()){if(g){if(g.nodeName!==k||a2(j)){var h=aI(i.selection.getRng(!0));aO(i.dom,g,j),af(i.dom,i.dom.rename(g,k)),i.selection.setRng(a9(h))}else{a7(i)}}else{ap(i,k,j)}}}(c,d,a,f)},removeList:a7,mergeWithAdjacentLists:af},aM=function(h,d,k,j){var g,c,b=d.startContainer,f=d.startOffset;if(3===b.nodeType&&(k?f<b.data.length:0<f)){return b}for(g=h.schema.getNonEmptyElements(),1===b.nodeType&&(b=aF.getNode(b,f)),c=new aw(b,j),k&&ak(h.dom,b)&&c.next();b=c[k?"next":"prev2"]();){if("LI"===b.nodeName&&!b.hasChildNodes()){return b}if(g[b.nodeName]){return b}if(3===b.nodeType&&0<b.data.length){return b}}},aL=function(b,a){var c=a.childNodes;return 1===c.length&&!aA(c[0])&&b.isBlock(c[0])},aa=function(g,d,j){var h,f,c,b;if(f=aL(g,j)?j.firstChild:j,aL(c=g,b=d)&&c.remove(b.firstChild,!0),!au(g,d,!0)){for(;h=d.firstChild;){f.appendChild(h)}}},ba=function(d,b,g){var f,c,a=b.parentNode;aC(d,b)&&aC(d,g)&&(aA(g.lastChild)&&(c=g.lastChild),a===g.lastChild&&bb(a.previousSibling)&&d.remove(a.previousSibling),(f=g.lastChild)&&bb(f)&&b.hasChildNodes()&&d.remove(f),au(d,g,!0)&&d.$(g).empty(),aa(d,b,g),c&&g.appendChild(c),d.remove(b),au(d,a)&&a!==d.getRoot()&&d.remove(a))},a4=function(h,l,f,c){var b,g,k,m=h.dom;if(m.isEmpty(c)){g=f,k=c,(b=h).dom.$(k).empty(),ba(b.dom,g,k),b.selection.setCursorLocation(k)}else{var j=aI(l);ba(m,f,c),h.selection.setRng(a9(j))}},aB=function(j,p){var f,c,b,h=j.dom,m=j.selection,q=m.getStart(),k=a8.getClosestListRootElm(j,q),g=h.getParent(m.getStart(),"LI",k);if(g){if((f=g.parentNode)===j.getBody()&&au(h,f)){return !0}if(c=a0(m.getRng(!0)),(b=h.getParent(aM(j,c,p,k),"LI",k))&&b!==g){return p?a4(j,c,b,g):function(s,d,v,u){var l=aI(d);ba(s.dom,v,u);var a=a9(l);s.selection.setRng(a)}(j,c,g,b),!0}if(!b&&!p&&aN.removeList(j)){return !0}}return !1},bl=function(b,a){return aB(b,a)||function(k,h){var f=k.dom,m=k.selection.getStart(),j=a8.getClosestListRootElm(k,m),n=f.getParent(m,f.isBlock,j);if(n&&f.isEmpty(n)){var g=a0(k.selection.getRng(!0)),c=f.getParent(aM(k,g,h,j),"LI",j);if(c){return k.undoManager.transact(function(){var i,d,p,l;d=n,p=j,l=(i=f).getParent(d.parentNode,i.isBlock,p),i.remove(d),l&&i.isEmpty(l)&&i.remove(l),aN.mergeWithAdjacentLists(f,c.parentNode),k.selection.select(c,!0),k.selection.collapse(h)}),!0}}return !1}(b,a)},av=function(c,a){return c.selection.isCollapsed()?bl(c,a):(d=(f=c).selection.getStart(),b=a8.getClosestListRootElm(f,d),!!(f.dom.getParent(d,"LI,DT,DD",b)||0<a8.getSelectedListItems(f).length)&&(f.undoManager.transact(function(){f.execCommand("Delete"),a3(f.dom,f.getBody())}),!0));var f,d,b},be=function(a){a.on("keydown",function(b){b.keyCode===at.BACKSPACE?av(a,!1)&&b.preventDefault():b.keyCode===at.DELETE&&av(a,!0)&&b.preventDefault()})},bh=av,ab=function(a){return{backspaceDelete:function(b){bh(a,b)}}},bk=al.DOM,ao=function(b,a){var c;if(aA(b)){for(;c=b.firstChild;){a.appendChild(c)}bk.remove(b)}},bj=function(h){var d,k,j,g,c=a8.getSelectedListItems(h);if(c.length){for(var b=aI(h.selection.getRng(!0)),f=0;f<c.length&&(d=c[f],g=j=k=void 0,("DT"===d.nodeName?(bk.rename(d,"DD"),1):(k=d.previousSibling)&&aA(k)?(k.appendChild(d),1):k&&"LI"===k.nodeName&&aA(k.lastChild)?(k.lastChild.appendChild(d),ao(d.lastChild,k.lastChild),1):(k=d.nextSibling)&&aA(k)?(k.insertBefore(d,k.firstChild),1):(k=d.previousSibling)&&"LI"===k.nodeName&&(j=bk.create(d.parentNode.nodeName),(g=bk.getStyle(d.parentNode,"listStyleType"))&&bk.setStyle(j,"listStyleType",g),k.appendChild(j),j.appendChild(d),ao(d.lastChild,j),1))||0!==f);f++){}return h.selection.setRng(a9(b)),h.nodeChanged(),!0}},aH=function(a,b){return function(){var c=a.dom.getParent(a.selection.getStart(),"UL,OL,DL");return c&&c.nodeName===b}},bg=function(a){a.on("BeforeExecCommand",function(c){var b,d=c.command.toLowerCase();if("indent"===d?bj(a)&&(b=!0):"outdent"===d&&a1(a)&&(b=!0),b){return a.fire("ExecCommand",{command:c.command}),c.preventDefault(),!0}}),a.addCommand("InsertUnorderedList",function(c,b){aN.toggleList(a,"UL",b)}),a.addCommand("InsertOrderedList",function(c,b){aN.toggleList(a,"OL",b)}),a.addCommand("InsertDefinitionList",function(c,b){aN.toggleList(a,"DL",b)}),a.addQueryStateHandler("InsertUnorderedList",aH(a,"UL")),a.addQueryStateHandler("InsertOrderedList",aH(a,"OL")),a.addQueryStateHandler("InsertDefinitionList",aH(a,"DL"))},bf=function(a){return a.getParam("lists_indent_on_tab",!0)},ac=function(b){var a;bf(b)&&(a=b).on("keydown",function(c){c.keyCode!==at.TAB||at.metaKeyPressed(c)||a.dom.getParent(a.selection.getStart(),"LI,DT,DD")&&(c.preventDefault(),c.shiftKey?a1(a):bj(a))}),be(b)},ad=function(b,a){return function(d){var c=d.control;b.on("NodeChange",function(g){var f=function(k,j){for(var l=0;l<k.length;l++){if(j(k[l])){return l}}return -1}(g.parents,aJ),i=-1!==f?g.parents.slice(0,f):g.parents,h=aj.grep(i,aA);c.active(0<h.length&&h[0].nodeName===a)})}},aX=function(c){var a,f,d,b;f="advlist",d=(a=c).settings.plugins?a.settings.plugins:"",-1===aj.inArray(d.split(/[ ,]/),f)&&(c.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:ad(c,"OL")}),c.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:ad(c,"UL")})),c.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:(b=c,function(g){var h=g.control;b.on("nodechange",function(){var j=a8.getSelectedListItems(b),i=0<j.length&&am(j[0]);h.disabled(i)})})})};aE.add("lists",function(a){return ac(a),aX(a),bg(a),ab(a)})}();