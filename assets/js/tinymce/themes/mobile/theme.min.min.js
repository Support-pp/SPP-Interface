!function(){var tk,tK,s1,tj,s5,tC,s0,tR,tO,s3=function(a){return function(){return a}},tI=s3(!1),ty=s3(!0),ub={noop:function(){for(var b=[],a=0;a<arguments.length;a++){b[a]=arguments[a]}},noarg:function(a){return function(){for(var c=[],b=0;b<arguments.length;b++){c[b]=arguments[b]}return a()}},compose:function(a,b){return function(){for(var d=[],c=0;c<arguments.length;c++){d[c]=arguments[c]}return a(b.apply(null,arguments))}},constant:s3,identity:function(a){return a},tripleEquals:function(b,a){return b===a},curry:function(c){for(var f=[],d=1;d<arguments.length;d++){f[d-1]=arguments[d]}for(var a=new Array(arguments.length-1),b=1;b<arguments.length;b++){a[b-1]=arguments[b]}return function(){for(var k=[],i=0;i<arguments.length;i++){k[i]=arguments[i]}for(var g=new Array(arguments.length),j=0;j<g.length;j++){g[j]=arguments[j]}var h=a.concat(g);return c.apply(null,h)}},not:function(a){return function(){for(var c=[],b=0;b<arguments.length;b++){c[b]=arguments[b]}return !a.apply(null,arguments)}},die:function(a){return function(){throw new Error(a)}},apply:function(a){return a()},call:function(a){a()},never:tI,always:ty},tL=function(a){return function(b){return function(d){if(null===d){return"null"}var c=typeof d;return"object"===c&&Array.prototype.isPrototypeOf(d)?"array":"object"===c&&String.prototype.isPrototypeOf(d)?"string":c}(b)===a}},uJ={isString:tL("string"),isObject:tL("object"),isArray:tL("array"),isNull:tL("null"),isBoolean:tL("boolean"),isUndefined:tL("undefined"),isFunction:tL("function"),isNumber:tL("number")},tv=function(a){return function(){for(var h=new Array(arguments.length),f=0;f<h.length;f++){h[f]=arguments[f]}if(0===h.length){throw new Error("Can't merge zero objects")}for(var c={},g=0;g<h.length;g++){var d=h[g];for(var b in d){d.hasOwnProperty(b)&&(c[b]=a(c[b],d[b]))}}return c}},tG=tv(function(b,a){return uJ.isObject(b)&&uJ.isObject(a)?tG(b,a):a}),s9=tv(function(b,a){return a}),uM={deepMerge:tG,merge:s9},tD=ub.never,sZ=ub.always,sW=function(){return tP},tP=(tj={fold:function(b,a){return b()},is:tD,isSome:tD,isNone:sZ,getOr:s1=function(a){return a},getOrThunk:tK=function(a){return a()},getOrDie:function(a){throw new Error(a||"error: getOrDie called on none.")},or:s1,orThunk:tK,map:sW,ap:sW,each:function(){},bind:sW,flatten:sW,exists:tD,forall:sZ,filter:sW,equals:tk=function(a){return a.isNone()},equals_:tk,toArray:function(){return[]},toString:ub.constant("none()")},Object.freeze&&Object.freeze(tj),tj),sY=function(a){var f=function(){return a},c=function(){return b},d=function(e){return e(a)},b={fold:function(h,g){return g(a)},is:function(e){return a===e},isSome:sZ,isNone:tD,getOr:f,getOrThunk:f,getOrDie:f,or:c,orThunk:c,map:function(e){return sY(e(a))},ap:function(e){return e.fold(sW,function(g){return sY(g(a))})},each:function(e){e(a)},bind:d,flatten:f,exists:d,forall:d,filter:function(e){return e(a)?b:tP},equals:function(e){return e.is(a)},equals_:function(h,g){return h.fold(tD,function(e){return g(a,e)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return b},sX={some:sY,none:sW,from:function(a){return null===a||a===undefined?tP:sY(a)}},t1=(s5=Object.keys)===undefined?function(c){var b=[];for(var a in c){c.hasOwnProperty(a)&&b.push(a)}return b}:s5,t3=function(g,d){for(var b=t1(g),f=0,c=b.length;f<c;f++){var a=b[f];d(g[a],a,g)}},tA=function(c,b){var a={};return t3(c,function(g,f){var d=b(g,f,c);a[d.k]=d.v}),a},uN=function(c,a){var b=[];return t3(c,function(f,d){b.push(a(f,d))}),b},uQ=function(a){return uN(a,function(b){return b})},uw={bifilter:function(d,a){var c={},b={};return t3(d,function(g,f){(a(g,f)?c:b)[f]=g}),{t:c,f:b}},each:t3,map:function(b,a){return tA(b,function(f,d,c){return{k:d,v:a(f,d,c)}})},mapToArray:uN,tupleMap:tA,find:function(h,f){for(var c=t1(h),g=0,d=c.length;g<d;g++){var b=c[g],a=h[b];if(f(a,b,h)){return sX.some(a)}}return sX.none()},keys:t1,values:uQ,size:function(a){return uQ(a).length}},uP=(ub.constant("contextmenu"),ub.constant("touchstart")),t5=ub.constant("touchmove"),uB=ub.constant("touchend"),uI=(ub.constant("gesturestart"),ub.constant("mousedown")),uk=ub.constant("mousemove"),tY=(ub.constant("mouseout"),ub.constant("mouseup")),uE=ub.constant("mouseover"),tB=(ub.constant("focusin"),ub.constant("keydown")),sV=ub.constant("input"),uy=ub.constant("change"),t9=(ub.constant("focus"),ub.constant("click")),tX=ub.constant("transitionend"),tZ=ub.constant("selectstart"),uG=function(c){var b,a=!1;return function(){return a||(a=!0,b=c.apply(null,arguments)),b}},u7=function(d,b){var a=function(i,g){for(var f=0;f<i.length;f++){var h=i[f];if(h.test(g)){return h}}return undefined}(d,b);if(!a){return{major:0,minor:0}}var c=function(e){return Number(b.replace(a,"$"+e))};return tT(c(1),c(2))},s7=function(){return tT(0,0)},tT=function(b,a){return{major:b,minor:a}},uz={nu:tT,detect:function(c,b){var a=String(b).toLowerCase();return 0===c.length?s7():u7(c,a)},unknown:s7},tW="Firefox",tV=function(b,a){return function(){return a===b}},uA=function(b){var a=b.current;return{current:a,version:b.version,isEdge:tV("Edge",a),isChrome:tV("Chrome",a),isIE:tV("IE",a),isOpera:tV("Opera",a),isFirefox:tV(tW,a),isSafari:tV("Safari",a)}},t7={unknown:function(){return uA({current:undefined,version:uz.unknown()})},nu:uA,edge:ub.constant("Edge"),chrome:ub.constant("Chrome"),ie:ub.constant("IE"),opera:ub.constant("Opera"),firefox:ub.constant(tW),safari:ub.constant("Safari")},tU="Windows",oZ="Android",sq="Solaris",lZ="FreeBSD",oI=function(b,a){return function(){return a===b}},nD=function(b){var a=b.current;return{current:a,version:b.version,isWindows:oI(tU,a),isiOS:oI("iOS",a),isAndroid:oI(oZ,a),isOSX:oI("OSX",a),isLinux:oI("Linux",a),isSolaris:oI(sq,a),isFreeBSD:oI(lZ,a)}},lb={unknown:function(){return nD({current:undefined,version:uz.unknown()})},nu:nD,windows:ub.constant(tU),ios:ub.constant("iOS"),android:ub.constant(oZ),linux:ub.constant("Linux"),osx:ub.constant("OSX"),solaris:ub.constant(sq),freebsd:ub.constant(lZ)},uY=(tC=Array.prototype.indexOf)===undefined?function(b,a){return rF(b,a)}:function(b,a){return tC.call(b,a)},tw=function(b,a){return -1<uY(b,a)},mO=function(g,d){for(var b=g.length,f=new Array(b),c=0;c<b;c++){var a=g[c];f[c]=d(a,c,g)}return f},rW=function(d,b){for(var a=0,c=d.length;a<c;a++){b(d[a],a,d)}},pO=function(c,b){for(var a=c.length-1;0<=a;a--){b(c[a],a,c)}},sK=function(g,d){for(var b=[],f=0,c=g.length;f<c;f++){var a=g[f];d(a,f,g)&&b.push(a)}return b},px=function(d,b){for(var a=0,c=d.length;a<c;a++){if(b(d[a],a,d)){return sX.some(a)}}return sX.none()},rF=function(d,b){for(var a=0,c=d.length;a<c;++a){if(d[a]===b){return a}}return -1},ob=Array.prototype.push,q7=function(d){for(var b=[],a=0,c=d.length;a<c;++a){if(!Array.prototype.isPrototypeOf(d[a])){throw new Error("Arr.flatten item "+a+" was not an array, input: "+d)}ob.apply(b,d[a])}return b},kC=function(d,b){for(var a=0,c=d.length;a<c;++a){if(!0!==b(d[a],a,d)){return !1}}return !0},ik=Array.prototype.slice,uq=uJ.isFunction(Array.from)?Array.from:function(a){return ik.call(a)},jN={map:mO,each:rW,eachr:pO,partition:function(h,f){for(var c=[],g=[],d=0,b=h.length;d<b;d++){var a=h[d];(f(a,d,h)?c:g).push(a)}return{pass:c,fail:g}},filter:sK,groupBy:function(f,h){if(0===f.length){return[]}for(var m=h(f[0]),d=[],b=[],g=0,l=f.length;g<l;g++){var k=f[g],j=h(k);j!==m&&(d.push(b),b=[]),m=j,b.push(k)}return 0!==b.length&&d.push(b),d},indexOf:function(c,b){var a=uY(c,b);return -1===a?sX.none():sX.some(a)},foldr:function(c,b,a){return pO(c,function(d){a=b(a,d)}),a},foldl:function(c,b,a){return rW(c,function(d){a=b(a,d)}),a},find:function(f,c){for(var a=0,d=f.length;a<d;a++){var b=f[a];if(c(b,a,f)){return sX.some(b)}}return sX.none()},findIndex:px,flatten:q7,bind:function(c,b){var a=mO(c,b);return q7(a)},forall:kC,exists:function(b,a){return px(b,a).isSome()},contains:tw,equal:function(b,a){return b.length===a.length&&kC(b,function(d,c){return d===a[c]})},reverse:function(b){var a=ik.call(b,0);return a.reverse(),a},chunk:function(f,c){for(var a=[],d=0;d<f.length;d+=c){var b=f.slice(d,d+c);a.push(b)}return a},difference:function(b,a){return sK(b,function(c){return !tw(a,c)})},mapToObject:function(g,d){for(var b={},f=0,c=g.length;f<c;f++){var a=g[f];b[String(a)]=d(a,f)}return b},pure:function(a){return[a]},sort:function(c,b){var a=ik.call(c,0);return a.sort(b),a},range:function(d,b){for(var a=[],c=0;c<d;c++){a.push(b(c))}return a},head:function(a){return 0===a.length?sX.none():sX.some(a[0])},last:function(a){return 0===a.length?sX.none():sX.some(a[a.length-1])},from:uq},i0=function(c,b){var a=String(b).toLowerCase();return jN.find(c,function(d){return d.search(a)})},c9=function(b,a){return i0(b,a).map(function(d){var c=uz.detect(d.versionRegexes,a);return{current:d.name,version:c}})},dH=function(b,a){return i0(b,a).map(function(d){var c=uz.detect(d.versionRegexes,a);return{current:d.name,version:c}})},p5=function(b,a){return a+b},lI=function(b,a){return b+a},e1=function(b,a){return b.substring(a)},j4=function(b,a){return b.substring(0,b.length-a)},kT=function(a){return""===a?sX.none():sX.some(a.substr(0,1))},m5=function(a){return""===a?sX.none():sX.some(a.substring(1))},fP=function(c,b,a){return""===b||!(c.length<b.length)&&c.substr(a,a+b.length)===b},mx=function(b,a){return fP(b,a,0)},dY=function(b,a){return fP(b,a,b.length-a.length)},g9={supplant:function(b,a){return b.replace(/\${([^{}]*)}/g,function(g,d){var c,f=a[d];return"string"==(c=typeof f)||"number"===c?f:g})},startsWith:mx,removeLeading:function(b,a){return mx(b,a)?e1(b,a.length):b},removeTrailing:function(b,a){return dY(b,a)?j4(b,a.length):b},ensureLeading:function(b,a){return mx(b,a)?b:p5(b,a)},ensureTrailing:function(b,a){return dY(b,a)?b:lI(b,a)},endsWith:dY,contains:function(b,a){return -1!==b.indexOf(a)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},lTrim:function(a){return a.replace(/^\s+/g,"")},rTrim:function(a){return a.replace(/\s+$/g,"")},capitalize:function(a){return kT(a).bind(function(b){return m5(a).map(function(c){return b.toUpperCase()+c})}).getOr(a)}},jx=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,fz=function(a){return function(b){return g9.contains(b,a)}},b6=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return g9.contains(a,"edge/")&&g9.contains(a,"chrome")&&g9.contains(a,"safari")&&g9.contains(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,jx],search:function(a){return g9.contains(a,"chrome")&&!g9.contains(a,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return g9.contains(a,"msie")||g9.contains(a,"trident")}},{name:"Opera",versionRegexes:[jx,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:fz("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:fz("firefox")},{name:"Safari",versionRegexes:[jx,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(g9.contains(a,"safari")||g9.contains(a,"mobile/"))&&g9.contains(a,"applewebkit")}}],hW=[{name:"Windows",search:fz("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return g9.contains(a,"iphone")||g9.contains(a,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:fz("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:fz("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:fz("linux"),versionRegexes:[]},{name:"Solaris",search:fz("sunos"),versionRegexes:[]},{name:"FreeBSD",search:fz("freebsd"),versionRegexes:[]}],qC={browsers:ub.constant(b6),oses:ub.constant(hW)},hG=function(k){var z,E,j,b,w,D,C,B,F,y,v,A=qC.browsers(),q=qC.oses(),x=c9(A,k).fold(t7.unknown,t7.nu),h=dH(q,k).fold(lb.unknown,lb.nu);return{browser:x,os:h,deviceType:(E=x,j=k,b=(z=h).isiOS()&&!0===/ipad/i.test(j),w=z.isiOS()&&!b,D=z.isAndroid()&&3===z.version.major,C=z.isAndroid()&&4===z.version.major,B=b||D||C&&!0===/mobile/i.test(j),F=z.isiOS()||z.isAndroid(),y=F&&!B,v=E.isSafari()&&z.isiOS()&&!1===/safari/i.test(j),{isiPad:ub.constant(b),isiPhone:ub.constant(w),isTablet:ub.constant(B),isPhone:ub.constant(y),isTouch:ub.constant(F),isAndroid:z.isAndroid,isiOS:z.isiOS,isWebView:ub.constant(v)})}},f6={detect:uG(function(){var a=navigator.userAgent;return hG(a)})},eL={tap:ub.constant("alloy.tap")},bQ=ub.constant("alloy.focus"),cT=ub.constant("alloy.blur.post"),iK=ub.constant("alloy.receive"),cD=ub.constant("alloy.execute"),nU=ub.constant("alloy.focus.item"),ax=eL.tap,gD=f6.detect().deviceType.isTouch()?eL.tap:t9,bA=ub.constant("alloy.longpress"),a3=(ub.constant("alloy.sandbox.close"),ub.constant("alloy.system.init")),gT=ub.constant("alloy.system.scroll"),ev=ub.constant("alloy.system.attached"),aN=ub.constant("alloy.system.detached"),o6=(ub.constant("alloy.change.tab"),ub.constant("alloy.dismiss.tab"),function(b,a){nK(b,b.element(),a,{})}),sB=function(c,b,a){nK(c,c.element(),b,a)},l8=function(a){o6(a,cD())},oP=function(c,b,a){nK(c,b,a,{})},nK=function(f,c,a,d){var b=uM.deepMerge({target:c},d);f.getSystem().triggerEvent(a,c,uw.map(b,ub.constant))},qX=function(a){if(null===a||a===undefined){throw new Error("Node cannot be null or undefined")}return{dom:ub.constant(a)}},lA={fromHtml:function(c,b){var a=(b||document).createElement("div");if(a.innerHTML=c,!a.hasChildNodes()||1<a.childNodes.length){throw console.error("HTML does not have a single root node",c),"HTML must have a single root node"}return qX(a.childNodes[0])},fromTag:function(c,b){var a=(b||document).createElement(c);return qX(a)},fromText:function(c,b){var a=(b||document).createTextNode(c);return qX(a)},fromDom:qX,fromPoint:function(c,b,a){return sX.from(c.dom().elementFromPoint(b,a)).map(qX)}},u5=8,tM=9,mX=1,r3=3,pV=function(a){return a.dom().nodeName.toLowerCase()},sR=function(a){return a.dom().nodeType},pE=function(a){return function(b){return sR(b)===a}},rM=pE(mX),oy=pE(r3),rv=pE(tM),kL={name:pV,type:sR,value:function(a){return a.dom().nodeValue},isElement:rM,isText:oy,isDocument:rv,isComment:function(a){return sR(a)===u5||"#comment"===pV(a)}},iC=uG(function(){return uK(lA.fromDom(document))}),uK=function(b){var a=b.dom().body;if(null===a||a===undefined){throw"Body is not available yet"}return lA.fromDom(a)},jW={body:iC,getBody:uK,inBody:function(b){var a=kL.isText(b)?b.dom().parentNode:b.dom();return a!==undefined&&null!==a&&a.ownerDocument.body.contains(a)}},i9=function(a){return a.slice(0).sort()},dx=function(b,a){throw new Error("All required keys ("+i9(b).join(", ")+") were not specified. Specified keys were: "+i9(a).join(", ")+".")},dO=function(a){throw new Error("Unsupported keys for object: "+i9(a).join(", "))},qj=function(a,b){if(!uJ.isArray(b)){throw new Error("The "+a+" fields must be an array. Was: "+b+".")}jN.each(b,function(c){if(!uJ.isString(c)){throw new Error("The value "+c+" in the "+a+" fields was not a string.")}})},lP=function(b,a){throw new Error("All values need to be of type: "+a+". Keys ("+i9(b).join(", ")+") were not.")},e8=function(b){var a=i9(b);jN.find(a,function(d,c){return c<a.length-1&&d===a[c+1]}).each(function(c){throw new Error("The field: "+c+" occurs more than once in the combined fields: ["+a.join(", ")+"].")})},kj={immutable:function(){for(var a=[],b=0;b<arguments.length;b++){a[b]=arguments[b]}return function(){for(var c=[],e=0;e<arguments.length;e++){c[e]=arguments[e]}if(a.length!==c.length){throw new Error('Wrong number of arguments to struct. Expected "['+a.length+']", got '+c.length+" arguments")}var d={};return jN.each(a,function(g,f){d[g]=ub.constant(c[f])}),d}},immutableBag:function(c,b){var a=c.concat(b);if(0===a.length){throw new Error("You must specify at least one required or optional field.")}return qj("required",c),qj("optional",b),e8(a),function(f){var d=uw.keys(f);jN.forall(c,function(e){return jN.contains(d,e)})||dx(c,d);var h=jN.filter(d,function(e){return !jN.contains(a,e)});0<h.length&&dO(h);var g={};return jN.each(c,function(e){g[e]=ub.constant(f[e])}),jN.each(b,function(e){g[e]=ub.constant(Object.prototype.hasOwnProperty.call(f,e)?sX.some(f[e]):sX.none())}),g}}},k0=function(f,c){for(var a=[],d=function(e){return a.push(e),c(e)},b=c(f);(b=b.bind(d)).isSome();){}return a},nk="undefined"!=typeof window?window:Function("return this;")(),fW=function(d,b){for(var a=b!==undefined&&null!==b?b:nk,c=0;c<d.length&&a!==undefined&&null!==a;++c){a=a[d[c]]}return a},mE=function(c,b){var a=c.split(".");return fW(a,b)},d4={getOrDie:function(c,b){var a=mE(c,b);if(a===undefined||null===a){throw c+" not available on this browser"}return a}},hw=mX,jD=tM,fF=function(a){return a.nodeType!==hw&&a.nodeType!==jD||0===a.childElementCount},cv={all:function(c,b){var a=b===undefined?document:b.dom();return fF(a)?[]:jN.map(a.querySelectorAll(c),lA.fromDom)},is:function(c,b){var a=c.dom();if(a.nodeType!==hw){return !1}if(a.matches!==undefined){return a.matches(b)}if(a.msMatchesSelector!==undefined){return a.msMatchesSelector(b)}if(a.webkitMatchesSelector!==undefined){return a.webkitMatchesSelector(b)}if(a.mozMatchesSelector!==undefined){return a.mozMatchesSelector(b)}throw new Error("Browser lacks native selectors")},one:function(c,b){var a=b===undefined?document:b.dom();return fF(a)?sX.none():sX.from(a.querySelector(c)).map(lA.fromDom)}},h2=function(b,a){return b.dom()===a.dom()},qI=(f6.detect().browser.isIE(),h2),hO=function(a){return lA.fromDom(a.dom().ownerDocument)},gk=function(b){var a=b.dom();return sX.from(a.parentNode).map(lA.fromDom)},eR=function(b){var a=b.dom();return sX.from(a.previousSibling).map(lA.fromDom)},bW=function(b){var a=b.dom();return sX.from(a.nextSibling).map(lA.fromDom)},cZ=function(b){var a=b.dom();return jN.map(a.childNodes,lA.fromDom)},iQ=function(c,b){var a=c.dom().childNodes;return sX.from(a[b]).map(lA.fromDom)},cJ=kj.immutable("element","offset"),n0={owner:hO,defaultView:function(b){var a=b.dom().ownerDocument.defaultView;return lA.fromDom(a)},documentElement:function(b){var a=hO(b);return lA.fromDom(a.dom().documentElement)},parent:gk,findIndex:function(a){return gk(a).bind(function(c){var b=cZ(c);return jN.findIndex(b,function(d){return qI(a,d)})})},parents:function(h,f){for(var c=uJ.isFunction(f)?f:ub.constant(!1),g=h.dom(),d=[];null!==g.parentNode&&g.parentNode!==undefined;){var b=g.parentNode,a=lA.fromDom(b);if(d.push(a),!0===c(a)){break}g=b}return d},siblings:function(a){return gk(a).map(cZ).map(function(b){return jN.filter(b,function(c){return !qI(a,c)})}).getOr([])},prevSibling:eR,offsetParent:function(b){var a=b.dom();return sX.from(a.offsetParent).map(lA.fromDom)},prevSiblings:function(a){return jN.reverse(k0(a,eR))},nextSibling:bW,nextSiblings:function(a){return k0(a,bW)},children:cZ,child:iQ,firstChild:function(a){return iQ(a,0)},lastChild:function(a){return iQ(a,a.dom().childNodes.length-1)},childNodesCount:function(a){return a.dom().childNodes.length},hasChildNodes:function(a){return a.dom().hasChildNodes()},leaf:function(c,b){var a=cZ(c);return 0<a.length&&b<a.length?cJ(a[b],0):cJ(c,b)}},aD=function(b,a){n0.parent(b).each(function(c){c.dom().insertBefore(a.dom(),b.dom())})},gJ=function(b,a){b.dom().appendChild(a.dom())},bG={before:aD,after:function(b,a){n0.nextSibling(b).fold(function(){n0.parent(b).each(function(c){gJ(c,a)})},function(c){aD(c,a)})},prepend:function(b,a){n0.firstChild(b).fold(function(){gJ(b,a)},function(c){b.dom().insertBefore(a.dom(),c.dom())})},append:gJ,appendAt:function(c,b,a){n0.child(c,a).fold(function(){gJ(c,b)},function(d){aD(d,b)})},wrap:function(b,a){aD(b,a),gJ(a,b)}},a9=function(a,b){jN.each(b,function(c){bG.before(a,c)})},gZ=function(a,b){jN.each(b,function(c){bG.append(a,c)})},eB=function(b){var a=b.dom();null!==a.parentNode&&a.parentNode.removeChild(a)},aT={empty:function(a){a.dom().textContent="",jN.each(n0.children(a),function(b){eB(b)})},remove:eB,unwrap:function(b){var a=n0.children(b);0<a.length&&a9(b,a),eB(b)}},oU=function(b){o6(b,aN());var a=b.components();jN.each(a,oU)},r8=function(b){var a=b.components();jN.each(a,r8),o6(b,ev())},lS=function(b,a){oD(b,a,bG.append)},oD=function(c,b,a){c.getSystem().addToWorld(b),a(c.element(),b.element()),jW.inBody(c.element())&&r8(b),c.syncComponents()},nw=function(a){oU(a),aT.remove(a.element()),a.getSystem().removeFromWorld(a)},qN=function(a){var b=n0.parent(a.element()).bind(function(c){return a.getSystem().getByDom(c).fold(sX.none,sX.some)});nw(a),b.each(function(c){c.syncComponents()})},k3=function(a){return{is:function(b){return a===b},isValue:ub.always,isError:ub.never,getOr:ub.constant(a),getOrThunk:ub.constant(a),getOrDie:ub.constant(a),or:function(b){return k3(a)},orThunk:function(b){return k3(a)},fold:function(c,b){return b(a)},map:function(b){return k3(b(a))},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return sX.some(a)}}},uT=function(a){return{is:ub.never,isValue:ub.never,isError:ub.always,getOr:ub.identity,getOrThunk:function(b){return b()},getOrDie:function(){return ub.die(String(a))()},or:function(b){return b},orThunk:function(b){return b()},fold:function(c,b){return c(a)},map:function(b){return uT(a)},each:ub.noop,bind:function(b){return uT(a)},exists:ub.never,forall:ub.always,toOption:sX.none}},s4={value:k3,error:uT},mH=function(c){if(!uJ.isArray(c)){throw new Error("cases must be an array")}if(0===c.length){throw new Error("there must be at least one case")}var b=[],d={};return jN.each(c,function(j,h){var g=uw.keys(j);if(1!==g.length){throw new Error("one and only one name per case")}var f=g[0],a=j[f];if(d[f]!==undefined){throw new Error("duplicate key detected:"+f)}if("cata"===f){throw new Error("cannot have a case named cata (sorry)")}if(!uJ.isArray(a)){throw new Error("case arguments must be an array")}b.push(f),d[f]=function(){var l=arguments.length;if(l!==a.length){throw new Error("Wrong number of arguments to case "+f+". Expected "+a.length+" ("+a+"), got "+l)}for(var i=new Array(l),k=0;k<i.length;k++){i[k]=arguments[k]}return{fold:function(){if(arguments.length!==c.length){throw new Error("Wrong number of arguments to fold. Expected "+c.length+", got "+arguments.length)}return arguments[h].apply(null,i)},match:function(o){var m=uw.keys(o);if(b.length!==m.length){throw new Error("Wrong number of arguments to match. Expected: "+b.join(",")+"\nActual: "+m.join(","))}if(!jN.forall(b,function(e){return jN.contains(m,e)})){throw new Error("Not all branches were specified when using match. Specified: "+m.join(", ")+"\nRequired: "+b.join(", "))}return o[f].apply(null,i)},log:function(e){console.log(e,{constructors:b,constructor:f,params:i})}}}}),d},rR=mH([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),pJ=function(a){return rR.defaultedThunk(ub.constant(a))},sG=rR.strict,pj=rR.asOption,rA=rR.defaultedThunk,n5=(rR.asDefaultedOptionThunk,rR.mergeWithThunk),q2=(mH([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(c){var b=[],a=[];return jN.each(c,function(d){d.fold(function(e){b.push(e)},function(e){a.push(e)})}),{errors:b,values:a}}),kv=function(a){return ub.compose(s4.error,jN.flatten)(a)},h5=function(f,c){var a,d,b=q2(f);return 0<b.errors.length?kv(b.errors):(a=b.values,d=c,s4.value(uM.deepMerge.apply(undefined,[d].concat(a))))},t2=function(b){var a=q2(b);return 0<a.errors.length?kv(a.errors):s4.value(a.values)},jG=function(a){return function(b){return b.hasOwnProperty(a)?sX.from(b[a]):sX.none()}},iT=function(b,a){return jG(a)(b)},c4=function(c,b){var a={};return a[c]=b,a},dC=function(f,c){return a=f,d=c,b={},jN.each(d,function(e){a[e]!==undefined&&a.hasOwnProperty(e)&&(b[e]=a[e])}),b;var a,d,b},p0=function(f,c){return a=f,d=c,b={},uw.each(a,function(h,g){jN.contains(d,g)||(b[g]=h)}),b;var a,d,b},lz=function(a){return jG(a)},eW=function(d,b){return a=d,c=b,function(e){return jG(a)(e).getOr(c)};var a,c},jV=function(b,a){return iT(b,a)},kK=function(b,a){return c4(b,a)},mW=function(c){return b=c,a={},jN.each(b,function(d){a[d.key]=d.value}),a;var b,a},fK=function(b,a){return h5(b,a)},l7=function(d,b){return c=b,(a=d).hasOwnProperty(c)&&a[c]!==undefined&&null!==a[c];var a,c},dT=mH([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),g4=mH([{field:["name","presence","type"]},{state:["name"]}]),i8=function(){return d4.getOrDie("JSON")},fq=function(c,b,a){return i8().stringify(c,b,a)},b1=function(a){return uJ.isObject(a)&&100<uw.keys(a).length?" removed due to size":fq(a,null,2)},hN=function(b,a){return s4.error([{path:b,getErrorInfo:a}])},qx=mH([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),hz=function(a,c,b){return iT(c,b).fold(function(){return f=b,d=c,hN(a,function(){return'Could not find valid *strict* value for "'+f+'" in '+b1(d)});var f,d},s4.value)},f1=function(d,b,a){var c=iT(d,b).fold(function(){return a(d)},ub.identity);return s4.value(c)},eG=function(d,b,f,e){return f.fold(function(g,h,k,c){var j=function(i){return c.extract(d.concat([g]),e,i).map(function(l){return c4(h,e(l))})},a=function(i){return i.fold(function(){var l=c4(h,e(sX.none()));return s4.value(l)},function(l){return c.extract(d.concat([g]),e,l).map(function(m){return c4(h,e(sX.some(m)))})})};return k.fold(function(){return hz(d,b,g).bind(j)},function(i){return f1(b,g,i).bind(j)},function(){return(l=b,i=g,s4.value(iT(l,i))).bind(a);var l,i},function(q){return(m=b,i=g,p=q,l=iT(m,i).map(function(o){return !0===o?p(m):o}),s4.value(l)).bind(a);var m,i,p,l},function(l){var i=l(b);return f1(b,g,ub.constant({})).map(function(m){return uM.deepMerge(i,m)}).bind(j)})},function(g,c){var a=c(b);return s4.value(c4(g,e(a)))})},bL=function(a){return{extract:function(b,d,c){return a(c,d).fold(function(g){return f=g,hN(b,function(){return f});var f},s4.value)},toString:function(){return"val"},toDsl:function(){return dT.itemOf(a)}}},cM=function(d){var b=iB(d),a=jN.foldr(d,function(c,f){return f.fold(function(e){return uM.deepMerge(c,kK(e,!0))},ub.constant(c))},{});return{extract:function(m,k,h){var l,j,g,f=uJ.isBoolean(h)?[]:(l=h,j=uw.keys(l),jN.filter(j,function(e){return l7(l,e)})),c=jN.filter(f,function(e){return !l7(a,e)});return 0===c.length?b.extract(m,k,h):(g=c,hN(m,function(){return"There are unsupported fields: ["+g.join(", ")+"] specified"}))},toString:b.toString,toDsl:b.toDsl}},iB=function(a){return{extract:function(k,h,f){return j=k,g=f,d=a,c=h,b=jN.map(d,function(e){return eG(j,g,e,c)}),h5(b,{});var j,g,d,c,b},toString:function(){return"obj{\n"+jN.map(a,function(b){return b.fold(function(g,d,c,f){return g+" -> "+f.toString()},function(d,c){return"state("+d+")"})}).join("\n")+"}"},toDsl:function(){return dT.objOf(jN.map(a,function(b){return b.fold(function(g,d,c,f){return g4.field(g,c,f)},function(d,c){return g4.state(d)})}))}}},cq=function(a){return{extract:function(b,d,f){var c=jN.map(f,function(h,g){return a.extract(b.concat(["["+g+"]"]),d,h)});return t2(c)},toString:function(){return"array("+a.toString()+")"},toDsl:function(){return dT.arrOf(a)}}},nP=function(c,b){return{extract:function(d,h,f){var j,g,a=uw.keys(f);return(j=d,g=a,cq(bL(c)).extract(j,ub.identity,g)).bind(function(k){var i=jN.map(k,function(e){return qx.field(e,e,sG(),b)});return iB(i).extract(d,h,f)})},toString:function(){return"setOf("+b.toString()+")"},toDsl:function(){return dT.setOf(c,b)}}},aj=ub.constant(bL(s4.value)),gy=(ub.compose(cq,iB),qx.state),bv=qx.field,aY=function(b,d,f,c,a){return jV(c,a).fold(function(){return h=c,g=a,hN(b,function(){return'The chosen schema: "'+g+'" did not exist in branches: '+b1(h)});var h,g},function(e){return iB(e).extract(b.concat(["branch: "+a]),d,f)})},gO=function(b,a){return{extract:function(d,c,f){return jV(f,b).fold(function(){return e=b,hN(d,function(){return'Choice schema did not contain choice key: "'+e+'"'});var e},function(e){return aY(d,c,f,a,e)})},toString:function(){return"chooseOn("+b+"). Possible values: "+uw.keys(a)},toDsl:function(){return dT.choiceOf(b,a)}}},d9=bL(s4.value),aI=function(d,b,a,c){return b.extract([d],a,c).fold(function(e){return s4.error({input:c,errors:e})},s4.value)},oY=function(c,b,a){return aI(c,b,ub.constant,a)},sk=function(a){return a.fold(function(b){throw new Error(nC(b))},ub.identity)},lY=function(d,b,a){return sk((c=a,aI(d,b,ub.identity,c)));var c},oH=function(c,b,a){return sk(oY(c,b,a))},nC=function(c){return"Errors: \n"+(b=c.errors,a=10<b.length?b.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):b,jN.map(a,function(d){return"Failed path: ("+d.path.join(" > ")+")\n"+d.getErrorInfo()}))+"\n\nInput object: "+b1(c.input);var b,a},qR=function(b,a){return gO(b,a)},k9=ub.constant(d9),uX=(s0=uJ.isFunction,tR="function",bL(function(b){var a=typeof b;return s0(b)?s4.value(b):s4.error("Expected type: "+tR+" but got: "+a)})),tq=function(a){return bv(a,a,sG(),aj())},mN=function(b,a){return bv(b,b,sG(),a)},rV=function(a){return mN(a,uX)},pN=function(b,a){return bv(b,b,sG(),iB(a))},pw=function(a){return bv(a,a,pj(),aj())},rE=function(b,a){return bv(b,b,pj(),iB(a))},n9=function(b,a){return bv(b,b,pj(),cM(a))},q6=function(b,a){return bv(b,b,pJ(a),aj())},kB=function(c,b,a){return bv(c,c,pJ(b),a)},ij=function(b,a){return gy(b,a)},uj=function(a){if(!l7(a,"can")&&!l7(a,"abort")&&!l7(a,"run")){throw new Error("EventHandler defined by: "+fq(a,null,2)+" does not have can, abort, or run!")}return lY("Extracting event.handler",cM([q6("can",ub.constant(!0)),q6("abort",ub.constant(!1)),q6("run",ub.noop)]),a)},jM=function(h){var f,g,d,c,b=(f=h,g=function(e){return e.can},function(){var e=Array.prototype.slice.call(arguments,0);return jN.foldl(f,function(j,i){return j&&g(i).apply(undefined,e)},!0)}),a=(d=h,c=function(e){return e.abort},function(){var e=Array.prototype.slice.call(arguments,0);return jN.foldl(d,function(j,i){return j||c(i).apply(undefined,e)},!1)});return uj({can:b,abort:a,run:function(){var i=Array.prototype.slice.call(arguments,0);jN.each(h,function(e){e.run.apply(undefined,i)})}})},iZ=mW,c8=function(b,a){return{key:b,value:uj({abort:a})}},dG=function(b,a){return{key:b,value:uj({run:a})}},p4=function(c,b,a){return{key:c,value:uj({run:function(d){b.apply(undefined,[d].concat(a))}})}},lH=function(a){return function(b){return{key:a,value:uj({run:function(f,d){var c;c=d,qI(f.element(),c.event().target())&&b(f,d)}})}}},e0=function(g,d,b){var a,f,c=d.partUids()[b];return f=c,dG(a=g,function(h,e){h.getSystem().getByUid(f).each(function(m){var k,i,l,j;i=(k=m).element(),l=a,j=e,k.getSystem().triggerEvent(l,i,j.event())})})},j3=function(a){return dG(a,function(c,b){b.cut()})},kS=lH(ev()),m4=lH(aN()),fO=lH(a3()),mw=(tO=cD(),function(a){return dG(tO,a)}),dX=function(a){return jN.map(a,function(b){return g9.endsWith(b,"/*")?b.substring(0,b.length-"/*".length):b})},g8=function(g,d){var b=g.toString(),f=b.indexOf(")")+1,c=b.indexOf("("),a=b.substring(c+1,f-1).split(/,\s*/);return g.toFunctionAnnotation=function(){return{name:d,parameters:dX(a)}},g},jw=kj.immutableBag(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),fy=function(a){return{tag:a.tag(),classes:a.classes().getOr([]),attributes:a.attributes().getOr({}),styles:a.styles().getOr({}),value:a.value().getOr("<none>"),innerHtml:a.innerHtml().getOr("<none>"),defChildren:a.defChildren().getOr("<none>"),domChildren:a.domChildren().fold(function(){return"<none>"},function(b){return 0===b.length?"0 children, but still specified":String(b.length)})}},b5=kj.immutableBag([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),hV=function(b,c,a){return c.fold(function(){return a.fold(function(){return{}},function(d){return kK(b,d)})},function(d){return a.fold(function(){return kK(b,d)},function(e){return kK(b,e)})})},qB=function(a,c,b){return fO(function(f,d){b(f,a,c)})},hF=function(f,h,m,d,b,g){var l,k,j=f,p=rE(h,[(l="config",k=f,bv(l,l,pj(),k))]);return bP(j,p,h,m,d,b,g)},f5=function(f,b,h){var m,d,g,l,k,j;return m=function(a){var c=arguments;return a.config({name:ub.constant(f)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+f+". Using API: "+h)},function(o){var i=Array.prototype.slice.call(c,1);return b.apply(undefined,[a,o.config,o.state].concat(i))})},d=h,g=b.toString(),l=g.indexOf(")")+1,k=g.indexOf("("),j=g.substring(k+1,l-1).split(/,\s*/),m.toFunctionAnnotation=function(){return{name:d,parameters:dX(j.slice(0,1).concat(j.slice(3)))}},m},eK=function(a){return{key:a,value:undefined}},bP=function(q,g,d,b,k,h,p){var m=function(a){return l7(a,d)?a[d]():sX.none()},l=uw.map(k,function(c,a){return f5(d,c,a)}),v=uw.map(h,function(c,a){return g8(c,a)}),j=uM.deepMerge(v,l,{revoke:ub.curry(eK,d),config:function(c){var a=oH(d+"-config",q,c);return{key:d,value:{config:a,me:j,configAsRaw:uG(function(){return lY(d+"-config",q,c)}),initialConfig:c,state:p}}},schema:function(){return g},exhibit:function(c,a){return m(c).bind(function(f){return jV(b,"exhibit").map(function(e){return e(a,f.config,f.state)})}).getOr(b5({}))},name:function(){return d},handlers:function(a){return m(a).bind(function(c){return jV(b,"events").map(function(e){return e(c.config,c.state)})}).getOr({})}});return j},cS=function(b,a){return iJ(b,a,{validate:uJ.isFunction,label:"function"})},iJ=function(c,b,a){if(0===b.length){throw new Error("You must specify at least one required field.")}return qj("required",b),e8(b),function(f){var d=uw.keys(f);jN.forall(b,function(e){return jN.contains(d,e)})||dx(b,d),c(b,d);var g=jN.filter(b,function(e){return !a.validate(f[e],e)});return 0<g.length&&lP(g,a.label),f}},cC=ub.noop,nT={exactly:ub.curry(cS,function(b,c){var a=jN.filter(c,function(d){return !jN.contains(b,d)});0<a.length&&dO(a)}),ensure:ub.curry(cS,cC),ensureWith:ub.curry(iJ,cC)},aw=nT.ensure(["readState"]),gC=function(){return aw({readState:function(){return"No State required"}})},bz=Object.freeze({init:gC}),a2=function(a){return mW(a)},gS=cM([tq("fields"),tq("name"),q6("active",{}),q6("apis",{}),q6("extra",{}),q6("state",bz)]),eq=function(f){var h,m,d,b,g,l,k,j,p=lY("Creating behaviour: "+f.name,gS,f);return h=p.fields,m=p.name,d=p.active,b=p.apis,g=p.extra,l=p.state,k=cM(h),j=rE(m,[n9("config",h)]),bP(k,j,m,d,b,g,l)},aM=cM([tq("branchKey"),tq("branches"),tq("name"),q6("active",{}),q6("apis",{}),q6("extra",{}),q6("state",bz)]),oW=ub.constant(undefined),sb=(ub.constant({}),ub.constant({}),ub.constant({}),ub.constant(bz));function lV(g,d,b){var f=b||!1,c=function(){d(),f=!0},a=function(){g(),f=!1};return{on:c,off:a,toggle:function(){(f?a:c)()},isOn:function(){return f}}}var oF=function(c,b,a){if(!(uJ.isString(a)||uJ.isBoolean(a)||uJ.isNumber(a))){throw console.error("Invalid call to Attr.set. Key ",b,":: Value ",a,":: Element ",c),new Error("Attribute value was not simple")}c.setAttribute(b,a+"")},nz=function(c,b,a){oF(c.dom(),b,a)},qP=function(c,b){var a=c.dom().getAttribute(b);return null===a?undefined:a},k6=function(c,b){var a=c.dom();return !(!a||!a.hasAttribute)&&a.hasAttribute(b)},uV={clone:function(a){return jN.foldl(a.dom().attributes,function(c,b){return c[b.name]=b.value,c},{})},set:nz,setAll:function(c,b){var a=c.dom();uw.each(b,function(f,d){oF(a,d,f)})},get:qP,has:k6,remove:function(b,a){b.dom().removeAttribute(a)},hasNone:function(b){var a=b.dom().attributes;return a===undefined||null===a||0===a.length},transfer:function(b,a,c){kL.isElement(b)&&kL.isElement(a)&&jN.each(c,function(h){var f,d,g;d=a,k6(f=b,g=h)&&!k6(d,g)&&nz(d,g,qP(f,g))})}},s8=function(c,b){var a=uV.get(c,b);return a===undefined||""===a?[]:a.split(" ")},mK=s8,rT=function(d,b,a){var c=s8(d,b).concat([a]);uV.set(d,b,c.join(" "))},pL=function(d,b,a){var c=jN.filter(s8(d,b),function(e){return e!==a});0<c.length?uV.set(d,b,c.join(" ")):uV.remove(d,b)},sI=function(a){return mK(a,"class")},pq=function(b,a){return rT(b,"class",a)},rC=function(b,a){return pL(b,"class",a)},n7=sI,q4=pq,ky=rC,h8=function(b,a){jN.contains(sI(b),a)?rC(b,a):pq(b,a)},t6=function(a){return a.dom().classList!==undefined},jJ=function(b,a){return t6(b)&&b.dom().classList.contains(a)},iW={add:function(b,a){t6(b)?b.dom().classList.add(a):q4(b,a)},remove:function(c,b){var a;t6(c)?c.dom().classList.remove(b):ky(c,b),0===(t6(a=c)?a.dom().classList:n7(a)).length&&uV.remove(a,"class")},toggle:function(b,a){return t6(b)?b.dom().classList.toggle(a):h8(b,a)},toggler:function(d,b){var a=t6(d),c=d.dom().classList;return lV(function(){a?c.remove(b):ky(d,b)},function(){a?c.add(b):q4(d,b)},jJ(d,b))},has:jJ},c6=function(c,b,a){iW.remove(c,a),iW.add(c,b)},dE=Object.freeze({toAlpha:function(c,b,a){c6(c.element(),b.alpha(),b.omega())},toOmega:function(c,b,a){c6(c.element(),b.omega(),b.alpha())},isAlpha:function(c,b,a){return iW.has(c.element(),b.alpha())},isOmega:function(c,b,a){return iW.has(c.element(),b.omega())},clear:function(c,b,a){iW.remove(c.element(),b.alpha()),iW.remove(c.element(),b.omega())}}),p2=[tq("alpha"),tq("omega")],lD=eq({fields:p2,name:"swapping",apis:dE}),eY=function(c){var b=c,a=function(){return b};return{get:a,set:function(d){b=d},clone:function(){return eY(a())}}};function jZ(f,c,a,d,b){return f(a,d)?sX.some(a):uJ.isFunction(b)&&b(a)?sX.none():c(a,d,b)}var kO=function(g,d,b){for(var f=g.dom(),c=uJ.isFunction(b)?b:ub.constant(!1);f.parentNode;){f=f.parentNode;var a=lA.fromDom(f);if(d(a)){return sX.some(a)}if(c(a)){break}}return sX.none()},m0=function(b,a){return jN.find(b.dom().childNodes,ub.compose(a,lA.fromDom)).map(lA.fromDom)},fM=function(c,b){var a=function(g){for(var f=0;f<g.childNodes.length;f++){if(b(lA.fromDom(g.childNodes[f]))){return sX.some(lA.fromDom(g.childNodes[f]))}var d=a(g.childNodes[f]);if(d.isSome()){return d}}return sX.none()};return a(c.dom())},mj={first:function(a){return fM(jW.body(),a)},ancestor:kO,closest:function(c,b,a){return jZ(function(d){return b(d)},kO,c,b,a)},sibling:function(b,a){var c=b.dom();return c.parentNode?m0(lA.fromDom(c.parentNode),function(d){return !qI(b,d)&&a(d)}):sX.none()},child:m0,descendant:fM},dV=function(a){a.dom().focus()},g6=function(b){var a=b!==undefined?b.dom():document;return sX.from(a.activeElement).map(lA.fromDom)},jj=function(b){var a=n0.owner(b).dom();return b.dom()===a.activeElement},fw=dV,b3=function(a){a.dom().blur()},hR=g6,qz=function(a){return g6(n0.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},hC=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),f3=tinymce.util.Tools.resolve("tinymce.ThemeManager"),eI=function(c){var b=document.createElement("a");b.target="_blank",b.href=c.href,b.rel="noreferrer noopener";var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(b),b.dispatchEvent(a),document.body.removeChild(b)},bN={formatChanged:ub.constant("formatChanged"),orientationChanged:ub.constant("orientationChanged"),dropupDismissed:ub.constant("dropupDismissed")},cP=function(c,b){var a=(b||document).createElement("div");return a.innerHTML=c,n0.children(lA.fromDom(a))},iF=function(a){return a.dom().innerHTML},cy=iF,nR=function(f,c){var a=n0.owner(f).dom(),d=lA.fromDom(a.createDocumentFragment()),b=cP(c,a);gZ(d,b),aT.empty(f),bG.append(f,d)},aq=function(c){var b=lA.fromTag("div"),a=lA.fromDom(c.dom().cloneNode(!0));return bG.append(b,a),iF(b)},gA=function(b,a){return lA.fromDom(b.dom().cloneNode(a))},bx=function(a){return gA(a,!1)},a0=function(b){return a=bx(b),aq(a);var a},gQ=Object.freeze({events:function(b){return iZ([dG(iK(),function(f,d){var j,g,a=b.channels(),c=uw.keys(a),h=(j=c,(g=d).universal()?j:jN.filter(j,function(e){return jN.contains(g.channels(),e)}));jN.each(h,function(m){var k=a[m](),i=k.schema(),l=oH("channel["+m+"] data\nReceiver: "+a0(f.element()),i,d.data());k.onReceive()(f,l)})})])}}),ej=function(d){for(var b=[],a=function(e){b.push(e)},c=0;c<d.length;c++){d[c].each(a)}return b},aK=function(d,b){for(var a=0;a<d.length;a++){var c=b(d[a],a);if(c.isSome()){return c}}return sX.none()},o2="unknown",sx=[],l2=["alloy/data/Fields","alloy/debugging/Debugging"],oL={logEventCut:ub.noop,logEventStopped:ub.noop,logNoParent:ub.noop,logEventNoHandlers:ub.noop,logEventResponse:ub.noop,write:ub.noop},nG=function(g,d,b){var f,c="*"===sx||jN.contains(sx,g)?(f=[],{logEventCut:function(j,i,h){f.push({outcome:"cut",target:i,purpose:h})},logEventStopped:function(j,i,h){f.push({outcome:"stopped",target:i,purpose:h})},logNoParent:function(j,i,h){f.push({outcome:"no-parent",target:i,purpose:h})},logEventNoHandlers:function(i,h){f.push({outcome:"no-handlers-left",target:h})},logEventResponse:function(j,i,h){f.push({outcome:"response",purpose:h,target:i})},write:function(){jN.contains(["mousemove","mouseover","mouseout",a3()],g)||console.log(g,{event:g,target:d.dom(),sequence:jN.map(f,function(e){return jN.contains(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+a0(e.target)+")":e.outcome})})}}):oL,a=b(c);return c.write(),a},qU=(ub.constant(oL),ub.constant(!0),ub.constant([tq("menu"),tq("selectedMenu")])),lq=ub.constant([tq("item"),tq("selectedItem")]),u1=(ub.constant(cM(lq().concat(qU()))),ub.constant(cM(lq()))),tE=pN("initSize",[tq("numColumns"),tq("numRows")]),mR=function(d,b,a){var c;return function(){var g=new Error;if(g.stack!==undefined){var f=g.stack.split("\n");jN.find(f,function(h){return 0<h.indexOf("alloy")&&!jN.exists(l2,function(e){return -1<h.indexOf(e)})}).getOr(o2)}}(),bv(b,b,a,(c=function(e){return s4.value(function(){return e.apply(undefined,arguments)})},bL(function(e){return c(e)})))},rZ=function(a){return mR(0,a,pJ(ub.noop))},pR=function(a){return mR(0,a,pJ(sX.none))},sN=function(a){return mR(0,a,sG())},pA=function(a){return mR(0,a,sG())},rI=function(b,a){return ij(b,ub.constant(a))},oq=function(a){return ij(a,ub.identity)},rb=ub.constant(tE),kF=[mN("channels",nP(s4.value,cM([sN("onReceive"),q6("schema",k9())])))],iw=eq({fields:kF,name:"receiving",active:gQ}),uC=function(d,b){var a=dK(d,b),c=b.aria();c.update()(d,c,a)},jQ=function(c,b,a){iW.toggle(c.element(),b.toggleClass()),uC(c,b)},i3=function(c,b,a){iW.add(c.element(),b.toggleClass()),uC(c,b)},dk=function(c,b,a){iW.remove(c.element(),b.toggleClass()),uC(c,b)},dK=function(b,a){return iW.has(b.element(),a.toggleClass())},p8=function(c,b,a){(b.selected()?i3:dk)(c,b,a)},lL=Object.freeze({onLoad:p8,toggle:jQ,isOn:dK,on:i3,off:dk}),e4=Object.freeze({exhibit:function(c,b,a){return b5({})},events:function(h,f){var c,g,d,b=(c=h,g=f,d=jQ,mw(function(e){d(e,c,g)})),a=qB(h,f,p8);return iZ(jN.flatten([h.toggleOnExecute()?[b]:[],[a]]))}}),j7=function(c,b,a){uV.set(c.element(),"aria-expanded",a)},kW=[q6("selected",!1),tq("toggleClass"),q6("toggleOnExecute",!0),kB("aria",{mode:"none"},qR("mode",{pressed:[q6("syncWithExpanded",!1),rI("update",function(c,b,a){uV.set(c.element(),"aria-pressed",a),b.syncWithExpanded()&&j7(c,b,a)})],checked:[rI("update",function(c,b,a){uV.set(c.element(),"aria-checked",a)})],expanded:[rI("update",j7)],selected:[rI("update",function(c,b,a){uV.set(c.element(),"aria-selected",a)})],none:[rI("update",ub.noop)]}))],m8=eq({fields:kW,name:"toggling",active:e4,apis:lL}),fS=function(a,b){return iw.config({channels:kK(bN.formatChanged(),{onReceive:function(d,c){c.command===a&&b(d,c.state)}})})},mA=function(a){return iw.config({channels:kK(bN.orientationChanged(),{onReceive:a})})},d1=function(b,a){return{key:b,value:{onReceive:a}}},hk="tinymce-mobile",jA={resolve:function(a){return hk+"-"+a},prefix:ub.constant(hk)},fC=function(b,a){a.ignore()||(fw(b.element()),a.onFocus()(b))},b9=Object.freeze({focus:fC,blur:function(b,a){a.ignore()||b3(b.element())},isFocused:function(a){return jj(a.element())}}),hZ=Object.freeze({exhibit:function(b,a){return a.ignore()?b5({}):b5({attributes:{tabindex:"-1"}})},events:function(a){return iZ([dG(bQ(),function(c,b){fC(c,a),b.stop()})])}}),qF=[rZ("onFocus"),q6("ignore",!1)],hJ=eq({fields:qF,name:"focusing",active:hZ,apis:b9}),f9=function(a){return a.style!==undefined},eO=function(c,b,a){if(!uJ.isString(a)){throw console.error("Invalid call to CSS.set. Property ",b,":: Value ",a,":: Element ",c),new Error("CSS value must be a string: "+a)}f9(c)&&c.style.setProperty(b,a)},bT=function(b,a){f9(b)&&b.style.removeProperty(a)},cW=function(d,b,a){var c=d.dom();eO(c,b,a)},iN=function(b,a){return f9(b)?b.style.getPropertyValue(a):""},cG=function(d,b){var a=d.dom(),c=iN(a,b);return sX.from(c).filter(function(e){return 0<e.length})},nX={copy:function(d,b){var a=d.dom(),c=b.dom();f9(a)&&f9(c)&&(c.style.cssText=a.style.cssText)},set:cW,preserve:function(d,b){var a=uV.get(d,"style"),c=b(d);return(a===undefined?uV.remove:uV.set)(d,"style",a),c},setAll:function(c,b){var a=c.dom();uw.each(b,function(f,d){eO(a,d,f)})},setOptions:function(c,b){var a=c.dom();uw.each(b,function(f,d){f.fold(function(){bT(a,d)},function(e){eO(a,d,e)})})},remove:function(c,b){var a=c.dom();bT(a,b),uV.has(c,"style")&&""===g9.trim(uV.get(c,"style"))&&uV.remove(c,"style")},get:function(f,c){var a=f.dom(),d=window.getComputedStyle(a).getPropertyValue(c),b=""!==d||jW.inBody(f)?d:iN(a,c);return null===b?undefined:b},getRaw:cG,getAllRaw:function(f){var c={},a=f.dom();if(f9(a)){for(var d=0;d<a.style.length;d++){var b=a.style.item(d);c[b]=a.style[b]}}return c},isValidValue:function(d,b,a){var c=lA.fromTag(d);return cW(c,b,a),cG(c,b).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(b,a,c){kL.isElement(b)&&kL.isElement(a)&&jN.each(c,function(g){var f,d;f=a,cG(b,d=g).each(function(e){cG(f,d).isNone()&&cW(f,d,e)})})}};function aA(c,b){var d=function(h){var g=b(h);if(g<=0||null===g){var f=nX.get(h,c);return parseFloat(f)||0}return g},a=function(e,f){return jN.foldl(f,function(j,h){var g=nX.get(e,h),i=g===undefined?0:parseInt(g,10);return isNaN(i)?j:j+i},0)};return{set:function(h,g){if(!uJ.isNumber(g)&&!g.match(/^[0-9]+$/)){throw c+".set accepts only positive integer values. Value was "+g}var f=h.dom();f9(f)&&(f.style[c]=g+"px")},get:d,getOuter:d,aggregate:a,max:function(i,g,f){var h=a(i,f);return h<g?g-h:0}}}var gG,bD,a6=aA("height",function(a){return jW.inBody(a)?a.dom().getBoundingClientRect().height:a.dom().offsetHeight}),gW=function(a){return a6.get(a)},ey=function(c,b,a){return jN.filter(n0.parents(c,a),b)},aQ=function(b,a){return jN.filter(n0.siblings(b),a)},oT=function(a){return cv.all(a)},r7=function(c,b,a){return ey(c,function(d){return cv.is(d,b)},a)},lQ=function(b,a){return aQ(b,function(c){return cv.is(c,a)})},oC=function(b,a){return cv.all(a,b)},nq=function(c,b,a){return mj.ancestor(c,function(d){return cv.is(d,b)},a)},qM=function(a){return cv.one(a)},k1=nq,uS=function(b,a){return cv.one(a,b)},s2=function(c,b,a){return jZ(cv.is,nq,c,b,a)},mF={BACKSPACE:ub.constant([8]),TAB:ub.constant([9]),ENTER:ub.constant([13]),SHIFT:ub.constant([16]),CTRL:ub.constant([17]),ALT:ub.constant([18]),CAPSLOCK:ub.constant([20]),ESCAPE:ub.constant([27]),SPACE:ub.constant([32]),PAGEUP:ub.constant([33]),PAGEDOWN:ub.constant([34]),END:ub.constant([35]),HOME:ub.constant([36]),LEFT:ub.constant([37]),UP:ub.constant([38]),RIGHT:ub.constant([39]),DOWN:ub.constant([40]),INSERT:ub.constant([45]),DEL:ub.constant([46]),META:ub.constant([91,93,224]),F10:ub.constant([121])},rQ=function(f,c,a){var d=jN.reverse(f.slice(0,c)),b=jN.reverse(f.slice(c+1));return jN.find(d.concat(b),a)},pI=function(d,b,a){var c=jN.reverse(d.slice(0,b));return jN.find(c,a)},sF=function(f,c,a){var d=f.slice(0,c),b=f.slice(c+1);return jN.find(b.concat(d),a)},pb=function(d,b,a){var c=d.slice(b+1);return jN.find(c,a)},rz=function(a){return function(b){return jN.contains(a,b.raw().which)}},n4=function(a){return function(b){return jN.forall(a,function(c){return c(b)})}},q1=function(a){return !0===a.raw().shiftKey},kk=function(a){return !0===a.raw().ctrlKey},h3=(ub.not(kk),ub.not(q1)),t0=function(b,a){return{matches:b,classification:a}},jE=function(f,c,a,d){var b=f+c;return d<b?a:b<a?d:b},iR=function(c,b,a){return c<=b?b:a<=c?a:c},c3=function(b,a,d){var c=oC(b.element(),"."+a.highlightClass());jN.each(c,function(e){iW.remove(e,a.highlightClass()),b.getSystem().getByDom(e).each(function(f){a.onDehighlight()(b,f)})})},dB=function(f,c,a,d){var b=pZ(f,c,a,d);c3(f,c),iW.add(d.element(),c.highlightClass()),b||c.onHighlight()(f,d)},pZ=function(d,b,a,c){return iW.has(c.element(),b.highlightClass())},ly=function(f,c,a,d){var b=oC(f.element(),"."+c.itemClass());return sX.from(b[d]).fold(function(){return s4.error("No element found with index "+d)},f.getSystem().getByDom)},eV=function(c,b,a){return uS(c.element(),"."+b.itemClass()).bind(c.getSystem().getByDom)},jU=function(d,b,a){var c=oC(d.element(),"."+b.itemClass());return(0<c.length?sX.some(c[c.length-1]):sX.none()).bind(d.getSystem().getByDom)},kJ=function(a,c,f,d){var b=oC(a.element(),"."+c.itemClass());return jN.findIndex(b,function(e){return iW.has(e,c.highlightClass())}).bind(function(h){var g=jE(h,d,0,b.length-1);return a.getSystem().getByDom(b[g])})},mV=Object.freeze({dehighlightAll:c3,dehighlight:function(f,c,a,d){var b=pZ(f,c,a,d);iW.remove(d.element(),c.highlightClass()),b&&c.onDehighlight()(f,d)},highlight:dB,highlightFirst:function(b,a,c){eV(b,a,c).each(function(d){dB(b,a,c,d)})},highlightLast:function(b,a,c){jU(b,a,c).each(function(d){dB(b,a,c,d)})},highlightAt:function(b,a,c,d){ly(b,a,c,d).fold(function(e){throw new Error(e)},function(e){dB(b,a,c,e)})},highlightBy:function(d,b,f,g){var c=oC(d.element(),"."+b.itemClass()),a=ej(jN.map(c,function(e){return d.getSystem().getByDom(e).toOption()}));jN.find(a,g).each(function(e){dB(d,b,f,e)})},isHighlighted:pZ,getHighlighted:function(c,b,a){return uS(c.element(),"."+b.highlightClass()).bind(c.getSystem().getByDom)},getFirst:eV,getLast:jU,getPrevious:function(c,b,a){return kJ(c,b,0,-1)},getNext:function(c,b,a){return kJ(c,b,0,1)}}),fJ=[tq("highlightClass"),tq("itemClass"),rZ("onHighlight"),rZ("onDehighlight")],l6=eq({fields:fJ,name:"highlighting",apis:mV}),dS=function(){return{get:function(a){return qz(a.element())},set:function(b,a){b.getSystem().triggerFocus(a,b.element())}}},g3=function(k,h,b,f,j,d){var c=function(q,m,s,p){var v,l,a=b(q,m,s,p);return(v=a,l=m.event(),jN.find(v,function(e){return e.matches(l)}).map(function(e){return e.classification})).bind(function(e){return e(q,m,s,p)})},g={schema:function(){return k.concat([q6("focusManager",dS()),rI("handler",g),rI("state",h)])},processKey:c,toEvents:function(l,a){var m=f(l,a),i=iZ(d.map(function(e){return dG(bQ(),function(p,o){e(p,l,a,o),o.stop()})}).toArray().concat([dG(tB(),function(p,o){c(p,o,l,a).each(function(e){o.stop()})})]));return uM.deepMerge(m,i)},toApis:j};return g},i7=function(l){var h=[pw("onEscape"),pw("onEnter"),q6("selector",'[data-alloy-tabstop="true"]'),q6("firstTabstop",0),q6("useTabstopAt",ub.constant(!0)),pw("visibilitySelector")].concat([l]),b=function(i,c){var a=i.visibilitySelector().bind(function(e){return s2(c,e)}).getOr(c);return 0<gW(a)},k=function(i,p,a,m,c){return c(p,a,function(r){return b(q=m,o=r)&&q.useTabstopAt()(o);var q,o}).fold(function(){return m.cyclic()?sX.some(!0):sX.none()},function(e){return m.focusManager().set(i,e),sX.some(!0)})},f=function(q,v,m,s){var p,c,a=oC(q.element(),m.selector());return(p=q,c=m,c.focusManager().get(p).bind(function(e){return s2(e,c.selector())})).bind(function(e){return jN.findIndex(a,ub.curry(qI,e)).bind(function(i){return k(q,a,i,m,s)})})},d=ub.constant([t0(n4([q1,rz(mF.TAB())]),function(p,i,a,m){var c=a.cyclic()?rQ:pI;return f(p,0,a,c)}),t0(rz(mF.TAB()),function(p,i,a,m){var c=a.cyclic()?sF:pb;return f(p,0,a,c)}),t0(rz(mF.ESCAPE()),function(c,a,m,i){return m.onEscape().bind(function(e){return e(c,a)})}),t0(n4([h3,rz(mF.ENTER())]),function(c,a,m,i){return m.onEnter().bind(function(e){return e(c,a)})})]),j=ub.constant({}),g=ub.constant({});return g3(h,gC,d,j,g,sX.some(function(q,m,v){var s,p,c,a;(s=q,p=m,c=oC(s.element(),p.selector()),a=jN.filter(c,function(e){return b(p,e)}),sX.from(a[p.firstTabstop()])).each(function(e){m.focusManager().set(q,e)})}))},fk=i7(ij("cyclic",ub.constant(!1))),b0=i7(ij("cyclic",ub.constant(!0))),hM=function(a){return"input"===kL.name(a)&&"radio"!==uV.get(a,"type")||"textarea"===kL.name(a)},qw=function(c,b,a){return hM(a)&&rz(mF.SPACE())(b.event())?sX.none():(oP(c,a,cD()),sX.some(!0))},hx=[q6("execute",qw),q6("useSpace",!1),q6("useEnter",!0),q6("useControlEnter",!1),q6("useDown",!1)],f0=function(d,b,a,c){return a.execute()(d,b,d.element())},eF=ub.constant({}),bK=ub.constant({}),cK=g3(hx,gC,function(k,h,f,j){var g=f.useSpace()&&!hM(k.element())?mF.SPACE():[],d=f.useEnter()?mF.ENTER():[],c=f.useDown()?mF.DOWN():[],b=g.concat(d).concat(c);return[t0(rz(b),f0)].concat(f.useControlEnter()?[t0(n4([kk,rz(mF.ENTER())]),f0)]:[])},eF,bK,sX.none()),iA=function(b){var a=eY(sX.none());return aw({readState:ub.constant({}),setGridSize:function(d,c){a.set(sX.some({numRows:ub.constant(d),numColumns:ub.constant(c)}))},getNumRows:function(){return a.get().map(function(c){return c.numRows()})},getNumColumns:function(){return a.get().map(function(c){return c.numColumns()})}})},ck=Object.freeze({flatgrid:iA,init:function(a){return a.state()(a)}}),nO=function(a){return"rtl"===nX.get(a,"direction")?"rtl":"ltr"},ab=function(b,a){return function(c){return"rtl"===nO(c)?a:b}},gx=function(a){return function(g,d,b,f){var c=a(g.element());return d8(c,g,d,b,f)}},bq=function(c,b){var a=ab(c,b);return gx(a)},aX=function(c,b){var a=ab(b,c);return gx(a)},gN=function(a){return function(f,c,b,d){return d8(a,f,c,b,d)}},d8=function(c,a,f,d,b){return d.focusManager().get(a).bind(function(e){return c(a.element(),e,d,b)}).map(function(e){return d.focusManager().set(a,e),!0})},aH=gN,o9=gN,sE=gN,mv=function(c){var b,a=c.dom();return !((b=a).offsetWidth<=0&&b.offsetHeight<=0)},oS=kj.immutableBag(["index","candidates"],[]),nN=function(c,b,a){return q0(c,b,a,mv)},q0=function(f,h,m,d){var b,g,l=ub.curry(qI,h),k=oC(f,m),j=jN.filter(k,mv);return b=j,g=l,jN.findIndex(b,g).map(function(a){return oS({index:a,candidates:b})})},lG=function(b,a){return jN.findIndex(b,function(c){return qI(a,c)})},u9=function(a,d,c,b){return b(Math.floor(d/c),d%c).bind(function(g){var f=g.row()*c+g.column();return 0<=f&&f<a.length?sX.some(a[f]):sX.none()})},tS=function(e,f,d,c,b){return u9(e,f,c,function(i,g){var a=i===d-1?e.length-i*c:c,h=jE(g,b,0,a-1);return sX.some({row:ub.constant(i),column:ub.constant(h)})})},m3=function(e,g,d,b,f){return u9(e,g,b,function(j,h){var a=jE(j,f,0,d-1),i=a===d-1?e.length-a*b:b,c=iR(h,0,i-1);return sX.some({row:ub.constant(a),column:ub.constant(c)})})},r6=[tq("selector"),q6("execute",qw),pR("onEscape"),q6("captureTab",!1),rb()],pY=function(a){return function(f,c,b,d){return nN(f,c,b.selector()).bind(function(e){return a(e.candidates(),e.index(),d.getNumRows().getOr(b.initSize().numRows()),d.getNumColumns().getOr(b.initSize().numColumns()))})}},sU=function(d,b,a,c){return a.captureTab()?sX.some(!0):sX.none()},pH=pY(function(d,b,a,c){return tS(d,b,a,c,-1)}),rP=pY(function(d,b,a,c){return tS(d,b,a,c,1)}),oB=pY(function(d,b,a,c){return m3(d,b,a,c,-1)}),ry=pY(function(d,b,a,c){return m3(d,b,a,c,1)}),kR=ub.constant([t0(rz(mF.LEFT()),bq(pH,rP)),t0(rz(mF.RIGHT()),aX(pH,rP)),t0(rz(mF.UP()),aH(oB)),t0(rz(mF.DOWN()),o9(ry)),t0(n4([q1,rz(mF.TAB())]),sU),t0(n4([h3,rz(mF.TAB())]),sU),t0(rz(mF.ESCAPE()),function(d,b,a,c){return a.onEscape()(d,b)}),t0(rz(mF.SPACE().concat(mF.ENTER())),function(d,b,f,g){return(c=d,a=f,a.focusManager().get(c).bind(function(e){return s2(e,a.selector())})).bind(function(e){return f.execute()(d,b,e)});var c,a})]),iI=ub.constant({}),uR=g3(r6,iA,kR,iI,{},sX.some(function(b,a,c){uS(b.element(),a.selector()).each(function(d){a.focusManager().set(b,d)})})),j2=function(d,c,a,b){return nN(d,a,c).bind(function(i){var g=i.index(),f=i.candidates(),h=jE(g,b,0,f.length-1);return sX.from(f[h])})},jv=[tq("selector"),q6("getInitial",sX.none),q6("execute",qw),q6("executeOnMove",!1)],dA=function(c,a,d){return(f=c,b=d,b.focusManager().get(f).bind(function(e){return s2(e,b.selector())})).bind(function(e){return d.execute()(c,a,e)});var f,b},dR=function(c,b,a){return j2(c,a.selector(),b,-1)},qv=function(c,b,a){return j2(c,a.selector(),b,1)},lW=function(a){return function(d,c,b){return a(d,c,b).bind(function(){return b.executeOnMove()?dA(d,c,b):sX.some(!0)})}},fj=ub.constant({}),kz=ub.constant({}),k7=g3(jv,gC,function(a){return[t0(rz(mF.LEFT().concat(mF.UP())),lW(bq(dR,qv))),t0(rz(mF.RIGHT().concat(mF.DOWN())),lW(aX(dR,qv))),t0(rz(mF.ENTER()),dA),t0(rz(mF.SPACE()),dA)]},fj,kz,sX.some(function(b,a){a.getInitial()(b).or(uS(b.element(),a.selector())).each(function(c){a.focusManager().set(b,c)})})),nA=kj.immutableBag(["rowIndex","columnIndex","cell"],[]),fZ=function(c,b,a){return sX.from(c[b]).bind(function(d){return sX.from(d[a]).map(function(e){return nA({rowIndex:b,columnIndex:a,cell:e})})})},mL=function(g,d,b,f){var c=g[d].length,a=jE(b,f,0,c-1);return fZ(g,d,a)},d7=function(h,f,c,g){var d=jE(c,g,0,h.length-1),b=h[d].length,a=iR(f,0,b-1);return fZ(h,d,a)},hD=function(g,d,b,f){var c=g[d].length,a=iR(b+f,0,c-1);return fZ(g,d,a)},jK=function(h,f,c,g){var d=iR(c+g,0,h.length-1),b=h[d].length,a=iR(f,0,b-1);return fZ(h,d,a)},fI=[pN("selectors",[tq("row"),tq("cell")]),q6("cycles",!0),q6("previousSelector",sX.none),q6("execute",qw)],cB=function(b,a){return function(e,f,d){var c=d.cycles()?b:a;return s2(f,d.selectors().row()).bind(function(h){var g=oC(h,d.selectors().cell());return lG(g,f).bind(function(k){var j=oC(e,d.selectors().row());return lG(j,h).bind(function(p){var l,i,m=(l=j,i=d,jN.map(l,function(o){return oC(o,i.selectors().cell())}));return c(m,p,k).map(function(o){return o.cell()})})})})}},h9=cB(function(c,b,a){return mL(c,b,a,-1)},function(c,b,a){return hD(c,b,a,-1)}),qL=cB(function(c,b,a){return mL(c,b,a,1)},function(c,b,a){return hD(c,b,a,1)}),hU=cB(function(c,b,a){return d7(c,a,b,-1)},function(c,b,a){return jK(c,a,b,-1)}),gw=cB(function(c,b,a){return d7(c,a,b,1)},function(c,b,a){return jK(c,a,b,1)}),eU=ub.constant([t0(rz(mF.LEFT()),bq(h9,qL)),t0(rz(mF.RIGHT()),aX(h9,qL)),t0(rz(mF.UP()),aH(hU)),t0(rz(mF.DOWN()),o9(gw)),t0(rz(mF.SPACE().concat(mF.ENTER())),function(b,a,c){return qz(b.element()).bind(function(d){return c.execute()(b,a,d)})})]),bZ=ub.constant({}),c2=ub.constant({}),iX=g3(fI,gC,eU,bZ,c2,sX.some(function(b,a){a.previousSelector()(b).orThunk(function(){var c=a.selectors();return uS(b.element(),c.cell())}).each(function(c){a.focusManager().set(b,c)})})),cQ=[tq("selector"),q6("execute",qw),q6("moveOnTab",!1)],n3=function(b,a,c){return c.focusManager().get(b).bind(function(d){return c.execute()(b,a,d)})},aG=function(c,b,a){return j2(c,a.selector(),b,-1)},gM=function(c,b,a){return j2(c,a.selector(),b,1)},bJ=ub.constant([t0(rz(mF.UP()),sE(aG)),t0(rz(mF.DOWN()),sE(gM)),t0(n4([q1,rz(mF.TAB())]),function(c,b,a){return a.moveOnTab()?sE(aG)(c,b,a):sX.none()}),t0(n4([h3,rz(mF.TAB())]),function(c,b,a){return a.moveOnTab()?sE(gM)(c,b,a):sX.none()}),t0(rz(mF.ENTER()),n3),t0(rz(mF.SPACE()),n3)]),bk=ub.constant({}),g2=ub.constant({}),eE=g3(cQ,gC,bJ,bk,g2,sX.some(function(b,a,c){uS(b.element(),a.selector()).each(function(d){a.focusManager().set(b,d)})})),aW=[pR("onSpace"),pR("onEnter"),pR("onShiftEnter"),pR("onLeft"),pR("onRight"),pR("onTab"),pR("onShiftTab"),pR("onUp"),pR("onDown"),pR("onEscape"),pw("focusIn")],o8=ub.constant({}),sD=ub.constant({}),mk=g3(aW,gC,function(c,b,a){return[t0(rz(mF.SPACE()),a.onSpace()),t0(n4([h3,rz(mF.ENTER())]),a.onEnter()),t0(n4([q1,rz(mF.ENTER())]),a.onShiftEnter()),t0(n4([q1,rz(mF.TAB())]),a.onShiftTab()),t0(n4([h3,rz(mF.TAB())]),a.onTab()),t0(rz(mF.UP()),a.onUp()),t0(rz(mF.DOWN()),a.onDown()),t0(rz(mF.LEFT()),a.onLeft()),t0(rz(mF.RIGHT()),a.onRight()),t0(rz(mF.SPACE()),a.onSpace()),t0(rz(mF.ESCAPE()),a.onEscape())]},o8,sD,sX.some(function(b,a){return a.focusIn().bind(function(c){return c(b,a)})})),oR={acyclic:fk.schema(),cyclic:b0.schema(),flow:k7.schema(),flatgrid:uR.schema(),matrix:iX.schema(),execution:cK.schema(),menu:eE.schema(),special:mk.schema()},nM=(bD=lY("Creating behaviour: "+(gG={branchKey:"mode",branches:oR,name:"keying",active:{events:function(b,a){return b.handler().toEvents(b,a)}},apis:{focusIn:function(a){a.getSystem().triggerFocus(a.element(),a.element())},setGridSize:function(f,c,a,d,b){l7(a,"setGridSize")?a.setGridSize(d,b):console.error("Layout does not support setGridSize")}},state:ck}).name,aM,gG),hF(qR(bD.branchKey,bD.branches),bD.name,bD.active,bD.apis,bD.extra,bD.state)),qZ=function(d,f){return c=d,a={},b=jN.map(f,function(i){return h=i.name(),g="Cannot configure "+i.name()+" for "+d,bv(h,h,pj(),bL(function(e){return s4.error("The field: "+h+" is forbidden. "+g)}));var h,g}).concat([ij("dump",ub.identity)]),bv(c,c,pJ(a),iB(b));var c,a,b},lE=function(a){return a.dump()},u8="placeholder",tQ=mH([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),m1=function(h,f,c,g){return c.uiType===u8?(b=c,a=g,(d=h).exists(function(e){return e!==b.owner})?tQ.single(!0,ub.constant(b)):jV(a,b.name).fold(function(){throw new Error("Unknown placeholder component: "+b.name+"\nKnown: ["+uw.keys(a)+"]\nNamespace: "+d.getOr("none")+"\nSpec: "+fq(b,null,2))},function(e){return e.replace()})):tQ.single(!1,ub.constant(c));var d,b,a},r5=function(e,d,b,f){return m1(e,0,b,f).fold(function(i,g){var a=g(d,b.config,b.validated),h=jV(a,"components").getOr([]),c=jN.bind(h,function(j){return r5(e,d,j,f)});return[uM.deepMerge(a,{components:c})]},function(c,a){return a(d,b.config,b.validated)})},pX=function(h,m,f,d){var b,g,l,k,j=uw.map(d,function(s,i){return a=i,q=s,c=!1,{name:ub.constant(a),required:function(){return q.fold(function(r,o){return r},function(r,o){return r})},used:function(){return c},replace:function(){if(!0===c){throw new Error("Trying to use the same placeholder more than once: "+a)}return c=!0,q}};var a,q,c}),p=(b=h,g=m,l=f,k=j,jN.bind(l,function(a){return r5(b,g,a,k)}));return uw.each(j,function(a){if(!1===a.used()&&a.required()){throw new Error("Placeholder: "+a.name()+" was not found in components list\nNamespace: "+h.getOr("none")+"\nComponents: "+fq(m.components(),null,2))}}),p},sT=tQ.single,pG=tQ.multiple,rO=ub.constant(u8),oA=0,rx=function(b){var a=(new Date).getTime();return b+"_"+Math.floor(1000000000*Math.random())+ ++oA+String(a)},kP=mH([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),iG=q6("factory",{sketch:ub.identity}),uO=q6("schema",[]),j0=tq("name"),jk=bv("pname","pname",rA(function(a){return"<alloy."+rx(a.name)+">"}),k9()),dz=q6("defaults",ub.constant({})),dQ=q6("overrides",ub.constant({})),qq=iB([iG,uO,j0,jk,dz,dQ]),lT=iB([iG,uO,j0,dz,dQ]),fb=iB([iG,uO,j0,jk,dz,dQ]),kw=iB([iG,uO,j0,tq("unit"),jk,dz,dQ]),k4=function(b){var a=function(c){return c.name()};return b.fold(a,a,a,a)},nx=function(a,b){return function(d){var c=oH("Converting part type",b,d);return a(c)}},fY=nx(kP.required,qq),mI=(nx(kP.external,lT),nx(kP.optional,fb)),d6=nx(kP.group,kw),hB=ub.constant("entirety"),jH=function(f,c,a,d){var b=a;return uM.deepMerge(c.defaults()(f,a,d),a,{uid:f.partUids()[c.name()]},c.overrides()(f,a,d),{"debug.sketcher":kK("part-"+c.name(),b)})},fH=function(b,c){var a={};return jN.each(c,function(f){var d;(d=f,d.fold(sX.some,sX.none,sX.some,sX.some)).each(function(e){var g=cz(b,e.pname());a[e.name()]=function(i){var h=lY("Part: "+e.name()+" in "+b,iB(e.schema()),i);return uM.deepMerge(g,{config:i,validated:h})}})}),a},cz=function(b,a){return{uiType:rO(),owner:b,name:a}},h6=function(h,f,c){return g=f,d=c,b={},a={},jN.each(d,function(e){e.fold(function(i){b[i.pname()]=sT(!0,function(l,k,j){return i.factory().sketch(jH(l,i,k,j))})},function(j){var i=g.parts()[j.name()]();a[j.name()]=ub.constant(jH(g,j,i[hB()]()))},function(i){b[i.pname()]=sT(!1,function(l,k,j){return i.factory().sketch(jH(l,i,k,j))})},function(i){b[i.pname()]=pG(!0,function(k,m,j){var l=k[i.name()]();return jN.map(l,function(o){return i.factory().sketch(uM.deepMerge(i.defaults()(k,o),o,i.overrides()(k,o)))})})})}),{internals:ub.constant(b),externals:ub.constant(a)};var g,d,b,a},qK=function(c,b,a){return pX(sX.some(c),b,b.components(),a)},hS=function(d,b,a){var c=b.partUids()[a];return d.getSystem().getByUid(c).toOption()},gv=function(c,b,a){return hS(c,b,a).getOrDie("Could not find part: "+a)},eT=function(b,d){var a,c=(a=d,jN.map(a,k4));return mW(jN.map(c,function(e){return{key:e,value:b+"-"+e}}))},bY=function(a){return bv("partUids","partUids",n5(function(b){return eT(b.uid,a)}),k9())},c1=rx("alloy-premade"),iV=rx("api"),cO=function(a){return kK(c1,a)},n2=function(f){return g=function(j){var i=Array.prototype.slice.call(arguments,0),h=j.config(iV);return f.apply(undefined,[h].concat(i))},d=f.toString(),b=d.indexOf(")")+1,c=d.indexOf("("),a=d.substring(c+1,b-1).split(/,\s*/),g.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:dX(a.slice(1))}},g;var g,d,b,c,a},aF=ub.constant(iV),gL=ub.constant("alloy-id-"),bI=ub.constant("data-alloy-id"),bj=gL(),g1=bI(),eD=function(b){var a=kL.isElement(b)?uV.get(b,g1):null;return sX.from(a)},aV=function(a){return rx(a)},oV=(ub.constant(g1),function(k,h,f,j,g){var d,c,b=(c=g,(0<(d=j).length?[pN("parts",d)]:[]).concat([tq("uid"),q6("dom",{}),q6("components",[]),oq("originalSpec"),q6("debug.sketcher",{})]).concat(c));return oH(k+" [SpecSchema]",cM(b.concat(h)),f)}),r9=function(g,m,w,d,b){var j,v=lU(b),q=(j=w,jN.bind(j,function(a){return a.fold(sX.none,sX.some,sX.none,sX.none).map(function(c){return pN(c.name(),c.schema().concat([oq(hB())]))}).toArray()})),p=bY(w),x=oV(g,m,v,q,[p]),k=h6(0,x,w),h=qK(g,x,k.internals());return uM.deepMerge(d(x,h,v,k.externals()),{"debug.sketcher":kK(g,b)})},lU=function(a){return uM.deepMerge({uid:aV("uid")},a)},oE=cM([tq("name"),tq("factory"),tq("configFields"),q6("apis",{}),q6("extraApis",{})]),ny=cM([tq("name"),tq("factory"),tq("configFields"),tq("partFields"),q6("apis",{}),q6("extraApis",{})]),qO=function(f){var b=lY("Sketcher for "+f.name,oE,f),d=uw.map(b.apis,n2),c=uw.map(b.extraApis,function(g,a){return g8(g,a)});return uM.deepMerge({name:ub.constant(b.name),partFields:ub.constant([]),configFields:ub.constant(b.configFields),sketch:function(m){return k=b.name,h=b.configFields,l=b.factory,g=lU(j=m),a=oV(k,h,g,[],[]),uM.deepMerge(l(a,g),{"debug.sketcher":kK(k,j)});var k,h,l,j,g,a}},d,c)},k5=function(f){var c=lY("Sketcher for "+f.name,ny,f),a=fH(c.name,c.partFields),d=uw.map(c.apis,n2),b=uw.map(c.extraApis,function(h,g){return g8(h,g)});return uM.deepMerge({name:ub.constant(c.name),partFields:ub.constant(c.partFields),configFields:ub.constant(c.configFields),sketch:function(e){return r9(c.name,c.configFields,c.partFields,c.factory,e)},parts:ub.constant(a)},d,b)},uU=qO({name:"Button",factory:function(k,h){var f,j,g,d=(f=k.action(),j=function(i,a){a.stop(),l8(i)},g=f6.detect().deviceType.isTouch()?[dG(ax(),j)]:[dG(t9(),j),dG(uI(),function(i,a){a.cut()})],iZ(jN.flatten([f.map(function(a){return dG(cD(),function(l,i){a(l),i.stop()})}).toArray(),g]))),c=jV(k.dom(),"attributes").bind(lz("type")),b=jV(k.dom(),"tag");return{uid:k.uid(),dom:k.dom(),components:k.components(),events:d,behaviours:uM.deepMerge(a2([hJ.config({}),nM.config({mode:"execution",useSpace:!0,useEnter:!0})]),lE(k.buttonBehaviours())),domModification:{attributes:uM.deepMerge(c.fold(function(){return b.is("button")?{type:"button"}:{}},function(a){return{}}),{role:k.role().getOr("button")})},eventOrder:k.eventOrder()}},configFields:[q6("uid",undefined),tq("dom"),q6("components",[]),qZ("buttonBehaviours",[hJ,nM]),pw("action"),pw("role"),q6("eventOrder",{})]}),s6=Object.freeze({events:function(a){return iZ([c8(tZ(),ub.constant(!0))])},exhibit:function(b,a){return b5({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),mJ=eq({fields:[],name:"unselecting",active:s6}),rS=function(f){var h,m,d,b=lA.fromHtml(f),g=n0.children(b),l=(m=(h=b).dom().attributes!==undefined?h.dom().attributes:[],jN.foldl(m,function(c,a){return"class"===a.name?c:uM.deepMerge(c,kK(a.name,a.value))},{})),k=(d=b,Array.prototype.slice.call(d.dom().classList,0)),j=0===g.length?{}:{innerHtml:cy(b)};return uM.deepMerge({tag:kL.name(b),classes:k,attributes:l},j)},pK=function(b){var a=g9.supplant(b,{prefix:jA.prefix()});return rS(a)},sH=function(a){return{dom:pK(a)}},pk=function(a){return a2([m8.config({toggleClass:jA.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),fS(a,function(c,b){(b?m8.on:m8.off)(c)})])},rB=function(c,b,a){return uU.sketch({dom:pK('<span class="${prefix}-toolbar-button ${prefix}-icon-'+c+' ${prefix}-icon"></span>'),action:b,buttonBehaviours:uM.deepMerge(a2([mJ.config({})]),a)})},n6={forToolbar:rB,forToolbarCommand:function(b,a){return rB(a,function(){b.execCommand(a)},{})},forToolbarStateAction:function(f,c,a,d){var b=pk(a);return rB(c,d,b)},forToolbarStateCommand:function(c,b){var a=pk(b);return rB(b,function(){c.execCommand(b)},a)}},q3=function(c,b,a){return Math.max(b,Math.min(a,c))},kx=function(j,x,C,h,b,q,B){var A=C-x;if(h<j.left){return x-1}if(h>j.right){return C+1}var z,D,w,p,y=Math.min(j.right,Math.max(h,j.left))-j.left,k=q3(y/j.width*A+x,x-1,C+1),v=Math.round(k);return q&&x<=k&&k<=C?(z=k,D=x,w=C,p=b,B.fold(function(){var c=z-D,a=Math.round(c/p)*p;return q3(D+a,D-1,w+1)},function(l){var f=(z-l)%p,c=Math.round(f/p),g=Math.floor((z-l)/p),d=Math.floor((w-l)/p),a=l+Math.min(d,g+c)*p;return Math.max(l,a)})):v},h7="slider.change.value",t4=f6.detect().deviceType.isTouch(),jI=function(b){var a;return(a=b.event().raw(),t4&&a.touches!==undefined&&1===a.touches.length?sX.some(a.touches[0]):t4&&a.touches!==undefined?sX.none():t4||a.clientX===undefined?sX.none():sX.some(a)).map(function(c){return c.clientX})},iU=function(b,a){sB(b,h7,{value:a})},c5=function(d,c,b,e){return jI(e).map(function(i){var g,a,h,f;return g=d,h=i,f=kx(b,(a=c).min(),a.max(),h,a.stepSize(),a.snapToGrid(),a.snapStart()),iU(g,f),i})},dD=function(h,f){var c,g,d,b,a=(c=f.value().get(),g=f.min(),d=f.max(),b=f.stepSize(),c<g?c:d<c?d:c===g?g-1:Math.max(g,c-b));iU(h,a)},p1=function(h,f){var c,g,d,b,a=(c=f.value().get(),g=f.min(),d=f.max(),b=f.stepSize(),d<c?c:c<g?g:c===d?d+1:Math.min(d,c+b));iU(h,a)},lC=ub.constant(h7),eX=f6.detect().deviceType.isTouch(),jY=function(b,a){return mI({name:b+"-edge",overrides:function(f){var d=iZ([p4(uP(),a,[f])]),c=iZ([p4(uI(),a,[f]),p4(uk(),function(h,g){g.mouseIsDown().get()&&a(h,g)},[f])]);return{events:eX?d:c}}})},kN=[jY("left",function(b,a){iU(b,a.min()-1)}),jY("right",function(b,a){iU(b,a.max()+1)}),fY({name:"thumb",defaults:ub.constant({dom:{styles:{position:"absolute"}}}),overrides:function(a){return{events:iZ([e0(uP(),a,"spectrum"),e0(t5(),a,"spectrum"),e0(uB(),a,"spectrum")])}}}),fY({schema:[ij("mouseIsDown",function(){return eY(!1)})],name:"spectrum",overrides:function(c){var a=function(h,g){var f=h.element().dom().getBoundingClientRect();c5(h,c,f,g)},d=iZ([dG(uP(),a),dG(t5(),a)]),b=iZ([dG(uI(),a),dG(uk(),function(g,f){c.mouseIsDown().get()&&a(g,f)})]);return{behaviours:a2(eX?[]:[nM.config({mode:"special",onLeft:function(e){return dD(e,c),sX.some(!0)},onRight:function(e){return p1(e,c),sX.some(!0)}}),hJ.config({})]),events:eX?d:b}}})],mZ=function(c,b,a){b.store().manager().onLoad(c,b,a)},fL=function(c,b,a){b.store().manager().onUnload(c,b,a)},mb=Object.freeze({onLoad:mZ,onUnload:fL,setValue:function(d,b,a,c){b.store().manager().setValue(d,b,a,c)},getValue:function(c,b,a){return b.store().manager().getValue(c,b,a)}}),dU=Object.freeze({events:function(a,b){var c=a.resetOnDom()?[kS(function(f,d){mZ(f,a,b)}),m4(function(f,d){fL(f,a,b)})]:[qB(a,b,mZ)];return iZ(c)}}),g5=function(){var a=eY(null);return aw({set:a.set,get:a.get,isNotSet:function(){return null===a.get()},clear:function(){a.set(null)},readState:function(){return{mode:"memory",value:a.get()}}})},jh=function(){var a=eY({});return aw({readState:function(){return{mode:"dataset",dataset:a.get()}},set:a.set,get:a.get})},fv=Object.freeze({memory:g5,dataset:jh,manual:function(){return aw({readState:function(){}})},init:function(a){return a.store().manager().state(a)}}),b2=function(d,b,a,c){b.store().getDataKey(),a.set({}),b.store().setData()(d,c),b.onSetValue()(d,c)},hQ=[pw("initialValue"),tq("getFallbackEntry"),tq("getDataKey"),tq("setData"),rI("manager",{setValue:b2,getValue:function(f,c,a){var d=c.store().getDataKey()(f),b=a.get();return jV(b,d).fold(function(){return c.store().getFallbackEntry()(d)},function(e){return e})},onLoad:function(b,a,c){a.store().initialValue().each(function(d){b2(b,a,c,d)})},onUnload:function(c,b,a){a.set({})},state:jh})],qy=[tq("getValue"),q6("setValue",ub.noop),pw("initialValue"),rI("manager",{setValue:function(d,b,a,c){b.store().setValue()(d,c),b.onSetValue()(d,c)},getValue:function(c,b,a){return b.store().getValue()(c)},onLoad:function(b,a,c){a.store().initialValue().each(function(d){a.store().setValue()(b,d)})},onUnload:ub.noop,state:gC})],hA=[pw("initialValue"),rI("manager",{setValue:function(d,b,a,c){a.set(c),b.onSetValue()(d,c)},getValue:function(c,b,a){return a.get()},onLoad:function(c,b,a){b.store().initialValue().each(function(d){a.isNotSet()&&a.set(d)})},onUnload:function(c,b,a){a.clear()},state:g5})],f2=[kB("store",{mode:"memory"},qR("mode",{memory:hA,manual:qy,dataset:hQ})),rZ("onSetValue"),q6("resetOnDom",!1)],eH=eq({fields:f2,name:"representing",active:dU,apis:mb,extra:{setValueFrom:function(c,b){var a=eH.getValue(b);eH.setValue(c,a)}},state:fv}),bM=f6.detect().deviceType.isTouch(),cN=[tq("min"),tq("max"),q6("stepSize",1),q6("onChange",ub.noop),q6("onInit",ub.noop),q6("onDragStart",ub.noop),q6("onDragEnd",ub.noop),q6("snapToGrid",!1),pw("snapStart"),tq("getInitialValue"),qZ("sliderBehaviours",[nM,eH]),ij("value",function(a){return eY(a.min)})].concat(bM?[]:[ij("mouseIsDown",function(){return eY(!1)})]),iE=aA("width",function(a){return a.dom().offsetWidth}),cx=function(b,a){iE.set(b,a)},nQ=function(a){return iE.get(a)},ak=f6.detect().deviceType.isTouch(),gz=k5({name:"Slider",configFields:cN,partFields:kN,factory:function(l,g,k,q){var v=l.max()-l.min(),j=function(c){var a=c.element().dom().getBoundingClientRect();return(a.left+a.right)/2},b=function(a){return gv(a,l,"thumb")},h=function(A){var y,w,z,x,s=gv(A,l,"spectrum").element().dom().getBoundingClientRect(),f=A.element().dom().getBoundingClientRect(),c=(y=A,w=s,(x=(z=l).value().get())<z.min()?hS(y,z,"left-edge").fold(function(){return 0},function(a){return j(a)-w.left}):x>z.max()?hS(y,z,"right-edge").fold(function(){return w.width},function(a){return j(a)-w.left}):(z.value().get()-z.min())/v*w.width);return s.left-f.left+c},p=function(i){var c=h(i),a=b(i),f=nQ(a.element())/2;nX.set(a.element(),"left",c-f+"px")},d=function(i,c){var a=l.value().get(),f=b(i);return a!==c||nX.getRaw(f.element(),"left").isNone()?(l.value().set(c),p(i),l.onChange()(i,f,c),sX.some(!0)):sX.none()},m=ak?[dG(uP(),function(c,a){l.onDragStart()(c,b(c))}),dG(uB(),function(c,a){l.onDragEnd()(c,b(c))})]:[dG(uI(),function(c,a){a.stop(),l.onDragStart()(c,b(c)),l.mouseIsDown().set(!0)}),dG(tY(),function(c,a){l.onDragEnd()(c,b(c)),l.mouseIsDown().set(!1)})];return{uid:l.uid(),dom:l.dom(),components:g,behaviours:uM.deepMerge(a2(jN.flatten([ak?[]:[nM.config({mode:"special",focusIn:function(a){return hS(a,l,"spectrum").map(nM.focusIn).map(ub.constant(!0))}})],[eH.config({store:{mode:"manual",getValue:function(a){return l.value().get()}}})]])),lE(l.sliderBehaviours())),events:iZ([dG(lC(),function(c,a){d(c,a.event().value())}),kS(function(f,c){l.value().set(l.getInitialValue()());var a=b(f);p(f),l.onInit()(f,a,l.value().get())})].concat(m)),apis:{resetToMin:function(a){d(a,l.min())},resetToMax:function(a){d(a,l.max())},refresh:p},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(b,a){b.resetToMin(a)},resetToMax:function(b,a){b.resetToMax(a)},refresh:function(b,a){b.refresh(a)}}}),bw=function(b,a,c){return n6.forToolbar(a,function(){var d=c();b.setContextToolbar([{label:a+" group",items:d}])},{})},aZ=function(c){return[(b=c,a=function(d){return d<0?"black":360<d?"white":"hsl("+d+", 100%, 50%)"},gz.sketch({dom:pK('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[gz.parts()["left-edge"](sH('<div class="${prefix}-hue-slider-black"></div>')),gz.parts().spectrum({dom:pK('<div class="${prefix}-slider-gradient-container"></div>'),components:[sH('<div class="${prefix}-slider-gradient"></div>')],behaviours:a2([m8.config({toggleClass:jA.resolve("thumb-active")})])}),gz.parts()["right-edge"](sH('<div class="${prefix}-hue-slider-white"></div>')),gz.parts().thumb({dom:pK('<div class="${prefix}-slider-thumb"></div>'),behaviours:a2([m8.config({toggleClass:jA.resolve("thumb-active")})])})],onChange:function(h,f,d){var g=a(d);nX.set(f.element(),"background-color",g),b.onChange(h,f,g)},onDragStart:function(f,d){m8.on(d)},onDragEnd:function(f,d){m8.off(d)},onInit:function(h,f,d){var g=a(d);nX.set(f.element(),"background-color",g)},stepSize:10,min:0,max:360,getInitialValue:b.getInitialValue,sliderBehaviours:a2([mA(gz.refresh)])}))];var b,a},gP=function(c,b){var a={onChange:function(g,f,d){b.undoManager.transact(function(){b.formatter.apply("forecolor",{value:d}),b.nodeChanged()})},getInitialValue:function(){return -1}};return bw(c,"color",function(){return aZ(a)})},eb=cM([tq("getInitialValue"),tq("onChange"),tq("category"),tq("sizes")]),aJ=function(b){var a=lY("SizeSlider",eb,b);return gz.sketch({dom:{tag:"div",classes:[jA.resolve("slider-"+a.category+"-size-container"),jA.resolve("slider"),jA.resolve("slider-size-container")]},onChange:function(g,d,c){var f;0<=(f=c)&&f<a.sizes.length&&a.onChange(c)},onDragStart:function(d,c){m8.on(c)},onDragEnd:function(d,c){m8.off(c)},min:0,max:a.sizes.length-1,stepSize:1,getInitialValue:a.getInitialValue,snapToGrid:!0,sliderBehaviours:a2([mA(gz.refresh)]),components:[gz.parts().spectrum({dom:pK('<div class="${prefix}-slider-size-container"></div>'),components:[sH('<div class="${prefix}-slider-size-line"></div>')]}),gz.parts().thumb({dom:pK('<div class="${prefix}-slider-thumb"></div>'),behaviours:a2([m8.config({toggleClass:jA.resolve("thumb-active")})])})]})},o5=function(h,f,c){for(var g=h.dom(),d=uJ.isFunction(c)?c:ub.constant(!1);g.parentNode;){g=g.parentNode;var b=lA.fromDom(g),a=f(b);if(a.isSome()){return a}if(d(b)){break}}return sX.none()},sA=function(c,b,a){return b(c).orThunk(function(){return a(c)?sX.none():o5(c,b,a)})},l5=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],oO=function(h){var f,c,g=h.selection.getStart(),d=lA.fromDom(g),b=lA.fromDom(h.getBody()),a=(f=function(e){return qI(b,e)},c=d,(kL.isElement(c)?sX.some(c):n0.parent(c)).map(function(e){return sA(e,function(i){return nX.getRaw(i,"font-size")},f).getOrThunk(function(){return nX.get(e,"font-size")})}).getOr(""));return jN.find(l5,function(e){return a===e}).getOr("medium")},nJ={candidates:ub.constant(l5),get:function(c){var b,a=oO(c);return(b=a,jN.findIndex(l5,function(d){return d===b})).getOr(2)},apply:function(b,c){var a;(a=c,sX.from(l5[a])).each(function(g){var f,d;d=g,oO(f=b)!==d&&f.execCommand("fontSize",!1,d)})}},lx=nJ.candidates(),u4=function(b){return[sH('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(a=b,aJ({onChange:a.onChange,sizes:lx,category:"font",getInitialValue:a.getInitialValue})),sH('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var a},tJ=function(b){var a=b.uid!==undefined&&l7(b,"uid")?b.uid:aV("memento");return{get:function(c){return c.getSystem().getByUid(a).getOrDie()},getOpt:function(c){return c.getSystem().getByUid(a).fold(sX.none,sX.some)},asSpec:function(){return uM.deepMerge(b,{uid:a})}}};function mU(b,a){return pU(document.createElement("canvas"),b,a)}function r2(a){return a.getContext("2d")}function pU(c,b,a){return c.width=b,c.height=a,c}var sQ={create:mU,clone:function(b){var a;return r2(a=mU(b.width,b.height)).drawImage(b,0,0),a},resize:pU,get2dContext:r2,get3dContext:function(c){var b=null;try{b=c.getContext("webgl")||c.getContext("experimental-webgl")}catch(a){}return b||(b=null),b}},pD={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},rL=window.Promise?window.Promise:function(){var f=function(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],p(a,d(b,this),d(l,this))},h=f.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)};function d(c,a){return function(){c.apply(a,arguments)}}var m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};function g(c){var a=this;null!==this._state?h(function(){var q=a._state?c.onFulfilled:c.onRejected;if(null!==q){var o;try{o=q(a._value)}catch(i){return void c.reject(i)}c.resolve(o)}else{(a._state?c.resolve:c.reject)(a._value)}}):this._deferreds.push(c)}function b(i){try{if(i===this){throw new TypeError("A promise cannot be resolved with itself.")}if(i&&("object"==typeof i||"function"==typeof i)){var c=i.then;if("function"==typeof c){return void p(d(c,i),d(b,this),d(l,this))}}this._state=!0,this._value=i,k.call(this)}catch(a){l.call(this,a)}}function l(a){this._state=!1,this._value=a,k.call(this)}function k(){for(var c=0,a=this._deferreds.length;c<a;c++){g.call(this,this._deferreds[c])}this._deferreds=null}function j(q,c,a,i){this.onFulfilled="function"==typeof q?q:null,this.onRejected="function"==typeof c?c:null,this.resolve=a,this.reject=i}function p(s,i,a){var q=!1;try{s(function(e){q||(q=!0,i(e))},function(e){q||(q=!0,a(e))})}catch(c){if(q){return}q=!0,a(c)}}return f.prototype["catch"]=function(a){return this.then(null,a)},f.prototype.then=function(a,e){var c=this;return new f(function(o,i){g.call(c,new j(a,e,o,i))})},f.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new f(function(q,o){if(0===a.length){return q([])}var e=a.length;function c(r,v){try{if(v&&("object"==typeof v||"function"==typeof v)){var i=v.then;if("function"==typeof i){return void i.call(v,function(t){c(r,t)},o)}}a[r]=v,0==--e&&q(a)}catch(u){o(u)}}for(var s=0;s<a.length;s++){c(s,a[s])}})},f.resolve=function(a){return a&&"object"==typeof a&&a.constructor===f?a:new f(function(c){c(a)})},f.reject=function(a){return new f(function(i,c){c(a)})},f.race=function(a){return new f(function(r,i){for(var c=0,q=a.length;c<q;c++){a[c].then(r,i)}})},f}();function ox(){return new (d4.getOrDie("FileReader"))}var rq={atob:function(a){return d4.getOrDie("atob")(a)},requestAnimationFrame:function(a){d4.getOrDie("requestAnimationFrame")(a)}};function kI(b){return new rL(function(j,g){var d=URL.createObjectURL(b),h=new Image,f=function(){h.removeEventListener("load",c),h.removeEventListener("error",a)};function c(){f(),j(h)}function a(){f(),g("Unable to load data of type "+b.type+": "+d)}h.addEventListener("load",c),h.addEventListener("error",a),h.src=d,h.complete&&c()})}function iz(a){return new rL(function(d,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){200==this.status&&d(this.response)},c.onerror=function(){var g,f=this;b(0===this.status?((g=new Error("No access to download image")).code=18,g.name="SecurityError",g):new Error("Error "+f.status+" downloading image"))},c.send()})}function uH(z){var G=z.split(","),k=/data:([^;]+)/.exec(G[0]);if(!k){return sX.none()}for(var y,w,C,j=k[1],J=G[1],I=rq.atob(J),q=I.length,F=Math.ceil(q/1024),B=new Array(F),H=0;H<F;++H){for(var A=1024*H,E=Math.min(A+1024,q),x=new Array(E-A),D=A,b=0;D<E;++b,++D){x[b]=I[D].charCodeAt(0)}B[H]=(y=x,new (d4.getOrDie("Uint8Array"))(y))}return sX.some((w=B,C={type:j},new (d4.getOrDie("Blob"))(w,C)))}function jT(a){return new rL(function(c,b){uH(a).fold(function(){b("uri is not base64: "+a)},c)})}function i6(a){return new rL(function(c){var b=new ox;b.onloadend=function(){c(b.result)},b.readAsDataURL(a)})}var dw,dN,qh,lO,e7,kb,kZ,nj,fV={blobToImage:kI,imageToBlob:function(b){var a=b.src;return 0===a.indexOf("data:")?jT(a):iz(a)},blobToArrayBuffer:function(a){return new rL(function(c){var b=new ox;b.onloadend=function(){c(b.result)},b.readAsArrayBuffer(a)})},blobToDataUri:i6,blobToBase64:function(a){return i6(a).then(function(b){return b.split(",")[1]})},dataUriToBlobSync:uH,canvasToBlob:function(c,a,b){return a=a||"image/png",HTMLCanvasElement.prototype.toBlob?new rL(function(d){c.toBlob(function(e){d(e)},a,b)}):jT(c.toDataURL(a,b))},canvasToDataURL:function(c,b,a){return b=b||"image/png",c.then(function(d){return d.toDataURL(b,a)})},blobToCanvas:function(a){return kI(a).then(function(d){var c,b;return c=d,URL.revokeObjectURL(c.src),b=sQ.create(pD.getWidth(d),pD.getHeight(d)),sQ.get2dContext(b).drawImage(d,0,0),b})},uriToBlob:function(a){return 0===a.indexOf("blob:")?iz(a):0===a.indexOf("data:")?jT(a):null}},mD=function(a){return fV.blobToBase64(a)},d3=function(a){var b=tJ({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:iZ([j3(t9()),dG(uy(),function(h,f){var c,g,d;(c=f,g=c.event(),d=g.raw().target.files||g.raw().dataTransfer.files,sX.from(d[0])).each(function(k){var j,e;j=a,mD(e=k).then(function(i){j.undoManager.transact(function(){var o=j.editorUpload.blobCache,m=o.create(rx("mceu"),e,i);o.add(m);var l=j.dom.createHTML("img",{src:m.blobUri()});j.insertContent(l)})})})})])});return uU.sketch({dom:pK('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[b.asSpec()],action:function(c){b.get(c).element().dom().click()}})},hv=function(a){return a.dom().textContent},jC=function(b,a){b.dom().textContent=a},fE=function(a){return 0<a.length},cj=function(a){return a===undefined||null===a?"":a},h1=function(b,a,c){return c.text.filter(fE).fold(function(){return uV.get(d=b,"href")===hv(d)?sX.some(a):sX.none();var d},sX.some)},qH=function(b){var a=lA.fromDom(b.selection.getStart());return s2(a,"a")},hL={getInfo:function(a){return qH(a).fold(function(){return{url:"",text:a.selection.getContent({format:"text"}),title:"",target:"",link:sX.none()}},function(h){return c=hv(f=h),g=uV.get(f,"href"),d=uV.get(f,"title"),b=uV.get(f,"target"),{url:cj(g),text:c!==g?cj(c):"",title:cj(d),target:cj(b),link:sX.some(f)};var f,c,g,d,b})},applyInfo:function(b,a){a.url.filter(fE).fold(function(){var c;c=b,a.link.bind(ub.identity).each(function(d){c.execCommand("unlink")})},function(c){var g,d,f=(g=a,(d={}).href=c,g.title.filter(fE).each(function(e){d.title=e}),g.target.filter(fE).each(function(e){d.target=e}),d);a.link.bind(ub.identity).fold(function(){var e=a.text.filter(fE).getOr(c);b.insertContent(b.dom.createHTML("a",f,b.dom.encode(e)))},function(h){var i=h1(h,c,a);uV.setAll(h,f),i.each(function(e){jC(h,e)})})})},query:qH},gj=f6.detect(),eQ=function(c,b){var a=b.selection.getRng();c(),b.selection.setRng(a)},bV=function(b,a){(gj.os.isAndroid()?eQ:ub.apply)(a,b)},cY=function(d,b){var a,c;return{key:d,value:{config:{},me:(a=d,c=iZ(b),eq({fields:[tq("enabled")],name:a,active:{events:ub.constant(c)}})),configAsRaw:ub.constant({}),initialConfig:{},state:sb()}}},iP=Object.freeze({getCurrent:function(c,b,a){return b.find()(c)}}),cI=[tq("find")],nZ=eq({fields:cI,name:"composing",apis:iP}),aC=qO({name:"Container",factory:function(b,a){return{uid:b.uid(),dom:uM.deepMerge({tag:"div",attributes:{role:"presentation"}},b.dom()),components:b.components(),behaviours:lE(b.containerBehaviours()),events:b.events(),domModification:b.domModification(),eventOrder:b.eventOrder()}},configFields:[q6("components",[]),qZ("containerBehaviours",[]),q6("events",{}),q6("domModification",{}),q6("eventOrder",{})]}),gI=qO({name:"DataField",factory:function(a,b){return{uid:a.uid(),dom:a.dom(),behaviours:uM.deepMerge(a2([eH.config({store:{mode:"memory",initialValue:a.getInitialValue()()}}),nZ.config({find:sX.some})]),lE(a.dataBehaviours())),events:iZ([kS(function(d,c){eH.setValue(d,a.getInitialValue()())})])}},configFields:[tq("uid"),tq("dom"),tq("getInitialValue"),qZ("dataBehaviours",[eH,nZ])]}),bF=function(b,a){if(a===undefined){throw new Error("Value.set was undefined")}b.dom().value=a},a8=function(a){return a.dom().value},gY=ub.constant([pw("data"),q6("inputAttributes",{}),q6("inputStyles",{}),q6("type","input"),q6("tag","input"),q6("inputClasses",[]),rZ("onSetValue"),q6("styles",{}),pw("placeholder"),q6("eventOrder",{}),qZ("inputBehaviours",[eH,hJ]),q6("selectOnFocus",!0)]),eA=qO({name:"Input",configFields:gY(),factory:function(d,b){return{uid:d.uid(),dom:(c=d,{tag:c.tag(),attributes:uM.deepMerge(mW([{key:"type",value:c.type()}].concat(c.placeholder().map(function(e){return{key:"placeholder",value:e}}).toArray())),c.inputAttributes()),styles:c.inputStyles(),classes:c.inputClasses()}),components:[],behaviours:(a=d,uM.deepMerge(a2([eH.config({store:{mode:"manual",initialValue:a.data().getOr(undefined),getValue:function(e){return a8(e.element())},setValue:function(g,f){a8(g.element())!==f&&bF(g.element(),f)}},onSetValue:a.onSetValue()}),hJ.config({onFocus:!1===a.selectOnFocus()?ub.noop:function(h){var g=h.element(),f=a8(g);g.dom().setSelectionRange(0,f.length)}})]),lE(a.inputBehaviours()))),eventOrder:d.eventOrder()};var a,c}}),aS=Object.freeze({exhibit:function(b,a){return b5({attributes:mW([{key:a.tabAttr(),value:"true"}])})}}),o1=[q6("tabAttr","data-alloy-tabstop")],sw=eq({fields:o1,name:"tabstopping",active:aS}),l1=function(d,b){var a=tJ(eA.sketch({placeholder:b,onSetValue:function(g,f){o6(g,sV())},inputBehaviours:a2([nZ.config({find:sX.some}),sw.config({}),nM.config({mode:"execution"})]),selectOnFocus:!1})),c=tJ(uU.sketch({dom:pK('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(g){var f=a.get(g);eH.setValue(f,"")}}));return{name:d,spec:aC.sketch({dom:pK('<div class="${prefix}-input-container"></div>'),components:[a.asSpec(),c.asSpec()],containerBehaviours:a2([m8.config({toggleClass:jA.resolve("input-container-empty")}),nZ.config({find:function(e){return sX.some(a.get(e))}}),cY("input-clearing",[dG(sV(),function(g){var f=a.get(g);(0<eH.getValue(f).length?m8.off:m8.on)(g)})])])})}},oK=["input","button","textarea"],nF=function(c,b,a){b.disabled()&&rY(c,b,a)},qT=function(a){return jN.contains(oK,kL.name(a.element()))},lk=function(a){uV.set(a.element(),"disabled","disabled")},u0=function(a){uV.remove(a.element(),"disabled")},tz=function(a){uV.set(a.element(),"aria-disabled","true")},mQ=function(a){uV.set(a.element(),"aria-disabled","false")},rY=function(b,c,a){c.disableClass().each(function(d){iW.add(b.element(),d)}),(qT(b)?lk:tz)(b)},pQ=function(a){return qT(a)?uV.has(a.element(),"disabled"):"true"===uV.get(a.element(),"aria-disabled")},sM=Object.freeze({enable:function(b,c,a){c.disableClass().each(function(d){iW.remove(b.element(),d)}),(qT(b)?u0:mQ)(b)},disable:rY,isDisabled:pQ,onLoad:nF}),pz=Object.freeze({exhibit:function(c,b,a){return b5({classes:b.disabled()?b.disableClass().map(jN.pure).getOr([]):[]})},events:function(b,a){return iZ([c8(cD(),function(d,c){return pQ(d)}),qB(b,a,nF)])}}),rH=[q6("disabled",!1),pw("disableClass")],ok=eq({fields:rH,name:"disabling",active:pz,apis:sM}),q9=[qZ("formBehaviours",[eH])],kE=function(a){return"<alloy.field."+a+">"},iv=function(a,c,b){return uM.deepMerge({"debug.sketcher":{Form:b},uid:a.uid(),dom:a.dom(),components:c,behaviours:uM.deepMerge(a2([eH.config({store:{mode:"manual",getValue:function(h){var f,d,g=(f=a,d=h.getSystem(),uw.map(f.partUids(),function(j,i){return ub.constant(d.getByUid(j))}));return uw.map(g,function(j,i){return j().bind(nZ.getCurrent).map(eH.getValue)})},setValue:function(d,e){uw.each(e,function(f,g){hS(d,a,g).each(function(h){nZ.getCurrent(h).each(function(i){eH.setValue(i,f)})})})}}})]),lE(a.formBehaviours())),apis:{getField:function(f,d){return hS(f,a,d).bind(nZ.getCurrent)}}})},ux=(n2(function(c,b,a){return c.getField(b,a)}),function(g){var b,d=(b=[],{field:function(l,j){return b.push(l),h="form",k=kE(l),i=j,{uiType:rO(),owner:h,name:k,config:i,validated:{}};var h,k,i},record:function(){return b}}),a=g(d),f=d.record(),c=jN.map(f,function(e){return fY({name:e,pname:kE(e)})});return r9("form",q9,c,iv,a)}),jP=function(){var b=eY(sX.none()),a=function(){b.get().each(function(c){c.destroy()})};return{clear:function(){a(),b.set(sX.none())},isSet:function(){return b.get().isSome()},set:function(c){a(),b.set(sX.some(c))},run:function(c){b.get().each(c)}}},i2=function(){var a=eY(sX.none());return{clear:function(){a.set(sX.none())},set:function(b){a.set(sX.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}},dj=function(a){return{xValue:a,points:[]}},dJ=function(d,b){if(b===d.xValue){return d}var a=0<b-d.xValue?1:-1,c={direction:a,xValue:b};return{xValue:b,points:(0===d.points.length?[]:d.points[d.points.length-1].direction===a?d.points.slice(0,d.points.length-1):d.points).concat([c])}},p7=function(c){if(0===c.points.length){return 0}var b=c.points[0].direction,a=c.points[c.points.length-1].direction;return -1===b&&-1===a?-1:1===b&&1===a?1:0},lK=function(f){var d="navigateEvent",h=iB([tq("fields"),q6("maxFieldIndex",f.fields.length-1),tq("onExecute"),tq("getInitialValue"),ij("state",function(){return{dialogSwipeState:i2(),currentScreen:eY(0)}})]),l=lY("SerialisedDialog",h,f),b=function(c,i,a){return uU.sketch({dom:pK('<span class="${prefix}-icon-'+i+' ${prefix}-icon"></span>'),action:function(e){sB(e,d,{direction:c})},buttonBehaviours:a2([ok.config({disableClass:jA.resolve("toolbar-navigation-disabled"),disabled:!a})])})},g=function(e,c){var a=oC(e.element(),"."+jA.resolve("serialised-dialog-screen"));uS(e.element(),"."+jA.resolve("serialised-dialog-chain")).each(function(i){0<=l.state.currentScreen.get()+c&&l.state.currentScreen.get()+c<a.length&&(nX.getRaw(i,"left").each(function(q){var p=parseInt(q,10),o=nQ(a[0]);nX.set(i,"left",p-c*o+"px")}),l.state.currentScreen.set(l.state.currentScreen.get()+c))})},k=function(c){var i=oC(c.element(),"input");sX.from(i[l.state.currentScreen.get()]).each(function(e){c.getSystem().getByDom(e).each(function(q){var p,o;p=c,o=q.element(),p.getSystem().triggerFocus(o,p.element())})});var a=m.get(c);l6.highlightAt(a,l.state.currentScreen.get())},j=tJ(ux(function(a){return{dom:pK('<div class="${prefix}-serialised-dialog"></div>'),components:[aC.sketch({dom:pK('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:jN.map(l.fields,function(i,c){return c<=l.maxFieldIndex?aC.sketch({dom:pK('<div class="${prefix}-serialised-dialog-screen"></div>'),components:jN.flatten([[b(-1,"previous",0<c)],[a.field(i.name,i.spec)],[b(1,"next",c<l.maxFieldIndex)]])}):a.field(i.name,i.spec)})})],formBehaviours:a2([mA(function(o,i){var c;c=i,uS(o.element(),"."+jA.resolve("serialised-dialog-chain")).each(function(e){nX.set(e,"left",-l.state.currentScreen.get()*c.width+"px")})}),nM.config({mode:"special",focusIn:function(c){k(c)},onTab:function(c){return g(c,1),sX.some(!0)},onShiftTab:function(c){return g(c,-1),sX.some(!0)}}),cY("form-events",[kS(function(i,o){l.state.currentScreen.set(0),l.state.dialogSwipeState.clear();var c=m.get(i);l6.highlightFirst(c),l.getInitialValue(i).each(function(e){eH.setValue(i,e)})}),mw(l.onExecute),dG(tX(),function(i,c){"left"===c.event().raw().propertyName&&k(i)}),dG(d,function(o,i){var c=i.event().direction();g(o,c)})])])}})),m=tJ({dom:pK('<div class="${prefix}-dot-container"></div>'),behaviours:a2([l6.config({highlightClass:jA.resolve("dot-active"),itemClass:jA.resolve("dot-item")})]),components:jN.bind(l.fields,function(c,a){return a<=l.maxFieldIndex?[sH('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:pK('<div class="${prefix}-serializer-wrapper"></div>'),components:[j.asSpec(),m.asSpec()],behaviours:a2([nM.config({mode:"special",focusIn:function(c){var a=j.get(c);nM.focusIn(a)}}),cY("serializer-wrapper-events",[dG(uP(),function(c,a){l.state.dialogSwipeState.set(dj(a.event().raw().touches[0].clientX))}),dG(t5(),function(c,a){l.state.dialogSwipeState.on(function(e){a.event().prevent(),l.state.dialogSwipeState.set(dJ(e,a.event().raw().touches[0].clientX))})}),dG(uB(),function(a){l.state.dialogSwipeState.on(function(o){var i=j.get(a),c=-1*p7(o);g(i,c)})})])])}},e3=uG(function(a,b){return[{label:"the link group",items:[lK({fields:[l1("url","Type or paste URL"),l1("text","Link text"),l1("title","Link title"),l1("target","Link target"),(c="link",{name:c,spec:gI.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return sX.none()}})})],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return sX.some(hL.getInfo(b))},onExecute:function(f){var d=eH.getValue(f);hL.applyInfo(b,d),a.restoreToolbar(),b.focus()}})]}];var c}),j6=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],kV={events:iZ([(dw=bQ(),dN=function(g,d){var b,f,c=d.event().originator(),a=d.event().target();return f=a,!(qI(b=c,g.element())&&!qI(b,f)&&(console.warn(bQ()+" did not get interpreted by the desired target. \nOriginator: "+a0(c)+"\nTarget: "+a0(a)+"\nCheck the "+bQ()+" event handlers"),1))},{key:dw,value:uj({can:dN})})])},m7=ub.identity,fR=nT.exactly(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),mz=function(a){var b=function(c){return function(){throw new Error("The component must be in a context to send: "+c+"\n"+a0(a().element())+" is not in context.")}};return fR({debugInfo:ub.constant("fake"),triggerEvent:b("triggerEvent"),triggerFocus:b("triggerFocus"),triggerEscape:b("triggerEscape"),build:b("build"),addToWorld:b("addToWorld"),removeFromWorld:b("removeFromWorld"),addToGui:b("addToGui"),removeFromGui:b("removeFromGui"),getByUid:b("getByUid"),getByDom:b("getByDom"),broadcast:b("broadcast"),broadcastOn:b("broadcastOn"),isConnected:ub.constant(!1)})},d0=function(b,d){var a=jN.map(d,function(e){return bv(e.name(),e.name(),pj(),iB([tq("config"),q6("state",bz)]))}),c=oY("component.behaviours",iB(a),b.behaviours).fold(function(e){throw new Error(nC(e)+"\nComplete spec:\n"+fq(b,null,2))},ub.identity);return{list:d,data:uw.map(c,function(g){var f=g();return ub.constant(f.map(function(e){return{config:e.config(),state:e.state().init(e.config())}}))})}},hj=function(a){return a.list},jz=function(a){return a.data},fB=function(c,b){var a={};return uw.each(c,function(e,d){uw.each(e,function(h,g){var f=eW(g,[])(a);a[g]=f.concat([b(d,h)])})}),a},b8=function(b,a){return{name:ub.constant(b),modification:a}},hY=function(c,b,a){return 1<c.length?s4.error('Multiple behaviours have tried to change DOM "'+b+'". The guilty behaviours are: '+fq(jN.map(c,function(d){return d.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===c.length?s4.value({}):s4.value(c[0].modification().fold(function(){return{}},function(d){return kK(b,d)}))},qE=function(c,b){return jN.foldl(c,function(f,d){var a=d.modification().getOr({});return f.bind(function(e){var g=uw.mapToArray(a,function(l,j){return e[j]!==undefined?(h=b,k=j,i=c,s4.error("Mulitple behaviours have tried to change the _"+k+'_ "'+h+'". The guilty behaviours are: '+fq(jN.bind(i,function(m){return m.modification().getOr({})[k]!==undefined?[m.name()]:[]}),null,2)+". This is not currently supported.")):s4.value(kK(j,l));var h,k,i});return fK(g,e)})},s4.value({})).map(function(a){return kK(b,a)})},hI={classes:function(c,b){var a=jN.bind(c,function(d){return d.modification().getOr([])});return s4.value(kK(b,a))},attributes:qE,styles:qE,domChildren:hY,defChildren:hY,innerHtml:hY,value:hY},f8=function(d,b,j,i){var g=j.slice(0);try{var f=g.sort(function(p,l){var c=p[b](),m=l[b](),k=i.indexOf(c),a=i.indexOf(m);if(-1===k){throw new Error("The ordering for "+d+" does not have an entry for "+c+".\nOrder specified: "+fq(i,null,2))}if(-1===a){throw new Error("The ordering for "+d+" does not have an entry for "+m+".\nOrder specified: "+fq(i,null,2))}return k<a?-1:a<k?1:0});return s4.value(f)}catch(h){return s4.error([h])}},eN=function(b,a){return{handler:ub.curry.apply(undefined,[b.handler].concat(a)),purpose:b.purpose}},bS=function(a){return a.handler},cV=function(b,a){return{name:ub.constant(b),handler:ub.constant(a)}},iM=function(h,f,c){var g,d,b,a=uM.deepMerge(c,(g=f,d=h,b={},jN.each(g,function(e){b[e.name()]=e.handlers(d)}),b));return fB(a,cV)},cF=function(c){var a,b=(a=c,uJ.isFunction(a)?{can:ub.constant(!0),abort:ub.constant(!1),run:a}:a);return function(g,f){var d=Array.prototype.slice.call(arguments,0);b.abort.apply(undefined,d)?f.stop():b.can.apply(undefined,d)&&b.run.apply(undefined,d)}},nW=function(g,d,b){var f,c,a=d[b];return a?f8("Event: "+b,"name",g,a).map(function(i){var h=jN.map(i,function(e){return e.handler()});return jM(h)}):(f=b,c=g,s4.error(["The event ("+f+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+fq(jN.map(c,function(e){return e.name()}),null,2)]))},az=function(c,a){var b=uw.mapToArray(c,function(e,d){return(1===e.length?s4.value(e[0].handler()):nW(e,a,d)).map(function(i){var g,f=cF(i),h=1<e.length?jN.filter(a,function(j){return jN.contains(e,function(k){return k.name()===j})}).join(" > "):e[0].name();return kK(d,(g=h,{handler:f,purpose:ub.constant(g)}))})});return fK(b,{})},gF=function(b){return oY("custom.definition",cM([bv("dom","dom",sG(),cM([tq("tag"),q6("styles",{}),q6("classes",[]),q6("attributes",{}),pw("value"),pw("innerHtml")])),tq("components"),tq("uid"),q6("events",{}),q6("apis",ub.constant({})),bv("eventOrder","eventOrder",(a={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},rR.mergeWithThunk(ub.constant(a))),k9()),pw("domModification"),oq("originalSpec"),q6("debug.sketcher","unknown")]),b);var a},bC=function(c){var b,a={tag:c.dom().tag(),classes:c.dom().classes(),attributes:uM.deepMerge((b=c,kK(bI(),b.uid())),c.dom().attributes()),styles:c.dom().styles(),domChildren:jN.map(c.components(),function(d){return d.element()})};return jw(uM.deepMerge(a,c.dom().innerHtml().map(function(d){return kK("innerHtml",d)}).getOr({}),c.dom().value().map(function(d){return kK("value",d)}).getOr({})))},a5=function(a,b){jN.each(b,function(c){iW.add(a,c)})},gV=function(a,b){jN.each(b,function(c){iW.remove(a,c)})},ex=function(a){if(a.domChildren().isSome()&&a.defChildren().isSome()){throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(b=fy(a),fq(b,null,2)))}return a.domChildren().fold(function(){var c=a.defChildren().getOr([]);return jN.map(c,o7)},function(c){return c});var b},aP=function(c){var b=lA.fromTag(c.tag());uV.setAll(b,c.attributes().getOr({})),a5(b,c.classes().getOr([])),nX.setAll(b,c.styles().getOr({})),nR(b,c.innerHtml().getOr(""));var a=ex(c);return gZ(b,a),c.value().each(function(d){bF(b,d)}),b},o7=function(b){var a=jw(b);return aP(a)},sC=function(f){var c,a,d,b=(a=jV(c=f,"behaviours").getOr({}),d=jN.filter(uw.keys(a),function(e){return a[e]!==undefined}),jN.map(d,function(e){return c.behaviours[e].me}));return d0(f,b)},l9=nT.exactly(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),oQ=function(F){var L,V,K,I,P,E,Z,X,G,U,N=function(){return H},W=eY(mz(N)),M=sk(gF(uM.deepMerge(F,{behaviours:undefined}))),R=sC(F),J=hj(R),Q=jz(R),D=bC(M),z={"alloy.base.modification":(L=M,L.domModification().fold(function(){return b5({})},b5))},Y=function(h,l,f,k){var g=uM.deepMerge({},l);jN.each(f,function(a){g[a.name()]=a.exhibit(h,k)});var d=fB(g,b8),c=uw.map(d,function(i,a){return jN.bind(i,function(m){return m.modification().fold(function(){return[]},function(e){return[m]})})}),b=uw.mapToArray(c,function(i,a){return jV(hI,a).fold(function(){return s4.error("Unknown field type: "+a)},function(e){return e(i,a)})});return fK(b,{}).map(b5)}(Q,z,J,D).getOrDie(),B=(V=D,K=Y,I=uM.deepMerge({tag:V.tag(),classes:K.classes().getOr([]).concat(V.classes().getOr([])),attributes:uM.merge(V.attributes().getOr({}),K.attributes().getOr({})),styles:uM.merge(V.styles().getOr({}),K.styles().getOr({}))},K.innerHtml().or(V.innerHtml()).map(function(a){return kK("innerHtml",a)}).getOr({}),hV("domChildren",K.domChildren(),V.domChildren()),hV("defChildren",K.defChildren(),V.defChildren()),K.value().or(V.value()).map(function(a){return kK("value",a)}).getOr({})),jw(I)),A=aP(B),j={"alloy.base.behaviour":(P=M,P.events())},q=(E=Q,Z=M.eventOrder(),X=J,G=j,U=iM(E,X,G),az(U,Z)).getOrDie(),O=eY(M.components()),H=l9({getSystem:W.get,config:function(b){if(b===aF()){return M.apis()}var a=Q;return(uJ.isFunction(a[b.name()])?a[b.name()]:function(){throw new Error("Could not find "+b.name()+" in "+fq(F,null,2))})()},hasConfigured:function(a){return uJ.isFunction(Q[a.name()])},spec:ub.constant(F),readState:function(a){return Q[a]().map(function(b){return b.state.readState()}).getOr("not enabled")},connect:function(a){W.set(a)},disconnect:function(){W.set(mz(N))},element:ub.constant(A),syncComponents:function(){var b=n0.children(A),a=jN.bind(b,function(c){return W.get().getByDom(c).fold(function(){return[]},function(d){return[d]})});O.set(a)},components:O.get,events:ub.constant(q)});return H},nL=function(g){var d,b,f=m7(g),c=(d=f,b=eW("components",[])(d),jN.map(b,u6)),a=uM.deepMerge(kV,f,kK("components",c));return s4.value(oQ(a))},qY=function(b){var a=lA.fromText(b);return lB({element:a})},lB=function(d){var a=oH("external.component",cM([tq("element"),pw("uid")]),d),b=eY(mz());a.uid().each(function(g){var f;f=a.element(),uV.set(f,g1,g)});var c=l9({getSystem:b.get,config:sX.none,hasConfigured:ub.constant(!1),connect:function(e){b.set(e)},disconnect:function(){b.set(mz(function(){return c}))},element:ub.constant(a.element()),spec:ub.constant(d),readState:ub.constant("No state"),syncComponents:ub.noop,components:ub.constant([]),events:ub.constant({})});return cO(c)},u6=function(a){return(b=a,jV(b,c1)).fold(function(){var c=uM.deepMerge({uid:aV("")},a);return nL(c).getOrDie()},function(c){return c});var b},tN=cO,mY="alloy.item-hover",r4="alloy.item-focus",pW=function(a){(qz(a.element()).isNone()||hJ.isFocused(a))&&(hJ.isFocused(a)||hJ.focus(a),sB(a,mY,{item:a}))},sS=function(a){sB(a,r4,{item:a})},pF=ub.constant(mY),rN=ub.constant(r4),oz=[tq("data"),tq("components"),tq("dom"),pw("toggling"),q6("itemBehaviours",{}),q6("ignoreFocus",!1),q6("domModification",{}),rI("builder",function(c){return{dom:uM.deepMerge(c.dom(),{attributes:{role:c.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:uM.deepMerge(a2([c.toggling().fold(m8.revoke,function(d){return m8.config(uM.deepMerge({aria:{mode:"checked"}},d))}),hJ.config({ignore:c.ignoreFocus(),onFocus:function(d){sS(d)}}),nM.config({mode:"execution"}),eH.config({store:{mode:"memory",initialValue:c.data()}})]),c.itemBehaviours()),events:iZ([(a=gD(),b=l8,dG(a,function(f,d){f.getSystem().getByDom(d.event().target()).each(function(e){b(f,e,d)})})),j3(uI()),dG(uE(),pW),dG(nU(),hJ.focus)]),components:c.components(),domModification:c.domModification(),eventOrder:c.eventOrder()};var a,b}),q6("eventOrder",{})],rw=[tq("dom"),tq("components"),rI("builder",function(b){return{dom:b.dom(),components:b.components(),events:iZ([(a=nU(),dG(a,function(d,c){c.stop()}))])};var a})],kM=ub.constant("item-widget"),iD=ub.constant([fY({name:"widget",overrides:function(a){return{behaviours:a2([eH.config({store:{mode:"manual",getValue:function(b){return a.data()},setValue:function(){}}})])}}})]),uL=[tq("uid"),tq("data"),tq("components"),tq("dom"),q6("autofocus",!1),q6("domModification",{}),bY(iD()),rI("builder",function(a){var f=h6(kM(),a,iD()),c=qK(kM(),a,f.internals()),d=function(e){return hS(e,a,"widget").map(function(g){return nM.focusIn(g),g})},b=function(h,g){return hM(g.event().target())||a.autofocus()&&g.setSource(h.element()),sX.none()};return uM.deepMerge({dom:a.dom(),components:c,domModification:a.domModification(),events:iZ([mw(function(h,g){d(h).each(function(e){g.stop()})}),dG(uE(),pW),dG(nU(),function(h,g){a.autofocus()?d(h):hJ.focus(h)})]),behaviours:a2([eH.config({store:{mode:"memory",initialValue:a.data()}}),hJ.config({onFocus:function(e){sS(e)}}),nM.config({mode:"special",focusIn:a.autofocus()?function(e){d(e)}:oW(),onLeft:b,onRight:b,onEscape:function(h,g){return hJ.isFocused(h)||a.autofocus()?(a.autofocus()&&g.setSource(h.element()),sX.none()):(hJ.focus(h),sX.some(!0))}})])})})],jX=qR("type",{widget:uL,item:oz,separator:rw}),jb=ub.constant([d6({factory:{sketch:function(b){var a=oH("menu.spec item",jX,b);return a.builder()(a)}},name:"items",unit:"item",defaults:function(c,b){var a=aV("");return uM.deepMerge({uid:a},b)},overrides:function(b,a){return{type:a.type,ignoreFocus:b.fakeFocus(),domModification:{classes:[b.markers().item()]}}}})]),dy=ub.constant([tq("value"),tq("items"),tq("dom"),tq("components"),q6("eventOrder",{}),qZ("menuBehaviours",[l6,eH,nZ,nM]),kB("movement",{mode:"menu",moveOnTab:!0},qR("mode",{grid:[rb(),rI("config",function(b,a){return{mode:"flatgrid",selector:"."+b.markers().item(),initSize:{numColumns:a.initSize().numColumns(),numRows:a.initSize().numRows()},focusManager:b.focusManager()}})],menu:[q6("moveOnTab",!0),rI("config",function(b,a){return{mode:"menu",selector:"."+b.markers().item(),moveOnTab:a.moveOnTab(),focusManager:b.focusManager()}})]})),mN("markers",u1()),q6("fakeFocus",!1),q6("focusManager",dS()),rZ("onHighlight")]),dP=(ub.constant("menu"),ub.constant("alloy.menu-focus")),qk=k5({name:"Menu",configFields:dy(),partFields:jb(),factory:function(d,b,a,c){return uM.deepMerge({dom:uM.deepMerge(d.dom(),{attributes:{role:"menu"}}),uid:d.uid(),behaviours:uM.deepMerge(a2([l6.config({highlightClass:d.markers().selectedItem(),itemClass:d.markers().item(),onHighlight:d.onHighlight()}),eH.config({store:{mode:"memory",initialValue:d.value()}}),nZ.config({find:ub.identity}),nM.config(d.movement().config()(d,d.movement()))]),lE(d.menuBehaviours())),events:iZ([dG(rN(),function(g,f){var h=f.event();g.getSystem().getByDom(h.target()).each(function(e){l6.highlight(g,e),f.stop(),sB(g,dP(),{menu:g,item:e})})}),dG(pF(),function(h,g){var f=g.event().item();l6.highlight(h,f)})]),components:b,eventOrder:d.eventOrder()})}}),lR=function(f,c,a,d){var b=f.getSystem().build(d);oD(f,b,a)},e9=function(b,a){return b.components()},kq=Object.freeze({append:function(d,b,a,c){lR(d,0,bG.append,c)},prepend:function(d,b,a,c){lR(d,0,bG.prepend,c)},remove:function(f,c,a,d){var b=e9(f,c);jN.find(b,function(e){return qI(d.element(),e.element())}).each(qN)},set:function(h,f,m,d){var b,g,l,k,j,p;g=(b=h).components(),jN.each(g,nw),aT.empty(b.element()),b.syncComponents(),l=function(){var a=jN.map(d,h.getSystem().build);jN.each(a,function(c){lS(h,c)})},k=h.element(),j=n0.owner(k),p=hR(j).bind(function(a){var c=function(e){return qI(a,e)};return c(k)?sX.some(k):mj.descendant(k,c)}),l(k),p.each(function(a){hR(j).filter(function(c){return qI(c,a)}).orThunk(function(){fw(a)})})},contents:e9}),k2=eq({fields:[],name:"replacing",apis:kq}),nv=function(a,c,b,d){return jV(b,d).bind(function(e){return jV(a,e).bind(function(g){var f=nv(a,c,b,g);return sX.some([g].concat(f))})}).getOr([])},fX=function(h,f){var c={};uw.each(h,function(j,i){jN.each(j,function(e){c[e]=i})});var g,d=f,b=(g=f,uw.tupleMap(g,function(j,i){return{k:j,v:i}})),a=uw.map(b,function(j,i){return[i].concat(nv(c,d,b,i))});return uw.map(c,function(e){return jV(a,e).getOr([e])})},mG=ub.constant("collapse-item"),d5=qO({name:"TieredMenu",configFields:[pA("onExecute"),pA("onEscape"),sN("onOpenMenu"),sN("onOpenSubmenu"),rZ("onCollapseMenu"),q6("openImmediately",!0),pN("data",[tq("primary"),tq("menus"),tq("expansions")]),q6("fakeFocus",!1),rZ("onHighlight"),rZ("onHover"),pN("markers",[tq("backgroundMenu")].concat(qU()).concat(lq())),tq("dom"),q6("navigateOnHover",!0),q6("stayInDom",!1),qZ("tmenuBehaviours",[nM,l6,nZ,k2]),q6("eventOrder",{})],apis:{collapseMenu:function(b,a){b.collapseMenu(a)}},factory:function(k,x){var L,K,w,H,D,B,E=function(a,c){return uw.map(c,function(g,f){var d=qk.sketch(uM.deepMerge(g,{value:f,items:g.items,markers:dC(x.markers,["item","selectedItem"]),fakeFocus:k.fakeFocus(),onHighlight:k.onHighlight(),focusManager:k.fakeFocus()?{get:function(e){return l6.getHighlighted(e).map(function(h){return h.element()})},set:function(h,i){h.getSystem().getByDom(i).fold(ub.noop,function(e){l6.highlight(h,e)})}}:dS()}));return a.getSystem().build(d)})},J=(L=eY({}),K=eY({}),w=eY({}),H=eY(sX.none()),D=eY(ub.constant([])),{setContents:function(h,f,c,g){H.set(sX.some(h)),L.set(c),K.set(f),D.set(g);var d=g(f),a=fX(d,c);w.set(a)},expand:function(a){return jV(L.get(),a).map(function(d){var c=jV(w.get(),a).getOr([]);return[d].concat(c)})},refresh:function(a){return jV(w.get(),a)},collapse:function(a){return jV(w.get(),a).bind(function(c){return 1<c.length?sX.some(c.slice(1)):sX.none()})},lookupMenu:B=function(a){return jV(K.get(),a)},otherMenus:function(c){var a=D.get()(K.get());return jN.difference(uw.keys(a),c)},getPrimary:function(){return H.get().bind(B)},getMenus:function(){return K.get()},clear:function(){L.set({}),K.set({}),w.set({}),H.set(sX.none())},isClear:function(){return H.get().isNone()}}),C=function(a){return eH.getValue(a).value},G=function(c,a){return uw.map(k.data().menus(),function(f,d){return jN.bind(f.items,function(e){return"separator"===e.type?[]:[e.data.value]})})},z=function(a,c){l6.highlight(a,c),l6.getHighlighted(c).orThunk(function(){return l6.getFirst(c)}).each(function(d){oP(a,d.element(),nU())})},F=function(c,a){return ej(jN.map(a,c.lookupMenu))},j=function(d,c,a){return sX.from(a[0]).bind(c.lookupMenu).map(function(h){var g=F(c,a.slice(1));jN.each(g,function(e){iW.add(e.element(),k.markers().backgroundMenu())}),jW.inBody(h.element())||k2.append(d,tN(h)),gV(h.element(),[k.markers().backgroundMenu()]),z(d,h);var f=F(c,c.otherMenus(a));return jN.each(f,function(e){gV(e.element(),[k.markers().backgroundMenu()]),k.stayInDom()||k2.remove(d,e)}),h})},b=function(c,a){var d=C(a);return J.expand(d).bind(function(e){return sX.from(e[0]).bind(J.lookupMenu).each(function(f){jW.inBody(f.element())||k2.append(c,tN(f)),k.onOpenSubmenu()(c,a,f),l6.highlightFirst(f)}),j(c,J,e)})},A=function(c,a){var d=C(a);return J.collapse(d).bind(function(e){return j(c,J,e).map(function(f){return k.onCollapseMenu()(c,a,f),f})})},I=function(a){return function(c,d){return s2(d.getSource(),"."+k.markers().item()).bind(function(e){return c.getSystem().getByDom(e).bind(function(f){return a(c,f)})})}},q=iZ([dG(dP(),function(d,c){var a=c.event().menu();l6.highlight(d,a)}),mw(function(c,d){var a=d.event().target();return c.getSystem().getByDom(a).bind(function(e){return 0===C(e).indexOf("collapse-item")?A(c,e):b(c,e).orThunk(function(){return k.onExecute()(c,e)})})}),kS(function(c,f){var a,d;(a=c,d=E(a,k.data().menus()),J.setContents(k.data().primary(),d,k.data().expansions(),function(e){return G(a,e)}),J.getPrimary()).each(function(e){k2.append(c,tN(e)),k.openImmediately()&&(z(c,e),k.onOpenMenu()(c,e))})})].concat(k.navigateOnHover()?[dG(pF(),function(g,d){var a,f,c=d.event().item();a=g,f=C(c),J.refresh(f).bind(function(e){return j(a,J,e)}),b(g,c),k.onHover()(g,c)})]:[]));return{uid:k.uid(),dom:k.dom(),behaviours:uM.deepMerge(a2([nM.config({mode:"special",onRight:I(function(c,a){return hM(a.element())?sX.none():b(c,a)}),onLeft:I(function(c,a){return hM(a.element())?sX.none():A(c,a)}),onEscape:I(function(c,a){return A(c,a).orThunk(function(){return k.onEscape()(c,a)})}),focusIn:function(a,c){J.getPrimary().each(function(d){oP(a,d.element(),nU())})}}),l6.config({highlightClass:k.markers().selectedMenu(),itemClass:k.markers().menu()}),nZ.config({find:function(a){return l6.getHighlighted(a)}}),k2.config({})]),lE(k.tmenuBehaviours())),eventOrder:k.eventOrder(),apis:{collapseMenu:function(a){l6.getHighlighted(a).each(function(c){l6.getHighlighted(c).each(function(d){A(a,d)})})}},events:q}},extraApis:{tieredData:function(c,b,a){return{primary:c,menus:b,expansions:a}},singleData:function(b,a){return{primary:b,menus:kK(b,a),expansions:{}}},collapseItem:function(a){return{value:rx(mG()),text:a}}}}),hy=function(d,b,a,c){return jV(b.routes(),c.start()).map(ub.apply).bind(function(e){return jV(e,c.destination()).map(ub.apply)})},jF=function(d,b,a,c){return hy(0,b,0,c).bind(function(f){return f.transition().map(function(e){return{transition:ub.constant(e),route:ub.constant(f)}})})},fG=function(b,f,g){var d,c,a;(d=b,c=f,a=g,cw(d,c,a).bind(function(e){return jF(d,c,a,e)})).each(function(i){var h=i.transition();iW.remove(b.element(),h.transitionClass()),uV.remove(b.element(),f.destinationAttr())})},cw=function(d,b,a){var c=d.element();return uV.has(c,b.destinationAttr())?sX.some({start:ub.constant(uV.get(d.element(),b.stateAttr())),destination:ub.constant(uV.get(d.element(),b.destinationAttr()))}):sX.none()},h4=function(d,b,a,c){fG(d,b,a),uV.has(d.element(),b.stateAttr())&&uV.get(d.element(),b.stateAttr())!==c&&b.onFinish()(d,c),uV.set(d.element(),b.stateAttr(),c)},qJ=Object.freeze({findRoute:hy,disableTransition:fG,getCurrentRoute:cw,jumpTo:h4,progressTo:function(m,d,b,g){var f,h;h=d,uV.has((f=m).element(),h.destinationAttr())&&(uV.set(f.element(),h.stateAttr(),uV.get(f.element(),h.destinationAttr())),uV.remove(f.element(),h.destinationAttr()));var l,k,j,p=(l=m,k=d,j=g,{start:ub.constant(uV.get(l.element(),k.stateAttr())),destination:ub.constant(j)});jF(m,d,b,p).fold(function(){h4(m,d,b,g)},function(c){fG(m,d,b);var a=c.transition();iW.add(m.element(),a.transitionClass()),uV.set(m.element(),d.destinationAttr(),g)})},getState:function(d,b,a){var c=d.element();return uV.has(c,b.stateAttr())?sX.some(uV.get(c,b.stateAttr())):sX.none()}}),hP=Object.freeze({events:function(b,a){return iZ([dG(tX(),function(c,e){var d=e.event().raw();cw(c,b,a).each(function(f){hy(0,b,0,f).each(function(g){g.transition().each(function(h){d.propertyName===h.property()&&(h4(c,b,a,f.destination()),b.onTransition()(c,f))})})})}),kS(function(d,c){h4(d,b,a,b.initialState())})])}}),gq=[q6("destinationAttr","data-transitioning-destination"),q6("stateAttr","data-transitioning-state"),tq("initialState"),rZ("onTransition"),rZ("onFinish"),mN("routes",nP(s4.value,nP(s4.value,cM([n9("transition",[tq("property"),tq("transitionClass")])]))))],eS=eq({fields:gq,name:"transitioning",active:hP,apis:qJ,extra:{createRoutes:function(b){var a={};return uw.each(b,function(f,d){var c=d.split("<->");a[c[0]]=kK(c[1],f),a[c[1]]=kK(c[0],f)}),a},createBistate:function(c,b,a){return mW([{key:c,value:kK(b,a)},{key:b,value:kK(c,a)}])},createTristate:function(d,b,a,c){return mW([{key:d,value:mW([{key:b,value:c},{key:a,value:c}])},{key:b,value:mW([{key:d,value:c},{key:a,value:c}])},{key:a,value:mW([{key:d,value:c},{key:b,value:c}])}])}}}),bX=jA.resolve("scrollable"),c0={register:function(a){iW.add(a,bX)},deregister:function(a){iW.remove(a,bX)},scrollable:ub.constant(bX)},iS=function(a){return jV(a,"format").getOr(a.title)},cL=function(f,c,a,d,b){return{data:{value:f,text:c},type:"item",dom:{tag:"div",classes:b?[jA.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:jA.resolve("format-matches"),selected:a},itemBehaviours:a2(b?[]:[fS(f,function(h,g){(g?m8.on:m8.off)(h)})]),components:[{dom:{tag:"div",attributes:{style:d},innerHtml:c}}]}},n1=function(d,b,a,c){return{value:d,dom:{tag:"div"},components:[uU.sketch({dom:{tag:"div",classes:[jA.resolve("styles-collapser")]},components:c?[{dom:{tag:"span",classes:[jA.resolve("styles-collapse-icon")]}},qY(d)]:[qY(d)],action:function(g){if(c){var f=a().get(g);d5.collapseMenu(f)}}}),{dom:{tag:"div",classes:[jA.resolve("styles-menu-items-container")]},components:[qk.parts().items({})],behaviours:a2([cY("adhoc-scrollable-menu",[kS(function(g,f){nX.set(g.element(),"overflow-y","auto"),nX.set(g.element(),"-webkit-overflow-scrolling","touch"),c0.register(g.element())}),m4(function(e){nX.remove(e.element(),"overflow-y"),nX.remove(e.element(),"-webkit-overflow-scrolling"),c0.deregister(e.element())})])])}],items:b,menuBehaviours:a2([eS.config({initialState:"after",routes:eS.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},aE=function(j){var g,f,k,h,d,c=(g=j.formats,f=function(){return b},k=n1("Styles",[].concat(jN.map(g.items,function(a){return cL(iS(a),a.title,a.isSelected(),a.getPreview(),l7(g.expansions,iS(a)))})),f,!1),h=uw.map(g.menus,function(l,i){var a=jN.map(l,function(e){return cL(iS(e),e.title,e.isSelected!==undefined&&e.isSelected(),e.getPreview!==undefined?e.getPreview():"",l7(g.expansions,iS(e)))});return n1(i,a,f,!0)}),d=uM.deepMerge(h,kK("styles",k)),{tmenu:d5.tieredData("styles",d,g.expansions)}),b=tJ(d5.sketch({dom:{tag:"div",classes:[jA.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(l,i){var a=eH.getValue(i);j.handle(i,a.value)},onEscape:function(){},onOpenMenu:function(l,i){var a=nQ(l.element());cx(i.element(),a),eS.jumpTo(i,"current")},onOpenSubmenu:function(s,p,l){var q=nQ(s.element()),m=k1(p.element(),'[role="menu"]').getOrDie("hacky"),a=s.getSystem().getByDom(m).getOrDie();cx(l.element(),q),eS.progressTo(a,"before"),eS.jumpTo(l,"after"),eS.progressTo(l,"current")},onCollapseMenu:function(p,l,a){var m=k1(l.element(),'[role="menu"]').getOrDie("hacky"),i=p.getSystem().getByDom(m).getOrDie();eS.progressTo(i,"after"),eS.progressTo(a,"current")},navigateOnHover:!1,openImmediately:!0,data:c.tmenu,markers:{backgroundMenu:jA.resolve("styles-background-menu"),menu:jA.resolve("styles-menu"),selectedMenu:jA.resolve("styles-selected-menu"),item:jA.resolve("styles-item"),selectedItem:jA.resolve("styles-selected-item")}}));return b.asSpec()},gK=function(d){return l7(d,"items")?(b=d,a=uM.deepMerge(p0(b,["items"]),{menu:!0}),c=bH(b.items),{item:a,menus:uM.deepMerge(c.menus,kK(b.title,c.items)),expansions:uM.deepMerge(c.expansions,kK(b.title,b.title))}):{item:d,menus:{},expansions:{}};var b,a,c},bH=function(a){return jN.foldr(a,function(d,c){var b=gK(c);return{menus:uM.deepMerge(d.menus,b.menus),items:[b.item].concat(d.items),expansions:uM.deepMerge(d.expansions,b.expansions)}},{menus:{},expansions:{},items:[]})},bb={expand:bH},g0=function(b,j){var i=function(a){return function(){return b.formatter.match(a)}},d=function(a){return function(){return b.formatter.getCssText(a)}},h=jV(j,"style_formats").getOr(j6),g=function(a){return jN.map(a,function(q){if(l7(q,"items")){var m=g(q.items);return uM.deepMerge((c=q,uM.deepMerge(c,{isSelected:ub.constant(!1),getPreview:ub.constant("")})),{items:m})}return l7(q,"format")?(f=q,uM.deepMerge(f,{isSelected:i(f.format),getPreview:d(f.format)})):(p=rx((k=q).title),l=uM.deepMerge(k,{format:p,isSelected:i(p),getPreview:d(p)}),b.formatter.register(p,l),l);var k,p,l,f,c})};return g(h)},eC=function(c,h,g){var f,d,b,a=(f=c,b=(d=function(e){return jN.bind(e,function(i){return i.items!==undefined?0<d(i.items).length?[i]:[]:!l7(i,"format")||f.formatter.canApply(i.format)?[i]:[]})})(h),bb.expand(b));return aE({formats:a,handle:function(j,i){c.undoManager.transact(function(){m8.isOn(j)?c.formatter.remove(i):c.formatter.apply(i)}),g()}})},aU=["undo","bold","italic","link","image","bullist","styleselect"],o0=function(b){var a=b.replace(/\|/g," ").trim();return 0<a.length?a.split(/\s+/):[]},sv=function(a){return jN.bind(a,function(b){return uJ.isArray(b)?sv(b):o0(b)})},l0=function(b){var a=b.toolbar!==undefined?b.toolbar:aU;return uJ.isArray(a)?sv(a):o0(a)},oJ=function(k,b){var q=function(a){return function(){return n6.forToolbarCommand(b,a)}},B=function(a){return function(){return n6.forToolbarStateCommand(b,a)}},G=function(d,c,a){return function(){return n6.forToolbarStateAction(b,d,c,a)}},x=q("undo"),F=q("redo"),E=B("bold"),D=B("italic"),H=B("underline"),A=q("removeformat"),w=G("unlink","link",function(){b.execCommand("unlink",null,!1)}),C=G("unordered-list","ul",function(){b.execCommand("InsertUnorderedList",null,!1)}),v=G("ordered-list","ol",function(){b.execCommand("InsertOrderedList",null,!1)}),z=g0(b,b.settings),j=function(){return eC(b,z,function(){b.fire("scrollIntoView")})},y=function(c,a){return{isSupported:function(){return c.forall(function(d){return l7(b.buttons,d)})},sketch:a}};return{undo:y(sX.none(),x),redo:y(sX.none(),F),bold:y(sX.none(),E),italic:y(sX.none(),D),underline:y(sX.none(),H),removeformat:y(sX.none(),A),link:y(sX.none(),function(){return c=k,a=b,n6.forToolbarStateAction(a,"link","link",function(){var d=e3(c,a);c.setContextToolbar(d),bV(a,function(){c.focusToolbar()}),hL.query(a).each(function(e){a.selection.select(e.dom())})});var c,a}),unlink:y(sX.none(),w),image:y(sX.none(),function(){return d3(b)}),bullist:y(sX.some("bullist"),C),numlist:y(sX.some("numlist"),v),fontsizeselect:y(sX.none(),function(){return a=b,c={onChange:function(d){nJ.apply(a,d)},getInitialValue:function(){return nJ.get(a)}},bw(k,"font-size",function(){return u4(c)});var a,c}),forecolor:y(sX.none(),function(){return gP(k,b)}),styleselect:y(sX.none(),function(){return n6.forToolbar("style-formats",function(a){b.fire("toReading"),k.dropup().appear(j,m8.on,a)},a2([m8.config({toggleClass:jA.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),iw.config({channels:mW([d1(bN.orientationChanged(),m8.off),d1(bN.dropupDismissed(),m8.off)])})]))})}},nE=function(d,a){var b=l0(d),c={};return jN.bind(b,function(g){var f=!l7(c,g)&&l7(a,g)&&a[g].isSupported()?[a[g].sketch()]:[];return c[g]=!0,f})},qS=function(a,b){return function(j){if(a(j)){var q,z,h,g,m,y,x,w=lA.fromDom(j.target),A=function(){j.stopPropagation()},p=function(){j.preventDefault()},k=ub.compose(p,A),v=(q=w,z=j.clientX,h=j.clientY,g=A,m=p,y=k,x=j,{target:ub.constant(q),x:ub.constant(z),y:ub.constant(h),stop:g,prevent:m,kill:y,raw:ub.constant(x)});b(v)}}},lj=function(g,d,b,f,c){var a=qS(b,f);return g.dom().addEventListener(d,a,c),{unbind:ub.curry(uZ,g,d,a,c)}},uZ=function(d,b,a,c){d.dom().removeEventListener(b,a,c)},tx=function(d,b,a,c){return lj(d,b,a,c,!1)},mP=function(d,b,a,c){return lj(d,b,a,c,!0)},rX=ub.constant(!0),pP=function(c,b,a){return tx(c,b,rX,a)},sL=function(c,b,a){return mP(c,b,rX,a)},py=function(b){var a=b.matchMedia("(orientation: portrait)").matches;return{isPortrait:ub.constant(a)}},rG=py,oj=function(f,d){var g=lA.fromDom(f),c=null,b=pP(g,"orientationchange",function(){clearInterval(c);var e=py(f);d.onChange(e),a(function(){d.onReady(e)})}),a=function(j){clearInterval(c);var i=f.innerHeight,h=0;c=setInterval(function(){i!==f.innerHeight?(clearInterval(c),j(sX.some(f.innerHeight))):20<h&&(clearInterval(c),j(sX.none())),h++},50)};return{onAdjustment:a,destroy:function(){b.unbind()}}},q8=function(c){var b=f6.detect().os.isiOS(),a=py(c).isPortrait();return b&&!a?c.screen.height:c.screen.width},kD=function(a){return a.raw().touches===undefined||1!==a.raw().touches.length?sX.none():sX.some(a.raw().touches[0])},iq=function(f){var h,g,e,d=eY(sX.none()),b=(h=function(a){d.set(sX.none()),f.triggerEvent(bA(),a)},g=400,e=null,{cancel:function(){null!==e&&(clearTimeout(e),e=null)},schedule:function(){for(var i=[],c=0;c<arguments.length;c++){i[c]=arguments[c]}var a=arguments;e=setTimeout(function(){h.apply(null,a),e=null},g)}}),j=mW([{key:uP(),value:function(a){return kD(a).each(function(i){b.cancel();var c={x:ub.constant(i.clientX),y:ub.constant(i.clientY),target:a.target};b.schedule(a),d.set(sX.some(c))}),sX.none()}},{key:t5(),value:function(a){return b.cancel(),kD(a).each(function(c){d.get().each(function(p){var l,i,m,k;l=c,i=p,m=Math.abs(l.clientX-i.x()),k=Math.abs(l.clientY-i.y()),(5<m||5<k)&&d.set(sX.none())})}),sX.none()}},{key:uB(),value:function(a){return b.cancel(),d.get().filter(function(c){return qI(c.target(),a.target())}).map(function(c){return f.triggerEvent(ax(),a)})}}]);return{fireIfReady:function(a,c){return jV(j,c).bind(function(i){return i(a)})}}},uv=function(a){var b=iq({triggerEvent:function(d,c){a.onTapContent(c)}});return{fireTouchstart:function(c){b.fireIfReady(c,"touchstart")},onTouchend:function(){return pP(a.body(),"touchend",function(c){b.fireIfReady(c,"touchend")})},onTouchmove:function(){return pP(a.body(),"touchmove",function(c){b.fireIfReady(c,"touchmove")})}}},jO=6<=f6.detect().os.version.major,i1=function(j,h,f){var g=uv(j),d=n0.owner(h),c=function(a){return !qI(a.start(),a.finish())||a.soffset()!==a.foffset()},k=function(){var a=j.doc().dom().hasFocus()&&j.getSelection().exists(c);f.getByDom(h).each(!0===(a||hR(d).filter(function(e){return"input"===kL.name(e)}).exists(function(e){return e.dom().selectionStart!==e.dom().selectionEnd}))?m8.on:m8.off)},b=[pP(j.body(),"touchstart",function(a){j.onTouchContent(),g.fireTouchstart(a)}),g.onTouchmove(),g.onTouchend(),pP(h,"touchstart",function(a){j.onTouchToolstrip()}),j.onToReading(function(){b3(j.body())}),j.onToEditing(ub.noop),j.onScrollToCursor(function(a){a.preventDefault(),j.getCursorBox().each(function(m){var l=j.win(),i=m.top()>l.innerHeight||m.bottom()>l.innerHeight?m.bottom()-l.innerHeight+50:0;0!==i&&l.scrollTo(l.pageXOffset,l.pageYOffset+i)})})].concat(!0===jO?[]:[pP(lA.fromDom(j.win()),"blur",function(){f.getByDom(h).each(m8.off)}),pP(d,"select",k),pP(j.doc(),"selectionchange",k)]);return{destroy:function(){jN.each(b,function(a){a.unbind()})}}},db=function(c,b){var a=parseInt(uV.get(c,b),10);return isNaN(a)?0:a},dI=(qh=kL.isText,lO="text",e7=function(a){return qh(a)?sX.from(a.dom().nodeValue):sX.none()},kb=f6.detect().browser,{get:function(a){if(!qh(a)){throw new Error("Can only get "+lO+" value of a "+lO+" node")}return kZ(a).getOr("")},getOption:kZ=kb.isIE()&&10===kb.version.major?function(b){try{return e7(b)}catch(a){return sX.none()}}:e7,set:function(b,a){if(!qh(b)){throw new Error("Can only set raw "+lO+" value of a "+lO+" node")}b.dom().nodeValue=a}}),p6=function(a){return dI.getOption(a)},lJ=function(a){return"img"===kL.name(a)?1:p6(a).fold(function(){return n0.children(a).length},function(b){return b.length})},e2=lJ,j5=mH([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),kU={before:j5.before,on:j5.on,after:j5.after,cata:function(d,b,a,c){return d.fold(b,a,c)},getStart:function(a){return a.fold(ub.identity,ub.identity,ub.identity)}},m6=mH([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),fQ=kj.immutable("start","soffset","finish","foffset"),my={domRange:m6.domRange,relative:m6.relative,exact:m6.exact,exactFromRange:function(a){return m6.exact(a.start(),a.soffset(),a.finish(),a.foffset())},range:fQ,getWin:function(b){var a=b.match({domRange:function(c){return lA.fromDom(c.startContainer)},relative:function(d,c){return kU.getStart(d)},exact:function(g,d,c,f){return g}});return n0.defaultView(a)}},dZ=function(f,c,a,d){var b=n0.owner(f).dom().createRange();return b.setStart(f.dom(),c),b.setEnd(a.dom(),d),b},hb=function(g,d,b,f){var c=dZ(g,d,b,f),a=qI(g,b)&&d===f;return c.collapsed&&!a},jy=function(b,a){b.selectNodeContents(a.dom())},fA=function(a){a.deleteContents()},b7=function(a){return{left:ub.constant(a.left),top:ub.constant(a.top),right:ub.constant(a.right),bottom:ub.constant(a.bottom),width:ub.constant(a.width),height:ub.constant(a.height)}},hX={create:function(a){return a.document.createRange()},replaceWith:function(b,a){fA(b),b.insertNode(a.dom())},selectNodeContents:function(c,b){var a=c.document.createRange();return jy(a,b),a},selectNodeContentsUsing:jy,relativeToNative:function(g,d,b){var f,c,a=g.document.createRange();return f=a,d.fold(function(e){f.setStartBefore(e.dom())},function(i,h){f.setStart(i.dom(),h)},function(e){f.setStartAfter(e.dom())}),c=a,b.fold(function(e){c.setEndBefore(e.dom())},function(i,h){c.setEnd(i.dom(),h)},function(e){c.setEndAfter(e.dom())}),a},exactToNative:function(g,d,b,f,c){var a=g.document.createRange();return a.setStart(d.dom(),b),a.setEnd(f.dom(),c),a},deleteContents:fA,cloneFragment:function(b){var a=b.cloneContents();return lA.fromDom(a)},getFirstRect:function(c){var b=c.getClientRects(),a=0<b.length?b[0]:c.getBoundingClientRect();return 0<a.width||0<a.height?sX.some(a).map(b7):sX.none()},getBounds:function(b){var a=b.getBoundingClientRect();return 0<a.width||0<a.height?sX.some(a).map(b7):sX.none()},isWithin:function(b,a){return a.compareBoundaryPoints(b.END_TO_START,b)<1&&-1<a.compareBoundaryPoints(b.START_TO_END,b)},toString:function(a){return a.toString()}},qD=mH([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),hH=function(c,b,a){return b(lA.fromDom(a.startContainer),a.startOffset,lA.fromDom(a.endContainer),a.endOffset)},f7=function(g,d){var c,b,f,a=(c=g,d.match({domRange:function(e){return{ltr:ub.constant(e),rtl:sX.none}},relative:function(i,h){return{ltr:uG(function(){return hX.relativeToNative(c,i,h)}),rtl:uG(function(){return sX.some(hX.relativeToNative(c,h,i))})}},exact:function(k,i,h,j){return{ltr:uG(function(){return hX.exactToNative(c,k,i,h,j)}),rtl:uG(function(){return sX.some(hX.exactToNative(c,h,j,k,i))})}}}));return(f=(b=a).ltr()).collapsed?b.rtl().filter(function(e){return !1===e.collapsed}).map(function(e){return qD.rtl(lA.fromDom(e.endContainer),e.endOffset,lA.fromDom(e.startContainer),e.startOffset)}).getOrThunk(function(){return hH(0,qD.ltr,f)}):hH(0,qD.ltr,f)},eM=(qD.ltr,qD.rtl,f7),bR=function(a,b){return f7(a,b).match({ltr:function(h,f,c,g){var d=a.document.createRange();return d.setStart(h.dom(),f),d.setEnd(c.dom(),g),d},rtl:function(h,f,c,g){var d=a.document.createRange();return d.setStart(c.dom(),g),d.setEnd(h.dom(),f),d}})},cU=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(c,b){var a=kL.name(c);return"input"===a?kU.after(c):jN.contains(["br","img"],a)?0===b?kU.before(c):kU.after(c):kU.on(c,b)}),iL=function(g,d,b,f){var c=cU(g,d),a=cU(b,f);return my.relative(c,a)},cE=iL,nV=function(b,a){sX.from(b.getSelection()).each(function(c){c.removeAllRanges(),c.addRange(a)})},ay=function(g,d,b,f,c){var a=hX.exactToNative(g,d,b,f,c);nV(g,a)},gE=function(a,b){return eM(a,b).match({ltr:function(g,d,c,f){ay(a,g,d,c,f)},rtl:function(h,f,c,g){var d=a.getSelection();d.setBaseAndExtent?d.setBaseAndExtent(h.dom(),f,c.dom(),g):d.extend?(d.collapse(h.dom(),f),d.extend(c.dom(),g)):ay(a,c,g,h,f)}})},bB=function(c){var b=lA.fromDom(c.anchorNode),a=lA.fromDom(c.focusNode);return hb(b,c.anchorOffset,a,c.focusOffset)?sX.some(my.range(lA.fromDom(c.anchorNode),c.anchorOffset,lA.fromDom(c.focusNode),c.focusOffset)):function(g){if(0<g.rangeCount){var f=g.getRangeAt(0),d=g.getRangeAt(g.rangeCount-1);return sX.some(my.range(lA.fromDom(f.startContainer),f.startOffset,lA.fromDom(d.endContainer),d.endOffset))}return sX.none()}(c)},a4=function(a){return sX.from(a.getSelection()).filter(function(b){return 0<b.rangeCount}).bind(bB)},gU=function(g,d,b,f,c){var a=cE(d,b,f,c);gE(g,a)},ew=a4,aO=function(a){return a4(a).map(function(b){return my.exact(b.start(),b.soffset(),b.finish(),b.foffset())})},o4=function(a){a.getSelection().removeAllRanges()},sz=function(c,b){var a=bR(c,b);return hX.getFirstRect(a)},l4=function(a){return{left:a.left,top:a.top,right:a.right,bottom:a.bottom,width:ub.constant(2),height:a.height}},oN=function(a){return{left:ub.constant(a.left),top:ub.constant(a.top),right:ub.constant(a.right),bottom:ub.constant(a.bottom),width:ub.constant(a.width),height:ub.constant(a.height)}},nI=function(b){var a=b.getSelection();return a!==undefined&&0<a.rangeCount?function(c){if(c.collapsed){var d=lA.fromDom(c.startContainer);return n0.parent(d).bind(function(g){var f=my.exact(d,c.startOffset,g,e2(g));return sz(c.startContainer.ownerDocument.defaultView,f).map(l4).map(jN.pure)}).getOr([])}return jN.map(c.getClientRects(),oN)}(a.getRangeAt(0)):[]},qW=function(b){b.focus();var a=lA.fromDom(b.document.body);(hR().exists(function(c){return jN.contains(["input","textarea"],kL.name(c))})?function(c){setTimeout(function(){c()},0)}:ub.apply)(function(){hR().each(b3),fw(a)})},lw="data-"+jA.resolve("last-outer-height"),u3=function(b,a){uV.set(b,lw,a)},tH=function(a){return{top:ub.constant(a.top()),bottom:ub.constant(a.top()+a.height())}},mT=function(d,b){var a=db(b,lw),c=d.innerHeight;return c<a?sX.some(a-c):sX.none()},r1=function(d,a){var c=lA.fromDom(a.document.body),b=pP(lA.fromDom(d),"resize",function(){mT(d,c).each(function(f){var h,g;(h=a,g=nI(h),0<g.length?sX.some(g[0]).map(tH):sX.none()).each(function(m){var k,i,l,j=(k=a,l=f,(i=m).top()>k.innerHeight||i.bottom()>k.innerHeight?Math.min(l,i.bottom()-k.innerHeight+50):0);0!==j&&a.scrollTo(a.pageXOffset,a.pageYOffset+j)})}),u3(c,d.innerHeight)});return u3(c,d.innerHeight),{toEditing:function(){qW(a)},destroy:function(){b.unbind()}}},pT=function(a){return sX.some(lA.fromDom(a.dom().contentWindow.document.body))},sP=function(a){return sX.some(lA.fromDom(a.dom().contentWindow.document))},pC=function(a){return sX.from(a.dom().contentWindow)},rK=function(a){return pC(a).bind(ew)},ow=function(a){return a.getFrame()},rk=function(b,a){return function(c){return c[b].getOrThunk(function(){var d=ow(c);return function(){return a(d)}})()}},kH=function(d,b,a,c){return d[a].getOrThunk(function(){return function(e){return pP(b,c,e)}})},iy=function(a){return{left:ub.constant(a.left),top:ub.constant(a.top),right:ub.constant(a.right),bottom:ub.constant(a.bottom),width:ub.constant(a.width),height:ub.constant(a.height)}},uF={getBody:rk("getBody",pT),getDoc:rk("getDoc",sP),getWin:rk("getWin",pC),getSelection:rk("getSelection",rK),getFrame:ow,getActiveApi:function(b){var d=ow(b);return pT(d).bind(function(a){return sP(d).bind(function(c){return pC(d).map(function(g){var j=lA.fromDom(c.dom().documentElement),h=b.getCursorBox.getOrThunk(function(){return function(){return aO(g).bind(function(e){return sz(g,e).orThunk(function(){return ew(g).filter(function(k){return qI(k.start(),k.finish())&&k.soffset()===k.foffset()}).bind(function(l){var k=l.start().dom().getBoundingClientRect();return 0<k.width||0<k.height?sX.some(k).map(iy):sX.none()})})})}}),f=b.setSelection.getOrThunk(function(){return function(p,l,k,m){gU(g,p,l,k,m)}}),i=b.clearSelection.getOrThunk(function(){return function(){o4(g)}});return{body:ub.constant(a),doc:ub.constant(c),win:ub.constant(g),html:ub.constant(j),getSelection:ub.curry(rK,d),setSelection:f,clearSelection:i,frame:ub.constant(d),onKeyup:kH(b,c,"onKeyup","keyup"),onNodeChanged:kH(b,c,"onNodeChanged","selectionchange"),onDomChanged:b.onDomChanged,onScrollToCursor:b.onScrollToCursor,onScrollToElement:b.onScrollToElement,onToReading:b.onToReading,onToEditing:b.onToEditing,onToolbarScrollStart:b.onToolbarScrollStart,onTouchContent:b.onTouchContent,onTapContent:b.onTapContent,onTouchToolstrip:b.onTouchToolstrip,getCursorBox:h}})})})}},jS="data-ephox-mobile-fullscreen-style",i5="position:absolute!important;",dv="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",dM=f6.detect().os.isAndroid(),qb=function(k,h){var f,j,g=function(a){return function(m){var l=uV.get(m,"style"),i=l===undefined?"no-styles":l.trim();i!==a&&(uV.set(m,jS,i),uV.set(m,"style",a))}},d=r7(k,"*"),c=jN.bind(d,function(a){return lQ(a,"*")}),b=(f=h,(j=nX.get(f,"background-color"))!==undefined&&""!==j?"background-color:"+j+"!important":"background-color:rgb(255,255,255)!important;");jN.each(c,g("display:none!important;")),jN.each(d,g(i5+dv+b)),g((!0===dM?"":i5)+dv+b)(k)},lN=function(){var a=oT("["+jS+"]");jN.each(a,function(c){var b=uV.get(c,jS);"no-styles"!==b?uV.set(c,"style",b):uV.remove(c,"style"),uV.remove(c,jS)})},e6=function(){var b=qM("head").getOrDie(),c=qM('meta[name="viewport"]').getOrThunk(function(){var d=lA.fromTag("meta");return uV.set(d,"name","viewport"),bG.append(b,d),d}),a=uV.get(c,"content");return{maximize:function(){uV.set(c,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){a!==undefined&&null!==a&&0<a.length?uV.set(c,"content",a):uV.set(c,"content","user-scalable=yes")}}},j9=function(c,f){var a=e6(),d=jP(),b=jP();return{enter:function(){f.hide(),iW.add(c.container,jA.resolve("fullscreen-maximized")),iW.add(c.container,jA.resolve("android-maximized")),a.maximize(),iW.add(c.body,jA.resolve("android-scroll-reload")),d.set(r1(c.win,uF.getWin(c.editor).getOrDie("no"))),uF.getActiveApi(c.editor).each(function(e){qb(c.container,e.body()),b.set(i1(e,c.toolstrip,c.alloy))})},exit:function(){a.restore(),f.show(),iW.remove(c.container,jA.resolve("fullscreen-maximized")),iW.remove(c.container,jA.resolve("android-maximized")),lN(),iW.remove(c.body,jA.resolve("android-scroll-reload")),b.clear(),d.clear()}}},kY=function(b,a){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){var d=arguments;null===c&&(c=setTimeout(function(){b.apply(null,d),d=c=null},a))}}},nb=function(b,a){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){var d=arguments;null!==c&&clearTimeout(c),c=setTimeout(function(){b.apply(null,d),d=c=null},a)}}},fU=function(d,b){var a=tJ(aC.sketch({dom:pK('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:a2([m8.config({toggleClass:jA.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),c=kY(d,200);return aC.sketch({dom:pK('<div class="${prefix}-disabled-mask"></div>'),components:[aC.sketch({dom:pK('<div class="${prefix}-content-container"></div>'),components:[uU.sketch({dom:pK('<div class="${prefix}-content-tap-section"></div>'),components:[a.asSpec()],action:function(e){c.throttle()},buttonBehaviours:a2([m8.config({toggleClass:jA.resolve("mask-tap-icon-selected")})])})]})]})},mC=iB([pN("editor",[tq("getFrame"),pw("getBody"),pw("getDoc"),pw("getWin"),pw("getSelection"),pw("setSelection"),pw("clearSelection"),pw("cursorSaver"),pw("onKeyup"),pw("onNodeChanged"),pw("getCursorBox"),tq("onDomChanged"),q6("onTouchContent",ub.noop),q6("onTapContent",ub.noop),q6("onTouchToolstrip",ub.noop),q6("onScrollToCursor",ub.constant({unbind:ub.noop})),q6("onScrollToElement",ub.constant({unbind:ub.noop})),q6("onToEditing",ub.constant({unbind:ub.noop})),q6("onToReading",ub.constant({unbind:ub.noop})),q6("onToolbarScrollStart",ub.identity)]),tq("socket"),tq("toolstrip"),tq("dropup"),tq("toolbar"),tq("container"),tq("alloy"),ij("win",function(a){return n0.owner(a.socket).dom().defaultView}),ij("body",function(a){return lA.fromDom(a.socket.dom().ownerDocument.body)}),q6("translate",ub.identity),q6("setReadOnly",ub.noop),q6("readOnlyOnInit",ub.constant(!0))]),d2=function(f){var c=lY("Getting AndroidWebapp schema",mC,f);nX.set(c.toolstrip,"width","100%");var a=u6(fU(function(){c.setReadOnly(c.readOnlyOnInit()),b.enter()},c.translate));c.alloy.add(a);var d={show:function(){c.alloy.add(a)},hide:function(){c.alloy.remove(a)}};bG.append(c.container,a.element());var b=j9(c,d);return{setReadOnly:c.setReadOnly,refreshStructure:ub.noop,enter:b.enter,exit:b.exit,destroy:ub.noop}},hq=ub.constant([q6("shell",!0),qZ("toolbarBehaviours",[k2])]),jB=ub.constant([mI({name:"groups",overrides:function(a){return{behaviours:a2([k2.config({})])}}})]),fD=(ub.constant("Toolbar"),k5({name:"Toolbar",configFields:hq(),partFields:jB(),factory:function(d,g,b,f){var c=function(e){return d.shell()?sX.some(e):hS(e,d,"groups")},a=d.shell()?{behaviours:[k2.config({})],components:[]}:{behaviours:[],components:g};return{uid:d.uid(),dom:d.dom(),components:a.components,behaviours:uM.deepMerge(a2(a.behaviours),lE(d.toolbarBehaviours())),apis:{setGroups:function(i,h){c(i).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(e){k2.set(e,h)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(c,b,a){c.setGroups(b,a)}}})),cb=ub.constant([tq("items"),(nj=["itemClass"],pN("markers",jN.map(nj,tq))),qZ("tgroupBehaviours",[nM])]),h0=ub.constant([d6({name:"items",unit:"item",overrides:function(a){return{domModification:{classes:[a.markers().itemClass()]}}}})]),qG=(ub.constant("ToolbarGroup"),k5({name:"ToolbarGroup",configFields:cb(),partFields:h0(),factory:function(d,b,a,c){return uM.deepMerge({dom:{attributes:{role:"toolbar"}}},{uid:d.uid(),dom:d.dom(),components:b,behaviours:uM.deepMerge(a2([nM.config({mode:"flow",selector:"."+d.markers().itemClass()})]),lE(d.tgroupBehaviours())),"debug.sketcher":a["debug.sketcher"]})}})),hK="data-"+jA.resolve("horizontal-scroll"),gb=function(a){return 0<a.dom().scrollTop||function(c){c.dom().scrollTop=1;var b=0!==c.dom().scrollTop;return c.dom().scrollTop=0,b}(a)},eP=function(a){return 0<a.dom().scrollLeft||function(c){c.dom().scrollLeft=1;var b=0!==c.dom().scrollLeft;return c.dom().scrollLeft=0,b}(a)},bU=function(a){return"true"===uV.get(a,hK)?eP:gb},cX={exclusive:function(b,a){return pP(b,"touchmove",function(c){s2(c.target(),a).filter(bU).fold(function(){c.raw().preventDefault()},ub.noop)})},markAsHorizontal:function(a){uV.set(a,hK,"true")}};function iO(){var c=function(h){var g=!0===h.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:pK('<div aria-label="'+h.label+'" class="${prefix}-toolbar-group '+g+'"></div>'),tgroupBehaviours:a2([cY("adhoc-scrollable-toolbar",!0===h.scrollable?[fO(function(j,i){nX.set(j.element(),"overflow-x","auto"),cX.markAsHorizontal(j.element()),c0.register(j.element())})]:[])]),components:[aC.sketch({components:[qG.parts().items({})]})],markers:{itemClass:jA.resolve("toolbar-group-item")},items:h.items}},a=u6(fD.sketch({dom:pK('<div class="${prefix}-toolbar"></div>'),components:[fD.parts().groups({})],toolbarBehaviours:a2([m8.config({toggleClass:jA.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),nM.config({mode:"cyclic"})]),shell:!0})),f=u6(aC.sketch({dom:{classes:[jA.resolve("toolstrip")]},components:[tN(a)],containerBehaviours:a2([m8.config({toggleClass:jA.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),d=function(){fD.setGroups(a,b.get()),m8.off(a)},b=eY([]);return{wrapper:ub.constant(f),toolbar:ub.constant(a),createGroups:function(e){return jN.map(e,ub.compose(qG.sketch,c))},setGroups:function(e){b.set(e),d()},setContextToolbar:function(e){m8.on(a),fD.setGroups(a,e)},restoreToolbar:function(){m8.isOn(a)&&d()},refresh:function(){},focus:function(){nM.focusIn(a)}}}var cH=function(b,a){k2.append(b,tN(a))},nY=function(b,a){k2.remove(b,a)},aB=function(a){return u6(uU.sketch({dom:pK('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){a.run(function(b){b.setReadOnly(!1)})}}))},gH=function(){return u6(aC.sketch({dom:pK('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:a2([k2.config({})])}))},bE=function(d,b,a,c){(!0===a?lD.toAlpha:lD.toOmega)(c),(a?cH:nY)(d,b)},a7=function(a,b){return b.getAnimationRoot().fold(function(){return a.element()},function(c){return c(a)})},gX=function(a){return a.dimension().property()},ez=function(b,a){return b.dimension().getDimension()(a)},aR=function(c,b){var a=a7(c,b);gV(a,[b.shrinkingClass(),b.growingClass()])},oX=function(b,a){iW.remove(b.element(),a.openClass()),iW.add(b.element(),a.closedClass()),nX.set(b.element(),gX(a),"0px"),nX.reflow(b.element())},sj=function(b,a){iW.remove(b.element(),a.closedClass()),iW.add(b.element(),a.openClass()),nX.remove(b.element(),gX(a))},lX=function(d,b,a){a.setCollapsed(),nX.set(d.element(),gX(b),ez(b,d.element())),nX.reflow(d.element());var c=a7(d,b);iW.add(c,b.shrinkingClass()),oX(d,b),b.onStartShrink()(d)},oG=function(f,c,a){var d=function(i,h){sj(i,h);var g=ez(h,i.element());return oX(i,h),g}(f,c),b=a7(f,c);iW.add(b,c.growingClass()),sj(f,c),nX.set(f.element(),gX(c),d),a.setExpanded(),c.onStartGrow()(f)},nB=function(d,b,a){var c=a7(d,b);return !0===iW.has(c,b.growingClass())},qQ=function(d,b,a){var c=a7(d,b);return !0===iW.has(c,b.shrinkingClass())},k8=Object.freeze({grow:function(c,b,a){a.isExpanded()||oG(c,b,a)},shrink:function(c,b,a){a.isExpanded()&&lX(c,b,a)},immediateShrink:function(f,c,a){var d,b;a.isExpanded()&&(d=f,b=c,a.setCollapsed(),nX.set(d.element(),gX(b),ez(b,d.element())),nX.reflow(d.element()),aR(d,b),oX(d,b),b.onStartShrink()(d),b.onShrunk()(d))},hasGrown:function(c,b,a){return a.isExpanded()},hasShrunk:function(c,b,a){return a.isCollapsed()},isGrowing:nB,isShrinking:qQ,isTransitioning:function(c,b,a){return !0===nB(c,b)||!0===qQ(c,b)},toggleGrow:function(c,b,a){(a.isExpanded()?lX:oG)(c,b,a)},disableTransitions:aR}),uW=Object.freeze({exhibit:function(c,b){var a=b.expanded();return b5(a?{classes:[b.openClass()],styles:{}}:{classes:[b.closedClass()],styles:kK(b.dimension().property(),"0px")})},events:function(a,b){return iZ([dG(tX(),function(d,c){c.event().raw().propertyName===a.dimension().property()&&(aR(d,a),b.isExpanded()&&nX.remove(d.element(),a.dimension().property()),(b.isExpanded()?a.onGrown():a.onShrunk())(d,c))})])}}),tb=[tq("closedClass"),tq("openClass"),tq("shrinkingClass"),tq("growingClass"),pw("getAnimationRoot"),rZ("onShrunk"),rZ("onStartShrink"),rZ("onGrown"),rZ("onStartGrow"),q6("expanded",!1),mN("dimension",qR("property",{width:[rI("property","width"),rI("getDimension",function(a){return nQ(a)+"px"})],height:[rI("property","height"),rI("getDimension",function(a){return gW(a)+"px"})]}))],mM=Object.freeze({init:function(b){var a=eY(b.expanded());return aw({isExpanded:function(){return !0===a.get()},isCollapsed:function(){return !1===a.get()},setCollapsed:ub.curry(a.set,!1),setExpanded:ub.curry(a.set,!0),readState:function(){return"expanded: "+a.get()}})}}),rU=eq({fields:tb,name:"sliding",active:uW,apis:k8,state:mM}),pM=function(c,a){var d=u6(aC.sketch({dom:{tag:"div",classes:jA.resolve("dropup")},components:[],containerBehaviours:a2([k2.config({}),rU.config({closedClass:jA.resolve("dropup-closed"),openClass:jA.resolve("dropup-open"),shrinkingClass:jA.resolve("dropup-shrinking"),growingClass:jA.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(e){c(),a(),k2.set(e,[])},onGrown:function(e){c(),a()}}),mA(function(g,f){b(ub.noop)})])})),b=function(e){window.requestAnimationFrame(function(){e(),rU.shrink(d)})};return{appear:function(h,g,f){!0===rU.hasShrunk(d)&&!1===rU.isTransitioning(d)&&window.requestAnimationFrame(function(){g(f),k2.set(d,[h()]),rU.grow(d)})},disappear:b,component:ub.constant(d),element:d.element}},sJ=f6.detect().browser.isFirefox(),pv=cM([rV("triggerEvent"),rV("broadcastEvent"),q6("stopBackspace",!0)]),rD=function(x,j){var C,h,b,q,B=lY("Getting GUI events settings",pv,j),A=f6.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],z=iq(B),D=jN.map(A.concat(["selectstart","input","contextmenu","change","transitionend","dragstart","dragover","drop"]),function(a){return pP(x,a,function(c){z.fireIfReady(c,a).each(function(d){d&&c.kill()}),B.triggerEvent(a,c)&&c.kill()})}),w=pP(x,"keydown",function(c){var a;B.triggerEvent("keydown",c)?c.kill():!0!==B.stopBackspace||(a=c).raw().which!==mF.BACKSPACE()[0]||jN.contains(["input","textarea"],kL.name(a.target()))||c.prevent()}),p=(C=x,h=function(a){B.triggerEvent("focusin",a)&&a.kill()},sJ?sL(C,"focus",h):pP(C,"focusin",h)),y=(b=x,q=function(a){B.triggerEvent("focusout",a)&&a.kill(),setTimeout(function(){B.triggerEvent(cT(),a)},0)},sJ?sL(b,"blur",q):pP(b,"focusout",q)),k=n0.defaultView(x),v=pP(k,"scroll",function(a){B.broadcastEvent(gT(),a)&&a.kill()});return{unbind:function(){jN.each(D,function(a){a.unbind()}),w.unbind(),p.unbind(),y.unbind(),v.unbind()}}},n8=function(c,b){var a=jV(c,"target").map(function(d){return d()}).getOr(b);return eY(a)},q5=mH([{stopped:[]},{resume:["element"]},{complete:[]}]),kA=function(g,d,m,w,b,j){var v,q,p,x,k=g(d,w),h=(v=m,q=b,p=eY(!1),x=eY(!1),{stop:function(){p.set(!0)},cut:function(){x.set(!0)},isStopped:p.get,isCut:x.get,event:ub.constant(v),setSource:q.set,getSource:q.get});return k.fold(function(){return j.logEventNoHandlers(d,w),q5.complete()},function(c){var a=c.descHandler();return bS(a)(h),h.isStopped()?(j.logEventStopped(d,c.element(),a.purpose()),q5.stopped()):h.isCut()?(j.logEventCut(d,c.element(),a.purpose()),q5.complete()):n0.parent(c.element()).fold(function(){return j.logNoParent(d,c.element(),a.purpose()),q5.complete()},function(e){return j.logEventResponse(d,c.element(),a.purpose()),q5.resume(e)})})},ib=function(d,b,f,g,c,a){return kA(d,b,f,g,c,a).fold(function(){return !0},function(e){return ib(d,b,f,e,c,a)},function(){return !1})},t8=function(g,d,b){var f,c,a=(f=d,c=eY(!1),{stop:function(){c.set(!0)},cut:ub.noop,isStopped:c.get,isCut:ub.constant(!1),event:ub.constant(f),setTarget:ub.die("Cannot set target of a broadcasted event"),getTarget:ub.die("Cannot get target of a broadcasted event")});return jN.each(g,function(i){var h=i.descHandler();bS(h)(a)}),a.isStopped()},jL=function(g,d,b,f,c){var a=n8(b,f);return ib(g,d,b,f,a,c)},iY=function(c,b,a){return mj.closest(c,function(d){return b(d).isSome()},a).bind(b)},c7=kj.immutable("element","descHandler"),dF=function(b,a){return{id:ub.constant(b),descHandler:ub.constant(a)}};function p3(){var a={};return{registerId:function(c,b,d){uw.each(d,function(h,g){var f=a[g]!==undefined?a[g]:{};f[b]=eN(h,c),a[g]=f})},unregisterId:function(b){uw.each(a,function(d,c){d.hasOwnProperty(b)&&delete d[b]})},filterByType:function(b){return jV(a,b).map(function(c){return uw.mapToArray(c,function(f,d){return dF(d,f)})}).getOr([])},find:function(f,d,b){var c=lz(d)(a);return iY(b,function(h){return e=c,eD(g=h).fold(function(){return sX.none()},function(j){var i=lz(j);return e.bind(i).map(function(k){return c7(g,k)})});var e,g},f)}}}function lF(){var d=p3(),c={},b=function(e){var f=e.element();return eD(f).fold(function(){return i="uid-",h=e.element(),g=rx(bj+i),uV.set(h,g1,g),g;var i,h,g},function(g){return g})},a=function(e){eD(e.element()).each(function(f){c[f]=undefined,d.unregisterId(f)})};return{find:function(h,g,f){return d.find(h,g,f)},filter:function(e){return d.filterByType(e)},register:function(h){var g=b(h);l7(c,g)&&function(k,j){var i=c[j];if(i!==k){throw new Error('The tagId "'+j+'" is already used by: '+a0(i.element())+"\nCannot use it for: "+a0(k.element())+"\nThe conflicting element is"+(jW.inBody(i.element())?" ":" not ")+"already in the DOM")}a(k)}(h,g);var f=[h];d.registerId(f,g,h.events()),c[g]=h},unregister:a,getById:function(e){return lz(e)(c)}}}var eZ=function(C){var h=function(a){return n0.parent(C.element()).fold(function(){return !0},function(c){return qI(a,c)})},b=lF(),D=function(c,a){return b.find(h,c,a)},j=rD(C.element(),{triggerEvent:function(d,c){return nG(d,c.target(),function(s){return l=D,f=d,g=s,a=(m=c).target(),jL(l,f,m,a,g);var l,f,m,g,a})},broadcastEvent:function(d,c){var a=b.filter(d);return t8(a,c)}}),q=fR({debugInfo:ub.constant("real"),triggerEvent:function(c,a,d){nG(c,a,function(e){jL(D,c,d,a,e)})},triggerFocus:function(d,e){eD(d).fold(function(){fw(d)},function(a){nG(bQ(),d,function(E){var m,g,s,l,f,c;m=D,g=bQ(),s={originator:ub.constant(e),target:ub.constant(d)},f=E,c=n8(s,l=d),kA(m,g,s,l,c,f)})})},triggerEscape:function(c,a){q.triggerEvent("keydown",c.element(),a.event())},getByUid:function(a){return k(a)},getByDom:function(a){return v(a)},build:u6,addToGui:function(a){A(a)},removeFromGui:function(a){z(a)},addToWorld:function(a){x(a)},removeFromWorld:function(a){B(a)},broadcast:function(a){p(a)},broadcastOn:function(c,a){y(c,a)},isConnected:ub.constant(!0)}),x=function(a){a.connect(q),kL.isText(a.element())||(b.register(a),jN.each(a.components(),x),q.triggerEvent(a3(),a.element(),{target:ub.constant(a.element())}))},B=function(a){kL.isText(a.element())||(jN.each(a.components(),B),b.unregister(a)),a.disconnect()},A=function(a){lS(C,a)},z=function(a){qN(a)},w=function(a){var c=b.filter(iK());jN.each(c,function(f){var d=f.descHandler();bS(d)(a)})},p=function(a){w({universal:ub.constant(!0),data:ub.constant(a)})},y=function(c,a){w({universal:ub.constant(!1),channels:ub.constant(c),data:ub.constant(a)})},k=function(a){return b.getById(a).fold(function(){return s4.error(new Error('Could not find component with uid: "'+a+'" in system.'))},s4.value)},v=function(c){var a=eD(c).getOr("not found");return k(a)};return x(C),{root:ub.constant(C),element:C.element,destroy:function(){j.unbind(),aT.remove(C.element())},add:A,remove:z,getByUid:k,getByDom:v,addToWorld:x,removeFromWorld:B,broadcast:p,broadcastOn:y}},j1=ub.constant(jA.resolve("readonly-mode")),kQ=ub.constant(jA.resolve("edit-mode"));function m2(b){var a=u6(aC.sketch({dom:{classes:[jA.resolve("outer-container")].concat(b.classes)},containerBehaviours:a2([lD.config({alpha:j1(),omega:kQ()})])}));return eZ(a)}var fN=function(c,b){var a=lA.fromTag("input");nX.setAll(a,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),bG.append(c,a),fw(a),b(a),aT.remove(a)},mq=function(d){var b=d.getSelection();if(0<b.rangeCount){var a=b.getRangeAt(0),c=d.document.createRange();c.setStart(a.startContainer,a.startOffset),c.setEnd(a.endContainer,a.endOffset),b.removeAllRanges(),b.addRange(c)}},dW=function(b,a){hR().each(function(c){qI(c,a)||b3(c)}),b.focus(),fw(lA.fromDom(b.document.body)),mq(b)},g7={stubborn:function(g,d,b,f){var c=function(){dW(d,f)},a=pP(b,"keydown",function(e){jN.contains(["input","textarea"],kL.name(e.target()))||c()});return{toReading:function(){fN(g,b3)},toEditing:c,onToolbarTouch:function(){},destroy:function(){a.unbind()}}},timid:function(f,c,a,d){var b=function(){b3(d)};return{toReading:function(){b()},toEditing:function(){dW(c,d)},onToolbarTouch:function(){b()},destroy:ub.noop}}},jq=function(w,d,b,j,g){var v=function(){d.run(function(a){a.refreshSelection()})},m=function(f,c){var a=f-j.dom().scrollTop;d.run(function(e){e.scrollIntoView(a,a+c)})},q=function(){d.run(function(a){a.clearSelection()})},p=function(){w.getCursorBox().each(function(a){m(a.top(),a.height())}),d.run(function(a){a.syncHeight()})},x=uv(w),k=nb(p,300),h=[w.onKeyup(function(){q(),k.throttle()}),w.onNodeChanged(v),w.onDomChanged(k.throttle),w.onDomChanged(v),w.onScrollToCursor(function(a){a.preventDefault(),k.throttle()}),w.onScrollToElement(function(a){a.element(),m(d,j)}),w.onToEditing(function(){d.run(function(a){a.toEditing()})}),w.onToReading(function(){d.run(function(a){a.toReading()})}),pP(w.doc(),"touchend",function(a){qI(w.html(),a.target())||qI(w.body(),a.target())}),pP(b,"transitionend",function(c){var a;"height"===c.raw().propertyName&&(a=gW(b),d.run(function(e){e.setViewportOffset(a)}),v(),p())}),sL(b,"touchstart",function(c){var a;d.run(function(e){e.highlightSelection()}),a=c,d.run(function(e){e.onToolbarTouch(a)}),w.onTouchToolstrip()}),pP(w.body(),"touchstart",function(a){q(),w.onTouchContent(),x.fireTouchstart(a)}),x.onTouchmove(),x.onTouchend(),pP(w.body(),"click",function(a){a.kill()}),pP(b,"touchmove",function(){w.onToolbarScrollStart()})];return{destroy:function(){jN.each(h,function(a){a.unbind()})}}},fx=function(h){var c=sX.none(),f=[],g=function(e){d()?a(e):f.push(e)},d=function(){return c.isSome()},b=function(e){jN.each(e,a)},a=function(i){c.each(function(e){setTimeout(function(){i(e)},0)})};return h(function(e){c=sX.some(e),b(f),f=[]}),{get:g,map:function(e){return fx(function(i){g(function(j){i(e(j))})})},isReady:d}},b4={nu:fx,pure:function(a){return fx(function(b){b(a)})}},hT=function(a){return function(){var c=Array.prototype.slice.call(arguments),b=this;setTimeout(function(){a.apply(b,c)},0)}},qA=function(a){var b=function(c){a(hT(c))};return{map:function(c){return qA(function(d){b(function(g){var f=c(g);d(f)})})},bind:function(c){return qA(function(d){b(function(e){c(e).get(d)})})},anonBind:function(c){return qA(function(d){b(function(e){c.get(d)})})},toLazy:function(){return b4.nu(b)},get:b}},hE={nu:qA,pure:function(a){return qA(function(b){b(a)})}},f4=function(c,b,a){return Math.abs(c-b)<=a?sX.none():c<b?sX.some(c+a):sX.some(c-a)},eJ=function(){var a=null;return{animate:function(d,b,f,g,h,m){var l=!1,k=function(c){l=!0,h(c)};clearInterval(a);var j=function(c){clearInterval(a),k(c)};a=setInterval(function(){var c=d();f4(c,b,f).fold(function(){clearInterval(a),k(b)},function(o){if(g(o,j),!l){var i=d();(i!==o||Math.abs(i-b)>Math.abs(c-b))&&(clearInterval(a),k(b))}})},m)}}},bO=function(b,a){return aK([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(c){return b<=c.width&&a<=c.height?sX.some(c.keyboard):sX.none()}).getOr({portrait:a/5,landscape:b/4})},cR=function(f){var c,a=rG(f).isPortrait(),d=bO((c=f).screen.width,c.screen.height),b=a?d.portrait:d.landscape;return(a?f.screen.height:f.screen.width)-f.innerHeight>b?0:b},iH=function(c,b){var a=n0.owner(c).dom().defaultView;return gW(c)+gW(b)-cR(a)},cA=iH,nS=function(f,c,a){var d=iH(c,a),b=gW(c)+gW(a)-d;nX.set(f,"padding-bottom",b+"px")},av=mH([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),gB="data-"+jA.resolve("position-y-fixed"),by="data-"+jA.resolve("y-property"),a1="data-"+jA.resolve("scrolling"),gR="data-"+jA.resolve("last-window-height"),ek=function(a){return db(a,gB)},aL=function(c,b){var a=uV.get(c,by);return av.fixed(c,a,b)},o3=function(b,a){return av.scroller(b,a)},sy=function(b){var a=ek(b);return("true"===uV.get(b,a1)?o3:aL)(b,a)},l3=function(d,b,a){var c=n0.owner(d).dom().defaultView.innerHeight;return uV.set(d,gR,c+"px"),c-b-a},oM=function(b){var a=oC(b,"["+gB+"]");return jN.map(a,sy)},nH=function(F,D,J,A){var G,N,B,R,P,C,M,I,O=n0.owner(F).dom().defaultView,H=(I=uV.get(M=J,"style"),nX.setAll(M,{position:"absolute",top:"0px"}),uV.set(M,gB,"0px"),uV.set(M,by,"top"),{restore:function(){uV.set(M,"style",I||""),uV.remove(M,gB),uV.remove(M,by)}}),L=gW(J),E=gW(A),K=l3(F,L,E),z=(B=L,R=K,C=uV.get(P=F,"style"),c0.register(P),nX.setAll(P,{position:"absolute",height:R+"px",width:"100%",top:B+"px"}),uV.set(P,gB,B+"px"),uV.set(P,a1,"true"),uV.set(P,by,"top"),{restore:function(){c0.deregister(P),uV.set(P,"style",C||""),uV.remove(P,gB),uV.remove(P,a1),uV.remove(P,by)}}),j=(N=uV.get(G=A,"style"),nX.setAll(G,{position:"absolute",bottom:"0px"}),uV.set(G,gB,"0px"),uV.set(G,by,"bottom"),{restore:function(){uV.set(G,"style",N||""),uV.remove(G,gB),uV.remove(G,by)}}),Q=!0,q=function(){var a=O.innerHeight;return db(F,gR)<a},k=function(){if(Q){var c=gW(J),b=gW(A),a=l3(F,c,b);uV.set(F,gB,c+"px"),nX.set(F,"height",a+"px"),nX.set(A,"bottom",-(c+a+b)+"px"),nS(D,F,A)}};return nS(D,F,A),{setViewportOffset:function(a){uV.set(F,gB,a+"px"),k()},isExpanding:q,isShrinking:ub.not(q),refresh:k,restore:function(){Q=!1,H.restore(),z.restore(),j.restore()}}},qV=ek,lv=eJ(),u2="data-"+jA.resolve("last-scroll-top"),tF=function(b){var a=nX.getRaw(b,"top").getOr(0);return parseInt(a,10)},mS=function(a){return parseInt(a.dom().scrollTop,10)},r0=function(c,b){var a=b+qV(c)+"px";nX.set(c,"top",a)},pS=function(a,c,b){return hE.nu(function(f){var d=ub.curry(mS,a);lv.animate(d,c,15,function(e){a.dom().scrollTop=e,nX.set(a,"top",tF(a)+15+"px")},function(){a.dom().scrollTop=c,nX.set(a,"top",b+"px"),f(c)},10)})},sO=function(b,a){return hE.nu(function(g){var d=ub.curry(mS,b);uV.set(b,u2,d());var c=Math.abs(a-d()),f=Math.ceil(c/10);lv.animate(d,a,f,function(i,h){db(b,u2)!==b.dom().scrollTop?h(b.dom().scrollTop):(b.dom().scrollTop=i,uV.set(b,u2,i))},function(){b.dom().scrollTop=a,uV.set(b,u2,a),g(a)},10)})},pB=function(b,a){return hE.nu(function(h){var f=ub.curry(tF,b),c=function(e){nX.set(b,"top",e+"px")},g=Math.abs(a-f()),d=Math.ceil(g/10);lv.animate(f,a,d,c,function(){c(a),h(a)},10)})},rJ=function(c,a,d){var b=n0.owner(c).dom().defaultView;return hE.nu(function(e){r0(c,d),r0(a,d),b.scrollTo(0,d),e(d)})},ov=function(h,f,c,g,d){var b=cA(f,c),a=ub.curry(mq,h);b<g||b<d?sO(f,f.dom().scrollTop-b+d).get(a):g<0&&sO(f,f.dom().scrollTop+g).get(a)},rj=function(a,b){return b(function(e){var d=[],c=0;0===a.length?e([]):jN.each(a,function(h,g){var f;h.get((f=g,function(i){d[f]=i,++c>=a.length&&e(d)}))})})},kG=function(a){return rj(a,hE.nu)},ix=kG,uD=function(b,a){return b.fold(function(k,h,f){return j=k,g=h,c=a+(d=f),nX.set(j,g,c+"px"),hE.pure(d);var j,g,d,c},function(l,j){return g=l,h=a+(k=j),f=nX.getRaw(g,"top").getOr(k),d=h-parseInt(f,10),c=g.dom().scrollTop+d,pS(g,c,h);var g,k,h,f,d,c})},jR=function(d,b){var a=oM(d),c=jN.map(a,function(e){return uD(e,b)});return ix(c)},i4=function(k,q,g,d,b,h){var p,m,l=(p=function(a){return rJ(k,q,a)},m=eY(b4.pure({})),{start:function(a){var c=b4.nu(function(e){return p(a).get(e)});m.set(c)},idle:function(a){m.get().get(function(){a()})}}),v=nb(function(){l.idle(function(){jR(g,d.pageYOffset).get(function(){var a;(a=nI(h),sX.from(a[0]).bind(function(f){var c=f.top()-q.dom().scrollTop;return c>d.innerHeight+5||c<-5?sX.some({top:ub.constant(c),bottom:ub.constant(c+f.height())}):sX.none()})).each(function(c){q.dom().scrollTop=q.dom().scrollTop+c.top()}),l.start(0),b.refresh()})})},1000),j=pP(lA.fromDom(d),"scroll",function(){d.pageYOffset<0||v.throttle()});return jR(g,d.pageYOffset).get(ub.identity),{unbind:j.unbind}},dq=function(q){var G=q.cWin(),B=q.ceBody(),k=q.socket(),b=q.toolstrip(),x=q.toolbar(),F=q.contentElement(),E=q.keyboardType(),D=q.outerWindow(),H=q.dropup(),A=nH(k,B,b,H),w=E(q.outerBody(),G,jW.body(),F,b,x),C=oj(D,{onChange:ub.noop,onReady:A.refresh});C.onAdjustment(function(){A.refresh()});var v=pP(lA.fromDom(D),"resize",function(){A.isExpanding()&&A.refresh()}),z=i4(b,k,q.outerBody(),D,A,G),j=function(d,g){var l=d.document,h=lA.fromTag("div");iW.add(h,jA.resolve("unfocused-selections")),bG.append(lA.fromDom(l.documentElement),h);var f=pP(h,"touchstart",function(e){e.prevent(),dW(d,g),a()}),c=function(m){var i=lA.fromTag("span");return a5(i,[jA.resolve("layer-editor"),jA.resolve("unfocused-selection")]),nX.setAll(i,{left:m.left()+"px",top:m.top()+"px",width:m.width()+"px",height:m.height()+"px"}),i},a=function(){aT.empty(h)};return{update:function(){a();var m=nI(d),i=jN.map(m,c);gZ(h,i)},isActive:function(){return 0<n0.children(h).length},destroy:function(){f.unbind(),aT.remove(h)},clear:a}}(G,F),y=function(){j.clear()};return{toEditing:function(){w.toEditing(),y()},toReading:function(){w.toReading()},onToolbarTouch:function(a){w.onToolbarTouch(a)},refreshSelection:function(){j.isActive()&&j.update()},clearSelection:y,highlightSelection:function(){j.update()},scrollIntoView:function(c,a){ov(G,k,H,c,a)},updateToolbarPadding:ub.noop,setViewportOffset:function(a){A.setViewportOffset(a),pB(k,a).get(ub.identity)},syncHeight:function(){nX.set(F,"height",F.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:A.refresh,destroy:function(){A.restore(),C.destroy(),z.unbind(),v.unbind(),w.destroy(),j.destroy(),fN(jW.body(),b3)}}},dL=function(g,j){var f=e6(),e=i2(),d=i2(),b=jP(),h=jP();return{enter:function(){j.hide();var a=lA.fromDom(document);uF.getActiveApi(g.editor).each(function(i){e.set({socketHeight:nX.getRaw(g.socket,"height"),iframeHeight:nX.getRaw(i.frame(),"height"),outerScroll:document.body.scrollTop}),d.set({exclusives:cX.exclusive(a,"."+c0.scrollable())}),iW.add(g.container,jA.resolve("fullscreen-maximized")),qb(g.container,i.body()),f.maximize(),nX.set(g.socket,"overflow","scroll"),nX.set(g.socket,"-webkit-overflow-scrolling","touch"),fw(i.body());var c=kj.immutableBag(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);b.set(dq(c({cWin:i.win(),ceBody:i.body(),socket:g.socket,toolstrip:g.toolstrip,toolbar:g.toolbar,dropup:g.dropup.element(),contentElement:i.frame(),cursor:ub.noop,outerBody:g.body,outerWindow:g.win,keyboardType:g7.stubborn,isScrolling:function(){return d.get().exists(function(k){return k.socket.isScrolling()})}}))),b.run(function(k){k.syncHeight()}),h.set(jq(i,b,g.toolstrip,g.socket,g.dropup))})},refreshStructure:function(){b.run(function(a){a.refreshStructure()})},exit:function(){f.restore(),h.clear(),b.clear(),j.show(),e.on(function(a){a.socketHeight.each(function(c){nX.set(g.socket,"height",c)}),a.iframeHeight.each(function(c){nX.set(g.editor.getFrame(),"height",c)}),document.body.scrollTop=a.scrollTop}),e.clear(),d.on(function(a){a.exclusives.unbind()}),d.clear(),iW.remove(g.container,jA.resolve("fullscreen-maximized")),lN(),c0.deregister(g.toolbar),nX.remove(g.socket,"overflow"),nX.remove(g.socket,"-webkit-overflow-scrolling"),b3(g.editor.getFrame()),uF.getActiveApi(g.editor).each(function(a){a.clearSelection()})}}},p9=function(d){var b=lY("Getting IosWebapp schema",mC,d);nX.set(b.toolstrip,"width","100%"),nX.set(b.container,"position","relative");var a=u6(fU(function(){b.setReadOnly(b.readOnlyOnInit()),c.enter()},b.translate));b.alloy.add(a);var c=dL(b,{show:function(){b.alloy.add(a)},hide:function(){b.alloy.remove(a)}});return{setReadOnly:b.setReadOnly,refreshStructure:c.refreshStructure,enter:c.enter,exit:c.exit,destroy:ub.noop}},lM=tinymce.util.Tools.resolve("tinymce.EditorManager"),e5=function(b){var a=jV(b.settings,"skin_url").fold(function(){return lM.baseURL+"/skins/lightgray"},function(c){return c});return{content:a+"/content.mobile.min.css",ui:a+"/skin.mobile.min.css"}},j8=function(c,b,a){c.system().broadcastOn([bN.formatChanged()],{command:b,state:a})},kX=function(b,c){var a=uw.keys(c.formatter.get());jN.each(a,function(d){c.formatter.formatChanged(d,function(e){j8(b,d,e)})}),jN.each(["ul","ol"],function(d){c.selection.selectorChanged(d,function(g,f){j8(b,d,g)})})},m9=(ub.constant(["x-small","small","medium","large","x-large"]),function(b){var a=function(){b._skinLoaded=!0,b.fire("SkinLoaded")};return function(){b.initialized?a():b.on("init",a)}}),fT=ub.constant("toReading"),mB=ub.constant("toEditing");f3.add("mobile",function(a){return{getNotificationManagerImpl:function(){return{open:ub.identity,close:ub.noop,reposition:ub.noop,getArgs:ub.identity}},renderUI:function(J){var R=e5(a);0==(!1===a.settings.skin)?(a.contentCSS.push(R.content),hC.DOM.styleSheetLoader.load(R.ui,m9(a))):m9(a)();var E,I,G,N,D,X,V,F,Q,L,U,K,P,H,O=function(){a.fire("scrollIntoView")},C=lA.fromTag("div"),z=f6.detect().os.isAndroid()?(F=O,Q=m2({classes:[jA.resolve("android-container")]}),L=iO(),U=jP(),K=aB(U),P=gH(),H=pM(ub.noop,F),Q.add(L.wrapper()),Q.add(P),Q.add(H.component()),{system:ub.constant(Q),element:Q.element,init:function(b){U.set(d2(b))},exit:function(){U.run(function(b){b.exit(),k2.remove(P,K)})},setToolbarGroups:function(c){var b=L.createGroups(c);L.setGroups(b)},setContextToolbar:function(c){var b=L.createGroups(c);L.setContextToolbar(b)},focusToolbar:function(){L.focus()},restoreToolbar:function(){L.restoreToolbar()},updateMode:function(b){bE(P,K,b,Q.root())},socket:ub.constant(P),dropup:ub.constant(H)}):(E=O,I=m2({classes:[jA.resolve("ios-container")]}),G=iO(),N=jP(),D=aB(N),X=gH(),V=pM(function(){N.run(function(b){b.refreshStructure()})},E),I.add(G.wrapper()),I.add(X),I.add(V.component()),{system:ub.constant(I),element:I.element,init:function(b){N.set(p9(b))},exit:function(){N.run(function(b){k2.remove(X,D),b.exit()})},setToolbarGroups:function(c){var b=G.createGroups(c);G.setGroups(b)},setContextToolbar:function(c){var b=G.createGroups(c);G.setContextToolbar(b)},focusToolbar:function(){G.focus()},restoreToolbar:function(){G.restoreToolbar()},updateMode:function(b){bE(X,D,b,I.root())},socket:ub.constant(X),dropup:ub.constant(V)}),W=lA.fromDom(J.targetNode);bG.after(W,C),function(d,c){bG.append(d,c.element());var b=n0.children(c.element());jN.each(b,function(e){c.getByDom(e).each(r8)})}(C,z.system());var B=J.targetNode.ownerDocument.defaultView,A=oj(B,{onChange:function(){z.system().broadcastOn([bN.orientationChanged()],{width:q8(B)})},onReady:ub.noop}),j=function(g,d,b,f){!1===f&&a.selection.collapse();var c=q(g,d,b);z.setToolbarGroups(!0===f?c.readOnly:c.main),a.setMode(!0===f?"readonly":"design"),a.fire(!0===f?fT():mB()),z.updateMode(f)},q=function(g,d,b){var f=g.get(),c={readOnly:f.backToMask.concat(d.get()),main:f.backToMask.concat(b.get())};return c},M=function(c,b){return a.on(c,b),{unbind:function(){a.off(c)}}};return a.on("init",function(){z.init({editor:{getFrame:function(){return lA.fromDom(a.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:ub.noop}},onToReading:function(c){return M(fT(),c)},onToEditing:function(c){return M(mB(),c)},onScrollToCursor:function(c){return a.on("scrollIntoView",function(e){c(e)}),{unbind:function(){a.off("scrollIntoView"),A.destroy()}}},onTouchToolstrip:function(){p()},onTouchContent:function(){var i,c=lA.fromDom(a.editorContainer.querySelector("."+jA.resolve("toolbar")));(i=c,qz(i).bind(function(e){return z.system().getByDom(e).toOption()})).each(l8),z.restoreToolbar(),p()},onTapContent:function(i){var c=i.target();"img"===kL.name(c)?(a.selection.select(c.dom()),i.kill()):"a"===kL.name(c)&&z.system().getByDom(lA.fromDom(a.editorContainer)).each(function(e){lD.isAlpha(e)&&eI(c.dom())})}},container:lA.fromDom(a.editorContainer),socket:lA.fromDom(a.contentAreaContainer),toolstrip:lA.fromDom(a.editorContainer.querySelector("."+jA.resolve("toolstrip"))),toolbar:lA.fromDom(a.editorContainer.querySelector("."+jA.resolve("toolbar"))),dropup:z.dropup(),alloy:z.system(),translate:ub.noop,setReadOnly:function(c){j(k,l,m,c)},readOnlyOnInit:function(){return !1}});var p=function(){z.dropup().disappear(function(){z.system().broadcastOn([bN.dropupDismissed()],{})})},f={label:"The first group",scrollable:!1,items:[n6.forToolbar("back",function(){a.selection.collapse(),z.exit()},{})]},h={label:"Back to read only",scrollable:!1,items:[n6.forToolbar("readonly-back",function(){j(k,l,m,!0)},{})]},d=oJ(z,a),b=nE(a.settings,d),g={label:"The extra group",scrollable:!1,items:[]},m=eY([{label:"the action group",scrollable:!0,items:b},g]),l=eY([{label:"The read only mode group",scrollable:!0,items:[]},g]),k=eY({backToMask:[f],backToReadOnly:[h]});kX(z,a)}),{iframeContainer:z.socket().element().dom(),editorContainer:z.element().dom()}}}})}();